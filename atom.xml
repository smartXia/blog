<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>å¤å¤å¤©çš„æŠ€æœ¯åšå®¢</title>
  <icon>https://www.gravatar.com/avatar/df6fc96953fb3fc0fe9399149caa86b8</icon>
  <subtitle>ä»¥åœ°äº‹ç§¦ çŠ¹æŠ±è–ªæ•‘ç« è–ªä¸å°½ ç«ä¸ç­</subtitle>
  <link href="https://smartxia.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://smartxia.github.io/blog/"/>
  <updated>2025-10-15T09:25:00.950Z</updated>
  <id>https://smartxia.github.io/blog/</id>
  
  <author>
    <name>å¤å¤å¤©</name>
    <email>xiapeifu@gmail.com</email>
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>WebRTC/WHIP åŒºåˆ«è¯¦è§£</title>
    <link href="https://smartxia.github.io/blog/2025/10/15/%E8%A7%86%E9%A2%91%E6%B5%81/WebRTC-WHIP-%E5%8C%BA%E5%88%AB/"/>
    <id>https://smartxia.github.io/blog/2025/10/15/%E8%A7%86%E9%A2%91%E6%B5%81/WebRTC-WHIP-%E5%8C%BA%E5%88%AB/</id>
    <published>2025-10-15T09:19:46.000Z</published>
    <updated>2025-10-15T09:25:00.950Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\blog\assets\css\APlayer.min.css"><script src="\blog\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\blog\assets\js\Meting.min.js"></script><h2><span id="æ¦‚è¿°">æ¦‚è¿°</span></h2><p>WebRTC å’Œ WHIP æ˜¯ä¸¤ç§ä¸åŒçš„æŠ€æœ¯ã€‚ç®€å•è¯´ï¼š</p><p>ğŸ§  <strong>WebRTC</strong> æ˜¯é€šä¿¡åè®®æ—<br>ğŸš€ <strong>WHIP</strong> æ˜¯ç”¨äºæ¨æµï¼ˆIngestï¼‰çš„ WebRTC æ ‡å‡†åŒ–å­åè®®</p><h2><span id="ä¸€-æ¦‚å¿µå¯¹æ¯”æ€»è§ˆ">ä¸€ã€æ¦‚å¿µå¯¹æ¯”æ€»è§ˆ</span></h2><table><thead><tr><th>é¡¹ç›®</th><th>WebRTC</th><th>WHIP</th></tr></thead><tbody><tr><td><strong>å…¨ç§°</strong></td><td>Web Real-Time Communication</td><td>WebRTC-HTTP Ingestion Protocol</td></tr><tr><td><strong>å®šä½</strong></td><td>ä¸€æ•´å¥—å®æ—¶éŸ³è§†é¢‘ä¼ è¾“åè®®ï¼ˆP2P å®æ—¶é€šä¿¡æ ‡å‡†ï¼‰</td><td>ç”¨ HTTP å°è£… WebRTC æ¨æµåˆ°æœåŠ¡å™¨çš„ç®€åŒ–åè®®</td></tr><tr><td><strong>æ ‡å‡†ç»„ç»‡</strong></td><td>W3C &#x2F; IETF</td><td>IETF (draft-ietf-wish-whip)</td></tr><tr><td><strong>ä½¿ç”¨åœºæ™¯</strong></td><td>æµè§ˆå™¨ä¸æµè§ˆå™¨ã€æµè§ˆå™¨ä¸æœåŠ¡ç«¯ä¹‹é—´çš„å®æ—¶é€šä¿¡</td><td>å®¢æˆ·ç«¯ï¼ˆå¦‚ OBSã€æµè§ˆå™¨ã€æ‘„åƒå¤´ï¼‰æ¨æµåˆ°åª’ä½“æœåŠ¡å™¨ï¼ˆå¦‚ Wowzaã€Janusã€LiveKitã€Millicastï¼‰</td></tr><tr><td><strong>ä¿¡ä»¤æœºåˆ¶</strong></td><td>è‡ªå®šä¹‰ï¼ˆå¼€å‘è€…è‡ªå·±å®ç°ä¿¡ä»¤ï¼‰</td><td>é€šè¿‡ HTTP POST&#x2F;DELETE æ ‡å‡†åŒ–ä¿¡ä»¤</td></tr><tr><td><strong>ä¼ è¾“åè®®</strong></td><td>SRTP + DTLS + ICE (UDP)</td><td>åŒ WebRTCï¼Œåº•å±‚ä¾ç„¶æ˜¯ SRTP + DTLS + ICE</td></tr><tr><td><strong>æ¨æµ&#x2F;æ‹‰æµè§’è‰²</strong></td><td>åŒæ–¹å¯¹ç­‰ï¼ˆpeer-to-peerï¼‰</td><td>å•å‘ï¼šPublisher â†’ Media Server</td></tr><tr><td><strong>å…¸å‹ç”¨é€”</strong></td><td>è§†é¢‘ä¼šè®®ã€å®æ—¶äº’åŠ¨</td><td>WebRTC ç›´æ’­æ¨æµï¼ˆä½å»¶è¿Ÿç›´æ’­ï¼‰</td></tr></tbody></table><h2><span id="äºŒ-whip-çš„è®¾è®¡èƒŒæ™¯">äºŒã€WHIP çš„è®¾è®¡èƒŒæ™¯</span></h2><p>WebRTC æœ¬èº«åªå®šä¹‰äº†éŸ³è§†é¢‘ä¼ è¾“å±‚ï¼ˆåª’ä½“ã€ç½‘ç»œã€åŠ å¯†ï¼‰ï¼Œä½†<strong>ä¸å®šä¹‰ä¿¡ä»¤å±‚</strong>ã€‚<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚ä½•äº¤æ¢ SDPï¼ˆSession Description Protocolï¼‰ã€å¦‚ä½•å»ºç«‹è¿æ¥ç”±å¼€å‘è€…è‡ªå·±å†³å®šã€‚</p><p>â†’ è¿™è®©â€æ¨æµåœºæ™¯â€å®ç°èµ·æ¥å¾ˆå¤æ‚ï¼Œæ¯ä¸ªå¹³å°ä¿¡ä»¤éƒ½ä¸ä¸€æ ·ã€‚</p><p>ğŸ’¡ æ‰€ä»¥ IETF æ¨å‡ºäº† <strong>WHIP</strong>ï¼ˆWebRTC-HTTP Ingestion Protocolï¼‰ï¼Œ<br>ç›®æ ‡æ˜¯è®© WebRTC åƒ RTMP ä¸€æ ·å®¹æ˜“æ¨æµï¼š</p><ol><li>ç”¨ä¸€ä¸ª <strong>HTTP POST</strong> å‘èµ·æ¨æµï¼ˆå‘é€ SDP offerï¼‰</li><li>æœåŠ¡å™¨è¿”å› <strong>SDP answer</strong></li><li>æ¨æµç«¯å¼€å§‹ä¼ è¾“åª’ä½“æµ</li><li>ç”¨ <strong>HTTP DELETE</strong> åœæ­¢æ¨æµ</li></ol><p>è¿™æ ·æµè§ˆå™¨ã€OBSã€GStreamer ç­‰å·¥å…·å¯ä»¥ç”¨ç»Ÿä¸€æ¥å£æ¨æµåˆ°ä»»æ„æ”¯æŒ WHIP çš„æœåŠ¡å™¨ã€‚</p><h2><span id="ä¸‰-whip-å·¥ä½œæµç¨‹ç¤ºä¾‹">ä¸‰ã€WHIP å·¥ä½œæµç¨‹ç¤ºä¾‹</span></h2><p>ğŸ‘‡ <strong>WHIP æ¨æµæ—¶åºå›¾</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[Client]                        [Media Server]</span><br><span class="line">   |                                  |</span><br><span class="line">   |  POST /whip-endpoint             |</span><br><span class="line">   |  Content-Type: application/sdp   |</span><br><span class="line">   |  Body: SDP offer                 |</span><br><span class="line">   |---------------------------------&gt;|</span><br><span class="line">   |                                  |</span><br><span class="line">   |       201 Created                |</span><br><span class="line">   |  Location: /resource/id          |</span><br><span class="line">   |  Body: SDP answer                |</span><br><span class="line">   |&lt;---------------------------------|</span><br><span class="line">   |                                  |</span><br><span class="line">   |------ ICE Candidate Exchange ----|</span><br><span class="line">   |                                  |</span><br><span class="line">   |  (Start sending RTP media)       |</span><br><span class="line">   |---------------------------------&gt;|</span><br><span class="line">   |                                  |</span><br><span class="line">   |  DELETE /resource/id             |</span><br><span class="line">   |---------------------------------&gt;|</span><br><span class="line">   |                                  |</span><br><span class="line">   |  (Stop streaming)                |</span><br></pre></td></tr></table></figure><h2><span id="å››-whip-ä¸ä¼ ç»Ÿ-rtmp-æ¨æµå¯¹æ¯”">å››ã€WHIP ä¸ä¼ ç»Ÿ RTMP æ¨æµå¯¹æ¯”</span></h2><table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>RTMP</th><th>WHIP</th></tr></thead><tbody><tr><td><strong>åè®®å±‚</strong></td><td>TCP</td><td>UDP (SRTP over ICE)</td></tr><tr><td><strong>å»¶è¿Ÿ</strong></td><td>ç§’çº§ï¼ˆ2~5sï¼‰</td><td>ä½äº 500ms</td></tr><tr><td><strong>æ¨æµæ¥å£</strong></td><td>ç»Ÿä¸€ï¼ˆrtmp:&#x2F;&#x2F;â€¦ï¼‰</td><td>æ ‡å‡†åŒ– HTTP (REST API)</td></tr><tr><td><strong>æ¨æµæ ¼å¼</strong></td><td>FLV</td><td>SDP + RTP</td></tr><tr><td><strong>æ˜¯å¦åŠ å¯†</strong></td><td>å¦ï¼ˆæˆ– TLSï¼‰</td><td>å¼ºåˆ¶ DTLS + SRTP</td></tr><tr><td><strong>ä¸»è¦ç”¨é€”</strong></td><td>ç‚¹æ’­ç›´æ’­</td><td>è¶…ä½å»¶è¿Ÿäº’åŠ¨ç›´æ’­</td></tr></tbody></table><h2><span id="äº”-whip-çš„åå‘åè®®whep">äº”ã€WHIP çš„åå‘åè®®ï¼šWHEP</span></h2><p><strong>WHIP</strong> æ˜¯ æ¨æµï¼ˆIngestï¼‰ï¼Œ<br>è€Œ <strong>WHEP</strong>ï¼ˆWebRTC-HTTP Egress Protocolï¼‰ æ˜¯ æ‹‰æµï¼ˆPlaybackï¼‰ æ ‡å‡†åŒ–åè®®ã€‚</p><p>äºŒè€…é…åˆå¯ä»¥æ›¿ä»£ RTMP + HLS çš„æ•´å¥—æµç¨‹ï¼š</p><table><thead><tr><th>æ–¹å‘</th><th>åè®®</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>æ¨æµ</td><td>WHIP</td><td>å®¢æˆ·ç«¯ â†’ æœåŠ¡ç«¯</td></tr><tr><td>æ‹‰æµ</td><td>WHEP</td><td>æœåŠ¡ç«¯ â†’ æ’­æ”¾ç«¯</td></tr></tbody></table><h2><span id="å…­-æ€»ç»“">å…­ã€æ€»ç»“</span></h2><p><strong>WebRTC</strong> æ˜¯åº•å±‚ä¼ è¾“æ ‡å‡†ï¼Œ<strong>WHIP</strong> æ˜¯åŸºäº WebRTC çš„ç»Ÿä¸€æ¨æµä¿¡ä»¤åè®®ã€‚<br>WHIP è®©â€WebRTC æ¨æµâ€åƒâ€RTMP æ¨æµâ€ä¸€æ ·ç®€å•ã€‚</p><h2><span id="ä¸ƒ-å®é™…åº”ç”¨">ä¸ƒã€å®é™…åº”ç”¨</span></h2><p>å¦‚æœä½ è¦åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨ï¼š</p><h3><span id="æœåŠ¡å™¨ç«¯">æœåŠ¡å™¨ç«¯</span></h3><p>å¯ä»¥ä½¿ç”¨æ”¯æŒ WHIP çš„åª’ä½“æœåŠ¡å™¨ï¼š</p><ul><li><strong>Janus</strong> - å¼€æºçš„ WebRTC ç½‘å…³</li><li><strong>LiveKit</strong> - ç°ä»£åŒ–çš„å®æ—¶éŸ³è§†é¢‘å¹³å°</li><li><strong>Wowza</strong> - å•†ä¸šæµåª’ä½“æœåŠ¡å™¨</li><li><strong>OvenMediaEngine</strong> - å¼€æºæµåª’ä½“æœåŠ¡å™¨</li></ul><h3><span id="å®¢æˆ·ç«¯">å®¢æˆ·ç«¯</span></h3><p>å¯ä»¥ç”¨ä»¥ä¸‹å·¥å…·ï¼š</p><ul><li>æµè§ˆå™¨åŸç”Ÿ <strong>WebRTC API</strong></li><li><strong>OBS</strong> æœ€æ–°ç‰ˆæœ¬çš„ â€œWHIP æ¨æµæ’ä»¶â€</li><li><strong>ffmpeg</strong> -f whipï¼ˆæœ€æ–°ç‰ˆä¹Ÿæ”¯æŒï¼‰</li></ul><hr><blockquote><p>ğŸ’¡ <strong>æç¤º</strong>ï¼šWHIP åè®®ç›®å‰è¿˜åœ¨ IETF è‰æ¡ˆé˜¶æ®µï¼Œä½†å·²ç»è¢«å¤šä¸ªä¸»æµåª’ä½“æœåŠ¡å™¨æ”¯æŒï¼Œæ˜¯æœªæ¥ WebRTC æ¨æµçš„æ ‡å‡†æ–¹å‘ã€‚</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;&#92;blog&#92;assets&#92;css&#92;APlayer.min.css&quot;&gt;&lt;script src=&quot;&#92;blog&#92;assets&#92;js&#92;APlayer.m</summary>
      
    
    
    
    <category term="è§†é¢‘æµæŠ€æœ¯" scheme="https://smartxia.github.io/blog/categories/%E8%A7%86%E9%A2%91%E6%B5%81%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="WebRTC" scheme="https://smartxia.github.io/blog/tags/WebRTC/"/>
    
    <category term="WHIP" scheme="https://smartxia.github.io/blog/tags/WHIP/"/>
    
    <category term="å®æ—¶é€šä¿¡" scheme="https://smartxia.github.io/blog/tags/%E5%AE%9E%E6%97%B6%E9%80%9A%E4%BF%A1/"/>
    
    <category term="ç›´æ’­æŠ€æœ¯" scheme="https://smartxia.github.io/blog/tags/%E7%9B%B4%E6%92%AD%E6%8A%80%E6%9C%AF/"/>
    
  </entry>
  
  <entry>
    <title>k8sä¸­å¦‚ä½•åšåˆ°åŠ¨æ€åˆ†é…ç½‘ç»œåŸŸå</title>
    <link href="https://smartxia.github.io/blog/2024/07/17/tech/devops/k8s/k8s-6-%E4%B8%AD%E5%A6%82%E4%BD%95%E5%81%9A%E5%88%B0%E5%8A%A8%E6%80%81%E5%88%86%E9%85%8D%E7%BD%91%E7%BB%9C%E5%9F%9F%E5%90%8D/"/>
    <id>https://smartxia.github.io/blog/2024/07/17/tech/devops/k8s/k8s-6-%E4%B8%AD%E5%A6%82%E4%BD%95%E5%81%9A%E5%88%B0%E5%8A%A8%E6%80%81%E5%88%86%E9%85%8D%E7%BD%91%E7%BB%9C%E5%9F%9F%E5%90%8D/</id>
    <published>2024-07-17T03:00:56.000Z</published>
    <updated>2024-07-17T03:12:24.348Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\blog\assets\css\APlayer.min.css"><script src="\blog\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\blog\assets\js\Meting.min.js"></script>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;&#92;blog&#92;assets&#92;css&#92;APlayer.min.css&quot;&gt;&lt;script src=&quot;&#92;blog&#92;assets&#92;js&#92;APlayer.m</summary>
      
    
    
    
    
    <category term="k8s" scheme="https://smartxia.github.io/blog/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>k8sä¸­å…³äºæœåŠ¡ç½‘ç»œçš„ä½¿ç”¨</title>
    <link href="https://smartxia.github.io/blog/2024/07/17/tech/devops/k8s/k8s-5-%E4%B8%AD%E5%85%B3%E4%BA%8E%E6%9C%8D%E5%8A%A1%E7%BD%91%E7%BB%9C%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <id>https://smartxia.github.io/blog/2024/07/17/tech/devops/k8s/k8s-5-%E4%B8%AD%E5%85%B3%E4%BA%8E%E6%9C%8D%E5%8A%A1%E7%BD%91%E7%BB%9C%E7%9A%84%E4%BD%BF%E7%94%A8/</id>
    <published>2024-07-17T02:59:54.000Z</published>
    <updated>2024-07-17T03:02:37.629Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\blog\assets\css\APlayer.min.css"><script src="\blog\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\blog\assets\js\Meting.min.js"></script>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;&#92;blog&#92;assets&#92;css&#92;APlayer.min.css&quot;&gt;&lt;script src=&quot;&#92;blog&#92;assets&#92;js&#92;APlayer.m</summary>
      
    
    
    
    
    <category term="k8s" scheme="https://smartxia.github.io/blog/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>golang Contextä¸Šä¸‹æ–‡</title>
    <link href="https://smartxia.github.io/blog/2024/07/15/tech/backend/golang/GOLANG-%E7%AC%94%E8%AE%B08-Context%E4%B8%8A%E4%B8%8B%E6%96%87/"/>
    <id>https://smartxia.github.io/blog/2024/07/15/tech/backend/golang/GOLANG-%E7%AC%94%E8%AE%B08-Context%E4%B8%8A%E4%B8%8B%E6%96%87/</id>
    <published>2024-07-15T10:56:27.000Z</published>
    <updated>2024-07-31T07:15:10.346Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\blog\assets\css\APlayer.min.css"><script src="\blog\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\blog\assets\js\Meting.min.js"></script><p><img src="/blog/image.png" alt="alt text"></p><p><a href="https://zhuanlan.zhihu.com/p/68792989">https://zhuanlan.zhihu.com/p/68792989</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;&#92;blog&#92;assets&#92;css&#92;APlayer.min.css&quot;&gt;&lt;script src=&quot;&#92;blog&#92;assets&#92;js&#92;APlayer.m</summary>
      
    
    
    
    <category term="GOLANG" scheme="https://smartxia.github.io/blog/categories/GOLANG/"/>
    
    
    <category term="golang" scheme="https://smartxia.github.io/blog/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>k8s-æœ‰çŠ¶æ€æœåŠ¡æ— çŠ¶æ€æœåŠ¡å’Œå¯¹å¤–è®¿é—®æœåŠ¡</title>
    <link href="https://smartxia.github.io/blog/2024/04/12/tech/devops/k8s/k8s-3-%E6%9C%89%E7%8A%B6%E6%80%81%E6%9C%8D%E5%8A%A1%E6%97%A0%E7%8A%B6%E6%80%81%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%AF%B9%E5%A4%96%E8%AE%BF%E9%97%AE%E6%9C%8D%E5%8A%A1/"/>
    <id>https://smartxia.github.io/blog/2024/04/12/tech/devops/k8s/k8s-3-%E6%9C%89%E7%8A%B6%E6%80%81%E6%9C%8D%E5%8A%A1%E6%97%A0%E7%8A%B6%E6%80%81%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%AF%B9%E5%A4%96%E8%AE%BF%E9%97%AE%E6%9C%8D%E5%8A%A1/</id>
    <published>2024-04-12T08:43:25.000Z</published>
    <updated>2024-04-12T08:46:22.286Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\blog\assets\css\APlayer.min.css"><script src="\blog\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\blog\assets\js\Meting.min.js"></script><ol><li>åŸºæœ¬æ¦‚å¿µ<br>æ— çŠ¶æ€æœåŠ¡<br>æ— çŠ¶æ€æœåŠ¡ä¸ä¼šåœ¨æœ¬åœ°å­˜å‚¨æŒä¹…åŒ–æ•°æ®.å¤šä¸ªæœåŠ¡å®ä¾‹å¯¹äºåŒä¸€ä¸ªç”¨æˆ·è¯·æ±‚çš„å“åº”ç»“æœæ˜¯å®Œå…¨ä¸€è‡´çš„.è¿™ç§å¤šæœåŠ¡å®ä¾‹ä¹‹é—´æ˜¯æ²¡æœ‰ä¾èµ–å…³ç³»,æ¯”å¦‚webåº”ç”¨,åœ¨k8sæ§åˆ¶å™¨ ä¸­åŠ¨æ€å¯åœæ— çŠ¶æ€æœåŠ¡çš„podå¹¶ä¸ä¼šå¯¹å…¶å®ƒçš„podäº§ç”Ÿå½±å“.</li></ol><p>æœ‰çŠ¶æ€æœåŠ¡<br>æœ‰çŠ¶æ€æœåŠ¡éœ€è¦åœ¨æœ¬åœ°å­˜å‚¨æŒä¹…åŒ–æ•°æ®,å…¸å‹çš„æ˜¯åˆ†å¸ƒå¼æ•°æ®åº“çš„åº”ç”¨,åˆ†å¸ƒå¼èŠ‚ç‚¹å®ä¾‹ä¹‹é—´æœ‰ä¾èµ–çš„æ‹“æ‰‘å…³ç³».æ¯”å¦‚,ä¸»ä»å…³ç³». å¦‚æœK8Såœæ­¢åˆ†å¸ƒå¼é›†ç¾¤ä¸­ä»» ä¸€å®ä¾‹pod,å°±å¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±æˆ–è€…é›†ç¾¤çš„crash.</p><ol start="2"><li>Deploymentéƒ¨ç½²çš„é—®é¢˜?</li></ol><p>Deploymentè¢«è®¾è®¡ç”¨æ¥ç®¡ç†æ— çŠ¶æ€æœåŠ¡çš„pod,æ¯ä¸ªpodå®Œå…¨ä¸€è‡´.ä»€ä¹ˆæ„æ€å‘¢?</p><p>æ— çŠ¶æ€æœåŠ¡å†…çš„å¤šä¸ªPodåˆ›å»ºçš„é¡ºåºæ˜¯æ²¡æœ‰é¡ºåºçš„.<br>æ— çŠ¶æ€æœåŠ¡å†…çš„å¤šä¸ªPodçš„åç§°æ˜¯éšæœºçš„.podè¢«é‡æ–°å¯åŠ¨è°ƒåº¦å,å®ƒçš„åç§°ä¸IPéƒ½ä¼šå‘ç”Ÿå˜åŒ–.<br>æ— çŠ¶æ€æœåŠ¡å†…çš„å¤šä¸ªPodèƒŒåæ˜¯å…±äº«å­˜å‚¨çš„.<br>2.1.æ–°çš„é—®é¢˜</p><p>å¯¹äºæ•°æ®åº“æœ‰çŠ¶æ€çš„æœåŠ¡å®¹å™¨ç¼–æ’,Deploymentè§£å†³æ–¹æ¡ˆå°±å˜å¾—æ— èƒ½ä¸ºåŠ›äº†.<br>æ¯”å¦‚,Redisæ˜¯ä¸»ä»çš„æ¶æ„,åªèƒ½å…è®¸é›†ç¾¤ä¸­å‡ºç°ä¸€ä¸ªä¸»èŠ‚ç‚¹æä¾›å†™,å…¶å®ƒèŠ‚ç‚¹æä¾›è¯»èƒ½åŠ›.å¦‚æœåŒæ—¶å‡ºç°äºŒä¸ªä¸»èŠ‚ç‚¹å,å¿…é¡»ä¼šå‡ºç°å¹¶å‘å†™çš„ æ“ä½œ,è¿›ä¸€æ­¥å¯¼è‡´é›†ç¾¤å†™æ•°æ®çš„ä¸ä¸€è‡´.<br>æ‰€ä»¥é—®é¢˜æ¥äº†,é’ˆå¯¹Redisè¿™ç§æœ‰çŠ¶æ€çš„æœåŠ¡,å®ƒç®¡ç†çš„å¤šä¸ªPod(ä»£è¡¨master&#x2F;slaveè§’è‰²)å¿…é¡»æœ‰è‡ªå·±ç‹¬ç«‹çš„æŒä¹…åŒ–å­˜å‚¨ç»„ä»¶.<br>æœ‰çŠ¶æ€çš„æœåŠ¡Podæ˜¯ç”¨æ¥è¿è¡Œæœ‰çŠ¶æ€åº”ç”¨çš„,å…¶åœ¨æ•°æ®å·ä¸Šå­˜å‚¨çš„æ•°æ®éå¸¸é‡è¦,å› ä¸ºStatefulå°±æ˜¯è¦ä¾èµ–å­˜å‚¨æ•°æ®å·ä¸Šå¯¹æ¯ä¸ªPodçš„çŠ¶æ€è¿›è¡Œå»ºæ¨¡ä¸å­˜å‚¨.<br>æ‰€ä»¥K8Sæä¾›äº†ä¸€ä¸ªæ–°çš„å·¥å…·â€”â€”StatefulSetæ¥ç»Ÿä¸€è§£å†³é—®é¢˜.</p><ol start="3"><li>Statefulå¦‚ä½•è§£å†³é—®é¢˜?<br>Deploymentç»„ä»¶æ˜¯ä¸ºæ— çŠ¶æ€æœåŠ¡è€Œè®¾è®¡çš„,å…¶ä¸­çš„Podåç§°,ä¸»æœºå,å­˜å‚¨éƒ½æ˜¯éšæœº,ä¸ç¨³å®šçš„,å¹¶ä¸”Podçš„åˆ›å»ºä¸é”€æ¯ä¹Ÿæ˜¯æ— åºçš„.è¿™ä¸ªè®¾è®¡å†³å®šäº†æ— çŠ¶æ€æœåŠ¡å¹¶ ä¸é€‚åˆæ•°æ®åº“é¢†åŸŸçš„åº”ç”¨.</li></ol><p>è€ŒStatefulç®¡ç†æœ‰çŠ¶æ€çš„åº”ç”¨,å®ƒçš„Podæœ‰å¦‚ä¸‹ç‰¹å¾:</p><p>å”¯ä¸€æ€§: æ¯ä¸ªPodä¼šè¢«åˆ†é…ä¸€ä¸ªå”¯ä¸€åºå·.<br>é¡ºåºæ€§: Podå¯åŠ¨,æ›´æ–°,é”€æ¯æ˜¯æŒ‰é¡ºåºè¿›è¡Œ.<br>ç¨³å®šçš„ç½‘ç»œæ ‡è¯†: Podä¸»æœºå,DNSåœ°å€ä¸ä¼šéšç€Podè¢«é‡æ–°è°ƒåº¦è€Œå‘ç”Ÿå˜åŒ–.<br>ç¨³å®šçš„æŒä¹…åŒ–å­˜å‚¨: Podè¢«é‡æ–°è°ƒåº¦å,ä»ç„¶èƒ½æŒ‚è½½åŸæœ‰çš„PV,ä»è€Œä¿è¯äº†æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§.</p><p>3.1. å¦‚ä½•ç†è§£ç¨³å®šç½‘ç»œæ ‡è¯†?</p><p>åˆ›å»ºåä¸ºtest-redis-podçš„Statefulæ¨¡å‹,æ ¹æ®ä½ é…ç½®çš„Replica&#x3D;3çš„è®¾ç½®,K8Sä¼šåˆ›å»ºä¸‰ä¸ªPod,ä¾æ¬¡å‘½åä¸º: test-redis-pod-0; test-redis-pod-1; test-redis-pod-2</p><p>K8Sä¸ºæœ‰çŠ¶æ€çš„æœåŠ¡Podåˆ†é…ç¨³å®šçš„ç½‘ç»œæ ‡è¯†,å…·ä½“å®ç°åŸºäºtest-redis-pod-0åç§°,å€ŸåŠ©Headless DNSè¿›è¡Œå¦‚ä¸‹è§£æ,è·å–åç«¯å…¶ä¸­ä¸€ä¸ªPodçš„åœ°å€.</p><p>$(pod name).$(service name).$(namespace).svc.cluster.local<br>ä¸‹é¢æ˜¯ä¸€ä¸ªé€šè¿‡Podåç§°è®¿é—®Redisé›†ç¾¤çš„MasterèŠ‚ç‚¹åœ°å€çš„æ–¹æ³•.</p><p>session.save_path &#x3D; â€œtcp:&#x2F;&#x2F;test-redis-pod-0.test-redis-service.default.svc.cluster.local:6379â€<br>ç°åœ¨å›ç­”å¦‚ä¸‹äºŒä¸ªé—®é¢˜:</p><p>åœ¨Redis Podå†…éƒ¨,ä¸»ä»èŠ‚ç‚¹ä¹‹é—´æ•°æ®åŒæ­¥çš„éœ€æ±‚,SlaveèŠ‚ç‚¹å¯¹åº”çš„é…ç½®æ–‡ä»¶ä¸­éœ€è¦ä¸€ä¸ªç¨³å®šçš„Masteråœ°å€.ä¸‹è¾¹è„šæœ¬å°±æ˜¯ç¨³å®šè®¿é—®test-redis-pod-0 åç§°æ¥é—´æ¥è·å¾—Redis MasterèŠ‚ç‚¹IPåœ°å€,ç„¶åå†™å…¥åˆ°Redis Slaveçš„é…ç½®æ–‡ä»¶ä¸­,è¿™æ ·åç»­SlaveèŠ‚ç‚¹ä¸MasterèŠ‚ç‚¹æ‰èƒ½å®Œæˆå¢é‡æ•°æ®çš„åŒæ­¥.<br>if [ â€œ${server_host}â€ !&#x3D; â€œtest-redis-pod-0â€ ];then<br>        #echo â€œserver-count: ${server_counts}â€ &gt;&gt; &#x2F;data&#x2F;test.log</p><pre><code>    while [ -z &quot;$&#123;master_address&#125;&quot; ];do        echo &quot;master_address is not available, $&#123;master_address&#125; waiting for redis master...&quot; &gt;&gt; /data/test.log        master_address=$(replication_master_address)        sleep 1s    donefiecho &quot;master_address: $(master_address)&quot; &gt;&gt; /data/test.logif [ ! -z &quot;$master_address&quot; ]; then    printf &quot;\nslaveof %s 6379\n&quot; &quot;$master_address&quot; &gt;&gt; $conffi</code></pre><p>åœ¨Redis Podå¤–éƒ¨, å¯ä»¥é€šè¿‡$(pod name).$(service name).$(namespace).svc.cluster.localæ–¹å¼æ¥è®¿é—®å…·ä½“çš„PodæœåŠ¡.<br>3.2. å¦‚ä½•ç†è§£ç¨³å®šæŒä¹…åŒ–å­˜å‚¨?</p><p>æ¯ä¸ªRedis Podå¯¹åº”ä¸€ä¸ªè‡ªå·±çš„PVC&#x2F;PV.å½“Podå‘ç”Ÿè°ƒåº¦æ—¶,éœ€è¦åœ¨åˆ«çš„èŠ‚ç‚¹å¯åŠ¨æ—¶,æ ¹æ®PodèƒŒåå…³è”çš„å­˜å‚¨ä¿¡æ¯ä¿è¯å…¶åç§°çš„ç¨³å®šæ€§.</p><p>Podè¿˜æ˜¯ä¼šattachæŒ‚è½½åˆ°åŸæ¥çš„PV&#x2F;PVCä¸­,ä»è€Œç¡®å®šæ¯ä¸ªPodæœ‰è‡ªå·±ä¸“ç”¨çš„å­˜å‚¨å·.</p><ol start="4"><li>æ€»ç»“<br>æœ¬æ–‡ä¸»è¦ä»‹ç»äº†æ— çŠ¶æ€å’Œæœ‰çŠ¶æ€æœåŠ¡åœ¨K8Sä¸­çš„å…¸å‹åº”ç”¨åœºæ™¯.</li></ol><p>é€šè¿‡å¯¹Deploymentéƒ¨ç½²æ— çŠ¶æ€æœåŠ¡æ‰€é‡åˆ°é—®é¢˜çš„åˆ†æ,å¼•å‡ºäº†Statefulæ–°çš„éƒ¨ç½²ç»„ä»¶.å®ƒæ˜¯é€šè¿‡æ”¯æŒPodä¸€äº›ç‰¹æ€§(e.g. åç§°å”¯ä¸€æ€§,ç¨³å®šçš„ç½‘ç»œæ ‡è¯†, ç¨³å®šçš„æŒä¹…åŒ–å­˜å‚¨ç­‰)æ¥å®ç°åœ¨K8Sä¸­éƒ¨ç½²è¿ç»´æœ‰çŠ¶æ€æœåŠ¡.</p><p>ç‰¢è®°: Statefulæœ‰çŠ¶æ€æœåŠ¡,æ¯ä¸ªPodæœ‰ç‹¬ç«‹çš„PVC&#x2F;PVå­˜å‚¨ç»„ä»¶</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;&#92;blog&#92;assets&#92;css&#92;APlayer.min.css&quot;&gt;&lt;script src=&quot;&#92;blog&#92;assets&#92;js&#92;APlayer.m</summary>
      
    
    
    
    <category term="k8s" scheme="https://smartxia.github.io/blog/categories/k8s/"/>
    
    
    <category term="k8s" scheme="https://smartxia.github.io/blog/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>k8s-StorageClass PV PVC æ¦‚å¿µå’Œä½¿ç”¨</title>
    <link href="https://smartxia.github.io/blog/2024/04/12/tech/devops/k8s/k8s-4-StorageClass%20PV%20PVC/"/>
    <id>https://smartxia.github.io/blog/2024/04/12/tech/devops/k8s/k8s-4-StorageClass%20PV%20PVC/</id>
    <published>2024-04-12T02:25:53.000Z</published>
    <updated>2024-04-12T07:59:31.963Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\blog\assets\css\APlayer.min.css"><script src="\blog\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\blog\assets\js\Meting.min.js"></script><p>è´Ÿè´£æŠŠPVCç»‘å®šåˆ°PVçš„æ˜¯ä¸€ä¸ªæŒä¹…åŒ–å­˜å‚¨å·æ§åˆ¶å¾ªç¯ï¼Œè¿™ä¸ªæ§åˆ¶å™¨ä¹Ÿæ˜¯kube-manager-controllerçš„ä¸€éƒ¨åˆ†è¿è¡Œåœ¨masterä¸Šã€‚è€ŒçœŸæ­£æŠŠç›®å½•æŒ‚è½½åˆ°å®¹å™¨ä¸Šçš„æ“ä½œæ˜¯åœ¨PODæ‰€åœ¨ä¸»æœºä¸Šå‘ç”Ÿçš„ï¼Œæ‰€ä»¥é€šè¿‡kubeletæ¥å®Œæˆã€‚è€Œä¸”åˆ›å»ºPVä»¥åŠPVCçš„ç»‘å®šæ˜¯åœ¨PODè¢«è°ƒåº¦åˆ°æŸä¸€èŠ‚ç‚¹ä¹‹åè¿›è¡Œçš„ï¼Œå®Œæˆè¿™äº›æ“ä½œï¼ŒPODå°±å¯ä»¥è¿è¡Œäº†ã€‚ä¸‹é¢æ¢³ç†ä¸€ä¸‹æŒ‚è½½ä¸€ä¸ªPVçš„è¿‡ç¨‹ï¼š</p><p>ç”¨æˆ·æäº¤ä¸€ä¸ªåŒ…å«PVCçš„POD</p><p>è°ƒåº¦å™¨æŠŠæ ¹æ®å„ç§è°ƒåº¦ç®—æ³•æŠŠè¯¥PODåˆ†é…åˆ°æŸä¸ªèŠ‚ç‚¹ï¼Œæ¯”å¦‚node01</p><p>Node01ä¸Šçš„kubeletç­‰å¾…Volume Managerå‡†å¤‡å­˜å‚¨è®¾å¤‡</p><p>PVæ§åˆ¶å™¨è°ƒç”¨å­˜å‚¨æ’ä»¶åˆ›å»ºPVå¹¶ä¸PVCè¿›è¡Œç»‘å®š</p><p>Attach&#x2F;Detach Controlleræˆ–Volume Manageré€šè¿‡å­˜å‚¨æ’ä»¶å®ç°è®¾å¤‡çš„attachã€‚ï¼ˆè¿™ä¸€æ­¥æ˜¯é’ˆå¯¹å—è®¾å¤‡å­˜å‚¨ï¼‰</p><p>Volume Managerç­‰å¾…å­˜å‚¨è®¾å¤‡å˜ä¸ºå¯ç”¨åï¼ŒæŒ‚è½½è¯¥è®¾å¤‡åˆ°&#x2F;var&#x2F;lib&#x2F;kubelet&#x2F;pods&#x2F;&lt;Pod çš„ ID&gt;&#x2F;volumes&#x2F;kubernetes.io~&lt;Volume ç±»å‹ &gt;&#x2F;&lt;Volume åå­— &gt;ç›®å½•ä¸Š</p><p>Kubeletè¢«å‘ŠçŸ¥å·å·²ç»å‡†å¤‡å¥½ï¼Œå¼€å§‹å¯åŠ¨PODï¼Œé€šè¿‡æ˜ å°„æ–¹å¼æŒ‚è½½åˆ°å®¹å™¨ä¸­</p><p>æ€»ç»“ï¼šæœ¬åœ°å·ä¹Ÿå°±æ˜¯LPVä¸æ”¯æŒåŠ¨æ€ä¾›ç»™çš„æ–¹å¼ï¼Œå»¶è¿Ÿç»‘å®šï¼Œå°±æ˜¯ä¸ºäº†ç»¼åˆè€ƒè™‘æ‰€æœ‰å› ç´ å†è¿›è¡ŒPODè°ƒåº¦ã€‚å…¶æ ¹æœ¬åŸå› æ˜¯åŠ¨æ€ä¾›ç»™æ˜¯å…ˆè°ƒåº¦PODåˆ°èŠ‚ç‚¹ï¼Œç„¶ååŠ¨æ€åˆ›å»ºPVä»¥åŠç»‘å®šPVCæœ€åè¿è¡ŒPODï¼›è€ŒLPVæ˜¯å…ˆåˆ›å»ºä¸æŸä¸€èŠ‚ç‚¹å…³è”çš„PVï¼Œç„¶ååœ¨è°ƒåº¦çš„æ—¶å€™ç»¼åˆè€ƒè™‘å„ç§å› ç´ è€Œä¸”è¦åŒ…æ‹¬PVåœ¨å“ªä¸ªèŠ‚ç‚¹ï¼Œç„¶åå†è¿›è¡Œè°ƒåº¦ï¼Œåˆ°è¾¾è¯¥èŠ‚ç‚¹ååœ¨è¿›è¡ŒPVCçš„ç»‘å®šã€‚ä¹Ÿå°±è¯´åŠ¨æ€ä¾›ç»™ä¸è€ƒè™‘èŠ‚ç‚¹ï¼ŒLPVå¿…é¡»è€ƒè™‘èŠ‚ç‚¹ã€‚æ‰€ä»¥è¿™ä¸¤ç§æœºåˆ¶æœ‰å†²çªå¯¼è‡´æ— æ³•åœ¨åŠ¨æ€ä¾›ç»™ç­–ç•¥ä¸‹ä½¿ç”¨LPVã€‚æ¢å¥è¯è¯´åŠ¨æ€ä¾›ç»™æ˜¯PVè·Ÿç€PODèµ°ï¼Œè€ŒLPVæ˜¯PODè·Ÿç€PVèµ°ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;&#92;blog&#92;assets&#92;css&#92;APlayer.min.css&quot;&gt;&lt;script src=&quot;&#92;blog&#92;assets&#92;js&#92;APlayer.m</summary>
      
    
    
    
    <category term="k8s" scheme="https://smartxia.github.io/blog/categories/k8s/"/>
    
    
    <category term="k8s" scheme="https://smartxia.github.io/blog/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>GOLANG-ç¬”è®°7-error.groupç”¨æ³•</title>
    <link href="https://smartxia.github.io/blog/2024/03/26/tech/backend/golang/GOLANG-%E7%AC%94%E8%AE%B07-error-group%E7%94%A8%E6%B3%95/"/>
    <id>https://smartxia.github.io/blog/2024/03/26/tech/backend/golang/GOLANG-%E7%AC%94%E8%AE%B07-error-group%E7%94%A8%E6%B3%95/</id>
    <published>2024-03-26T06:18:21.000Z</published>
    <updated>2024-03-26T07:02:26.582Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\blog\assets\css\APlayer.min.css"><script src="\blog\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\blog\assets\js\Meting.min.js"></script><h4><span id="1-å…ˆçœ‹ä¸‹æ•°æ®ç»“æ„">1 .å…ˆçœ‹ä¸‹æ•°æ®ç»“æ„</span></h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Group <span class="keyword">struct</span> &#123;</span><br><span class="line">cancel <span class="function"><span class="keyword">func</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line">wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line">sem <span class="keyword">chan</span> token</span><br><span class="line"></span><br><span class="line">errOnce sync.Once</span><br><span class="line">err     <span class="type">error</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4><span id="2åœ¨å¹¶å‘ç¼–ç¨‹é‡Œ-syncwaitgroup">2.åœ¨å¹¶å‘ç¼–ç¨‹é‡Œ sync.WaitGroup</span></h4><p>å¹¶å‘åŸè¯­çš„ä½¿ç”¨é¢‘ç‡éå¸¸é«˜ï¼Œå®ƒç»å¸¸ç”¨äºååŒç­‰å¾…çš„åœºæ™¯ gorouting éƒ½å®Œæˆåæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚</p><p>å¦‚æœåœ¨woker goroutineçš„æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°é”™è¯¯å¹¶æƒ³è¦å¤„ç†è¯¥æ€ä¹ˆåŠï¼Ÿ</p><p>WaitGroupå¹¶æ²¡æœ‰æä¾›ä¼ æ’­é”™è¯¯çš„åŠŸèƒ½ï¼Œé‡åˆ°è¿™ç§åœºæ™¯æˆ‘ä»¬è¯¥æ€ä¹ˆåŠï¼ŸGoè¯­è¨€åœ¨æ‰©å±•åº“æä¾›äº†ErrorGroupå¹¶å‘åŸè¯­æ­£å¥½é€‚åˆåœ¨è¿™ç§åœºæ™¯ä¸‹ä½¿ç”¨ï¼Œå®ƒåœ¨WaitGroupçš„åŸºç¡€ä¸Šè¿˜æä¾›äº†ï¼Œé”™è¯¯ä¼ æ’­ä»¥åŠä¸Šä¸‹æ–‡å–æ¶ˆçš„åŠŸèƒ½ã€‚</p><p>æ‰©å±•åº“é€šè¿‡errorgroup.Groupæä¾›ErrorGroupåŸè¯­çš„åŠŸèƒ½ï¼Œå®ƒæœ‰ä¸‰ä¸ªæ–¹æ³•å¯è°ƒç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">func WithContext(ctx context.Context) (*Group, context.Context)</span><br><span class="line">func (g *Group) Go(f func() error)</span><br><span class="line">func (g *Group) Wait() error</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ErrorGroupæœ‰ä¸€ä¸ªç‰¹ç‚¹æ˜¯ä¼šè¿”å›æ‰€ä»¥æ‰§è¡Œä»»åŠ¡çš„goroutineé‡åˆ°çš„ç¬¬ä¸€ä¸ªé”™è¯¯</span></span><br></pre></td></tr></table></figure><h4><span id="3æƒ³è®©ç¨‹åºé‡åˆ°é”™è¯¯å°±ç»ˆæ­¢å…¶ä»–å­ä»»åŠ¡">3.æƒ³è®©ç¨‹åºé‡åˆ°é”™è¯¯å°±ç»ˆæ­¢å…¶ä»–å­ä»»åŠ¡</span></h4><p>æœ€æ—©æ‰§è¡Œé‡åˆ°é”™è¯¯çš„goroutineè¾“å‡ºäº†Error: 98ä½†æ˜¯æ‰€æœ‰æœªæ‰§è¡Œå®Œçš„å…¶ä»–ä»»åŠ¡å¹¶æ²¡æœ‰åœæ­¢æ‰§è¡Œï¼Œé‚£ä¹ˆæƒ³è®©ç¨‹åºé‡åˆ°é”™è¯¯å°±ç»ˆæ­¢å…¶ä»–å­ä»»åŠ¡è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ç”¨errgroup.Groupæä¾›çš„WithContextæ–¹æ³•åˆ›å»ºä¸€ä¸ªå¸¦å¯å–æ¶ˆä¸Šä¸‹æ–‡åŠŸèƒ½çš„ErrorGroupã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">ä½¿ç”¨errorgroup.Groupæ—¶æ³¨æ„å®ƒçš„ä¸¤ä¸ªç‰¹ç‚¹ï¼š</span><br><span class="line">- errgroup.Groupåœ¨å‡ºç°é”™è¯¯æˆ–è€…ç­‰å¾…ç»“æŸåéƒ½ä¼šè°ƒç”¨ Contextå¯¹è±¡ çš„ cancel æ–¹æ³•åŒæ­¥å–æ¶ˆä¿¡å·ã€‚</span><br><span class="line">- åªæœ‰ç¬¬ä¸€ä¸ªå‡ºç°çš„é”™è¯¯æ‰ä¼šè¢«è¿”å›ï¼Œå‰©ä½™çš„é”™è¯¯éƒ½ä¼šè¢«ç›´æ¥æŠ›å¼ƒã€‚</span><br><span class="line">*/</span><br><span class="line">func main() &#123;</span><br><span class="line">   eg, ctx := errgroup.WithContext(context.Background())</span><br><span class="line"></span><br><span class="line">   for i := 0; i &lt; 100; i++ &#123;</span><br><span class="line">      i := i</span><br><span class="line">      eg.Go(func() error &#123;</span><br><span class="line">         time.Sleep(2 * time.Second)</span><br><span class="line"></span><br><span class="line">         select &#123;</span><br><span class="line">         case &lt;-ctx.Done():</span><br><span class="line">            fmt.Println(&quot;Canceled:&quot;, i)</span><br><span class="line">            return nil</span><br><span class="line">         default:</span><br><span class="line">            if i &gt; 90 &#123;</span><br><span class="line">               fmt.Println(&quot;Error:&quot;, i)</span><br><span class="line">               return fmt.Errorf(&quot;Error: %d&quot;, i)</span><br><span class="line">            &#125;</span><br><span class="line">            fmt.Println(&quot;End:&quot;, i)</span><br><span class="line">            return nil</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">   &#125;</span><br><span class="line">   if err := eg.Wait(); err != nil &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4><span id="4cancleåˆ°å…¶ä»–çš„å­ä»»åŠ¡">4.cancleåˆ°å…¶ä»–çš„å­ä»»åŠ¡</span></h4><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå­goroutineå‡ºç°é”™è¯¯åï¼Œä¼šcancleåˆ°å…¶ä»–çš„å­ä»»åŠ¡ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶æ²¡æœ‰çœ‹åˆ°è°ƒç”¨ctxçš„cancelæ–¹æ³•ï¼Œä¸‹é¢æˆ‘ä»¬çœ‹ä¸‹æºç ï¼Œçœ‹çœ‹å†…éƒ¨æ˜¯æ€ä¹ˆå¤„ç†çš„ã€‚<br> errgroup çš„è®¾è®¡éå¸¸ç²¾ç»ƒï¼Œå…¨éƒ¨ä»£ç å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">package errgroup</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">    &quot;context&quot;</span><br><span class="line">    &quot;sync&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">// A Group is a collection of goroutines working on subtasks that are part of</span><br><span class="line">// the same overall task.</span><br><span class="line">//</span><br><span class="line">// A zero Group is valid and does not cancel on error.</span><br><span class="line">type Group struct &#123;</span><br><span class="line">    cancel func()</span><br><span class="line">    wg sync.WaitGroup</span><br><span class="line">    errOnce sync.Once</span><br><span class="line">    err     error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// WithContext returns a new Group and an associated Context derived from ctx.</span><br><span class="line">//</span><br><span class="line">// The derived Context is canceled the first time a function passed to Go</span><br><span class="line">// returns a non-nil error or the first time Wait returns, whichever occurs</span><br><span class="line">// first.</span><br><span class="line">func WithContext(ctx context.Context) (*Group, context.Context) &#123;</span><br><span class="line">    ctx, cancel := context.WithCancel(ctx)</span><br><span class="line">    return &amp;Group&#123;cancel: cancel&#125;, ctx</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Wait blocks until all function calls from the Go method have returned, then</span><br><span class="line">// returns the first non-nil error (if any) from them.</span><br><span class="line">func (g *Group) Wait() error &#123;</span><br><span class="line">    g.wg.Wait()</span><br><span class="line">    if g.cancel != nil &#123;</span><br><span class="line">        g.cancel()</span><br><span class="line">    &#125;</span><br><span class="line">    return g.err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Go calls the given function in a new goroutine.</span><br><span class="line">//</span><br><span class="line">// The first call to return a non-nil error cancels the group; its error will be</span><br><span class="line">// returned by Wait.</span><br><span class="line">func (g *Group) Go(f func() error) &#123;</span><br><span class="line">    g.wg.Add(1)</span><br><span class="line"></span><br><span class="line">    go func() &#123;</span><br><span class="line">        defer g.wg.Done()</span><br><span class="line"></span><br><span class="line">        if err := f(); err != nil &#123;</span><br><span class="line">            g.errOnce.Do(func() &#123;</span><br><span class="line">                g.err = err</span><br><span class="line">                if g.cancel != nil &#123;</span><br><span class="line">                    g.cancel()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œerrgroup çš„å®ç°ä¾é äºç»“æ„ä½“ Groupï¼Œå®ƒé€šè¿‡å°è£… sync.WaitGroupï¼Œç»§æ‰¿äº† WaitGroup çš„ç‰¹æ€§ï¼Œåœ¨ Go() æ–¹æ³•ä¸­æ–°èµ·ä¸€ä¸ªå­ä»»åŠ¡ goroutineï¼Œå¹¶åœ¨ Wait() æ–¹æ³•ä¸­é€šè¿‡ sync.WaitGroup çš„ Wait è¿›è¡Œé˜»å¡ç­‰å¾…ã€‚</p><p>åŒæ—¶ Group åˆ©ç”¨ sync.Once ä¿è¯äº†å®ƒæœ‰ä¸”ä»…ä¼šä¿ç•™ç¬¬ä¸€ä¸ªå­ goroutine é”™è¯¯ã€‚<br> Group é€šè¿‡åµŒå…¥ context.WithCancel æ–¹æ³•äº§ç”Ÿçš„ <code>cancel</code> å‡½æ•°ï¼ˆå¯¹äº Context ä¸ç†Ÿæ‚‰çš„è¯»è€…ï¼Œæ¨èé˜…è¯» <a href="https://links.jianshu.com/go?to=https://mp.weixin.qq.com/s?__biz=MzkyMzIyNjIxMQ==&mid=2247484553&idx=1&sn=ce4c7e052bacf69c38e27d71187726c8&scene=21%23wechat_redirect">ç†è§£Contextæœºåˆ¶</a> ä¸€æ–‡ï¼‰ï¼Œèƒ½å¤Ÿ<strong>åœ¨å­ goroutine å‘ç”Ÿé”™è¯¯æ—¶ï¼ŒåŠæ—¶é€šè¿‡è°ƒç”¨ cancle å‡½æ•°ï¼Œå°† Context çš„å–æ¶ˆä¿¡å·åŠæ—¶ä¼ æ’­å‡ºå»ã€‚</strong></p><h4><span id="5æ€»ç»“">5.æ€»ç»“:</span></h4><p>ä½¿ç”¨errorgroup.Groupæ—¶æ³¨æ„å®ƒçš„ç‰¹ç‚¹ï¼š</p><ul><li>ç»§æ‰¿äº† WaitGroup çš„åŠŸèƒ½</li><li>errgroup.Groupåœ¨å‡ºç°é”™è¯¯æˆ–è€…ç­‰å¾…ç»“æŸåéƒ½ä¼šè°ƒç”¨Contextå¯¹è±¡ çš„ cancel æ–¹æ³•åŒæ­¥å–æ¶ˆä¿¡å·ã€‚</li><li>åªæœ‰ç¬¬ä¸€ä¸ªå‡ºç°çš„é”™è¯¯æ‰ä¼šè¢«è¿”å›ï¼Œå‰©ä½™çš„é”™è¯¯éƒ½ä¼šè¢«ç›´æ¥æŠ›å¼ƒã€‚</li><li>context ä¿¡å·ä¼ æ’­ï¼šå¦‚æœå­ä»»åŠ¡ goroutine ä¸­æœ‰å¾ªç¯é€»è¾‘ï¼Œåˆ™å¯ä»¥æ·»åŠ  ctx.Done é€»è¾‘ï¼Œæ­¤æ—¶é€šè¿‡ context çš„å–æ¶ˆä¿¡å·ï¼Œæå‰ç»“æŸå­ä»»åŠ¡æ‰§è¡Œã€‚</li></ul><p>.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;&#92;blog&#92;assets&#92;css&#92;APlayer.min.css&quot;&gt;&lt;script src=&quot;&#92;blog&#92;assets&#92;js&#92;APlayer.m</summary>
      
    
    
    
    <category term="GOLANG" scheme="https://smartxia.github.io/blog/categories/GOLANG/"/>
    
    
    <category term="error.group" scheme="https://smartxia.github.io/blog/tags/error-group/"/>
    
  </entry>
  
  <entry>
    <title>k8s-kubeadminå®‰è£…</title>
    <link href="https://smartxia.github.io/blog/2024/03/18/tech/devops/k8s/k8s-1-kubeadmin%E5%AE%89%E8%A3%85/"/>
    <id>https://smartxia.github.io/blog/2024/03/18/tech/devops/k8s/k8s-1-kubeadmin%E5%AE%89%E8%A3%85/</id>
    <published>2024-03-18T03:30:15.000Z</published>
    <updated>2024-04-12T02:34:54.583Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\blog\assets\css\APlayer.min.css"><script src="\blog\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\blog\assets\js\Meting.min.js"></script><p>é€šè¿‡kubeadmå·¥å…·ï¼Œéƒ¨ç½²k8sé›†ç¾¤ã€‚æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li><p>å‡†å¤‡å·¥ä½œï¼š</p></li><li><ol><li>é…ç½®yumæºï¼Œrepo(é˜²è¢«å¢™)</li><li>å®‰è£…å¸¸ç”¨å·¥å…·ï¼ŒåŒæ­¥æ—¶é—´</li><li>å…³é—­é˜²ç«å¢™ï¼Œå°†SELinuxé…ç½®ä¸ºPermissiveæ¨¡å¼ï¼Œå…³é—­swap</li><li>åŠ è½½ipvsæ¨¡å—ï¼Œä¼˜åŒ–å†…æ ¸</li></ol></li><li><p>åœ¨æ‰€æœ‰æœºå™¨ä¸Šå®‰è£…docker</p></li><li><p>åœ¨æ‰€æœ‰æœºå™¨ä¸Šå®‰è£…kubeadm, kubelet, kubectl</p></li><li><p>éƒ¨ç½²é›†ç¾¤MasterèŠ‚ç‚¹</p></li><li><p>éƒ¨ç½²é›†ç¾¤å·¥ä½œèŠ‚ç‚¹</p></li><li><p>å®‰è£…CNIç½‘ç»œæ’ä»¶</p></li></ol><ul><li>ä¸€ä¸ªKubernetesé›†ç¾¤MasterèŠ‚ç‚¹ã€‚k8så®˜ç½‘ç°åœ¨å°†masterèŠ‚ç‚¹ç§°ä¸ºcontrol plane node(æ§åˆ¶å¹³é¢èŠ‚ç‚¹)</li><li>ä¸€ä¸ªKubernetesé›†ç¾¤SlaveèŠ‚ç‚¹ã€‚k8så®˜ç½‘å«worker node(å·¥ä½œèŠ‚ç‚¹)ã€‚ä¸‹æ–‡ä¸­SlaveèŠ‚ç‚¹å’Œå·¥ä½œèŠ‚ç‚¹å«ä¹‰å«ä¹‰ç›¸åŒã€‚</li></ul><table><thead><tr><th>hostname</th><th>ip</th><th>å¤‡æ³¨</th><th></th></tr></thead><tbody><tr><td>master</td><td>master.k8s</td><td>192.168.246.133</td><td>k8sä¸»èŠ‚ç‚¹(control plane node)</td></tr><tr><td>slave</td><td>slave.k8s</td><td>192.168.246.132</td><td>k8s å·¥ä½œèŠ‚ç‚¹(worker node)</td></tr></tbody></table><h2><span id="0-ç³»ç»Ÿè¦æ±‚">0. <strong>ç³»ç»Ÿè¦æ±‚</strong></span></h2><p>å®‰è£…ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ“ä½œç³»ç»Ÿæ»¡è¶³å¦‚ä¸‹è¦æ±‚ï¼š</p><ol><li>Linuxå†…æ ¸æ“ä½œç³»ç»Ÿï¼Œå¦‚CentOSï¼ŒUbuntuç­‰</li><li>è‡³å°‘2 CPUï¼Œ 2GB</li><li>é›†ç¾¤ä¸­æ‰€æœ‰æœºå™¨ä¹‹é—´çš„ç½‘ç»œå¿…é¡»æ˜¯é€šçš„(å…¬å…±æˆ–ç§æœ‰ç½‘ç»œéƒ½å¯ä»¥)ã€‚</li><li>æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰å”¯ä¸€çš„ä¸»æœºåã€MACåœ°å€å’Œproduct_uuid</li><li>éƒ¨ç½²æ—¶è¦ä¿è¯èƒ½è¿å¤–ç½‘</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># æŸ¥çœ‹æ“ä½œç³»ç»Ÿ</span></span></span><br><span class="line">cat /proc/version</span><br><span class="line">hostnamectl</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># æŸ¥çœ‹IPå’ŒMACå‘½ä»¤</span></span></span><br><span class="line">ip link</span><br><span class="line">ifconfig -a</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># æŸ¥çœ‹product_uuid</span></span></span><br><span class="line">sudo cat /sys/class/dmi/id/product_uuid</span><br></pre></td></tr></table></figure><h2><span id="1-å‡†å¤‡å·¥ä½œ"><strong>1. å‡†å¤‡å·¥ä½œ</strong></span></h2><p><strong>åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šè¿è¡Œ</strong></p><h3><span id="11-é…ç½®yumæºrepo"><strong>1.1 é…ç½®yumæºï¼Œrepo</strong></span></h3><p>ç”±äºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œä¸ºé˜²æ­¢åœ¨å®‰è£…æ—¶å‡ºç°èµ„æºä¸‹è½½å¤±è´¥çš„é—®é¢˜ï¼Œåœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šé…ç½®yumæºï¼Œrepoã€‚shellå¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">yumæº</span></span><br><span class="line">curl -o /etc/yum.repos.d/Centos-7.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker repo</span></span><br><span class="line">curl -o /etc/yum.repos.d/docker-ce.repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubernetes repo</span></span><br><span class="line">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg</span><br><span class="line">       http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¼“å­˜</span></span><br><span class="line">yum clean all &amp;&amp; yum makecache</span><br></pre></td></tr></table></figure><h3><span id="12-å®‰è£…å¸¸ç”¨çš„å·¥å…·åŒæ­¥æ—¶é—´"><strong>1.2 å®‰è£…å¸¸ç”¨çš„å·¥å…·ï¼ŒåŒæ­¥æ—¶é—´</strong></span></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum -y install tree vim wget bash-completion bash-completion-extras lrzsz net-tools sysstat iotop iftop htop unzip nc nmap telnet bc  psmisc httpd-tools ntpdate</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ—¶åŒºä¿®æ”¹,å¦‚æœ/etc/localtimeæœ‰è½¯è¿æ¥,ä¸æ˜¯Shanghai,å¯ä»¥ç›´æ¥åˆ é™¤,åœ¨è½¯é“¾æ¥</span></span><br><span class="line">ln -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br><span class="line">ntpdate ntp2.aliyun.com            # åŒæ­¥é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸Šçš„æ—¶é—´.</span><br><span class="line">/sbin/hwclock --systohc            # å†™å…¥åˆ°biosç³»ç»Ÿ    </span><br></pre></td></tr></table></figure><h3><span id="13-æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦å…³é—­å°†selinuxé…ç½®ä¸ºpermissiveæ¨¡å¼å…³é—­swap"><strong>1.3 æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦å…³é—­ï¼Œå°†SELinuxé…ç½®ä¸ºPermissiveæ¨¡å¼ï¼Œå…³é—­swap</strong></span></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€</span></span></span><br><span class="line">sudo firewall-cmd --state</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># å¦‚æœé˜²ç«å¢™æ˜¯runningï¼Œå…³é—­é˜²ç«å¢™</span></span></span><br><span class="line">sudo systemctl disable firewalld &amp;&amp; systemctl stop firewalld</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># Set SELinux to permissive mode.å°†SELinuxé…ç½®ä¸ºPermissiveæ¨¡å¼</span></span></span><br><span class="line">sudo setenforce 0</span><br><span class="line">sudo sed -i &#x27;s/^SELINUX=enforcing$/SELINUX=permissive/&#x27; /etc/selinux/config</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># ä¹Ÿå¯ä»¥ç›´æ¥å…³é—­SELinux</span></span> </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">sudo setenforce 0</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">sudo sed -ri <span class="string">&#x27;s#(SELINUX=).*#\1disabled#&#x27;</span> /etc/selinux/config</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸´æ—¶å…³é—­swapã€‚å¦‚æœä¸å…³é—­ï¼Œkubeletä¼šå¯åŠ¨å¤±è´¥</span></span><br><span class="line">sudo swapoff -a</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ°¸ä¹…é˜²æ­¢å¼€æœºè‡ªåŠ¨æŒ‚è½½swap</span></span><br><span class="line">sudo sed -i &#x27;/ swap / s/^\(.*\)$/#\1/g&#x27; /etc/fstab</span><br></pre></td></tr></table></figure><h3><span id="14-åŠ è½½ipvsæ¨¡å—ä¼˜åŒ–å†…æ ¸"><strong>1.4 åŠ è½½ipvsæ¨¡å—ï¼Œä¼˜åŒ–å†…æ ¸</strong></span></h3><p>å¦‚ä¸‹å‚æ•°ä¸ä¿®æ”¹ï¼Œä¼šå¯¼è‡´<code>kubeadm init</code>è¿è¡Œå¤±è´¥ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åŠ è½½ipvsæ¨¡å—</span></span><br><span class="line">modprobe br_netfilter</span><br><span class="line">modprobe -- ip_vs</span><br><span class="line">modprobe -- ip_vs_sh</span><br><span class="line">modprobe -- ip_vs_rr</span><br><span class="line">modprobe -- ip_vs_wrr</span><br><span class="line">modprobe -- nf_conntrack_ipv4</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">éªŒè¯ip_vsæ¨¡å—</span></span><br><span class="line">lsmod |grep ip_vs</span><br><span class="line">ip_vs_wrr              12697  0 </span><br><span class="line">ip_vs_rr               12600  0 </span><br><span class="line">ip_vs_sh               12688  0 </span><br><span class="line">ip_vs                 145458  6 ip_vs_rr,ip_vs_sh,ip_vs_wrr</span><br><span class="line">nf_conntrack          139264  2 ip_vs,nf_conntrack_ipv4</span><br><span class="line">libcrc32c              12644  3 xfs,ip_vs,nf_conntrack</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å†…æ ¸æ–‡ä»¶</span> </span><br><span class="line">cat &lt;&lt;EOF &gt;  /etc/sysctl.d/k8s.conf</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.ipv4.ip_forward=1</span><br><span class="line">vm.max_map_count=262144</span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç”Ÿæ•ˆå¹¶éªŒè¯å†…æ ¸ä¼˜åŒ–</span></span><br><span class="line">sysctl -p /etc/sysctl.d/k8s.conf</span><br></pre></td></tr></table></figure><h2><span id="2-å®‰è£…docker"><strong>2. å®‰è£…docker</strong></span></h2><p><em>åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šè¿è¡Œ</em></p><h3><span id="21-å®‰è£…å¯åŠ¨docker"><strong>2.1 å®‰è£…å¯åŠ¨docker</strong></span></h3><p>æ³¨æ„ï¼šå®‰è£…dockeréœ€è¦rootæƒé™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 1. yum å®‰è£…</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># è¿è¡Œsudo yum install docker-ce ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œdocker-ceä¾èµ–äº†docker-ce-cli, containerd.io, docker-buildx-plugin, docker-compose-pluginã€‚è¿™äº›ä¾èµ–ä¼šåŒæ­¥install</span></span></span><br><span class="line">yum install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 2. é…ç½®docker</span></span></span><br><span class="line">cat &lt;&lt;EOF &gt; /etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line">    &quot;registry-mirrors&quot;: [</span><br><span class="line">        &quot;https://registry.hub.docker.com&quot;,</span><br><span class="line">        &quot;http://hub-mirror.c.163.com&quot;,</span><br><span class="line">        &quot;https://docker.mirrors.ustc.edu.cn&quot;,</span><br><span class="line">        &quot;https://registry.docker-cn.com&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125; </span><br><span class="line">EOF</span><br><span class="line">   </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 3. å¯åŠ¨docker</span></span></span><br><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure><p>éªŒè¯æ˜¯å¦å®‰è£…æ­£ç¡®</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 4. dockerè¿è¡Œæ­£å¸¸</span></span><br><span class="line">[shirley@master k8s_install]$ systemctl status docker</span><br><span class="line">â— docker.service - Docker Application Container Engine</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/docker.service; disabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Tue 2023-10-10 09:23:41 CST; 19s ago</span><br><span class="line">     Docs: https://docs.docker.com</span><br><span class="line"> Main PID: 16381 (dockerd)</span><br><span class="line">    Tasks: 8</span><br><span class="line">   Memory: 27.4M</span><br><span class="line">   CGroup: /system.slice/docker.service</span><br><span class="line">           â””â”€16381 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/con...</span><br><span class="line">[shirley@master k8s_install]$</span><br><span class="line"></span><br><span class="line"><span class="comment">## è¿è¡Œdockerå‘½ä»¤ï¼ŒéªŒè¯é•œåƒä¸‹è½½æ­£å¸¸ï¼Œå®¹å™¨è¿è¡Œæ­£å¸¸</span></span><br><span class="line">[shirley@slave k8s_install]$ sudo docker run hello-world</span><br><span class="line">Unable to find image <span class="string">&#x27;hello-world:latest&#x27;</span> locally</span><br><span class="line">latest: Pulling from library/hello-world</span><br><span class="line">719385e32844: Pull complete</span><br><span class="line">Digest: sha256:4f53e2564790c8e7856ec08e384732aa38dc43c52f02952483e3f003afbf23db</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> hello-world:latest</span><br><span class="line"></span><br><span class="line">Hello from Docker!</span><br><span class="line">This message shows that your installation appears to be working correctly.</span><br><span class="line">... ...</span><br></pre></td></tr></table></figure><h3><span id="22-é…ç½®containerdä¸­pauseé•œåƒåœ°å€"><strong>2.2 é…ç½®containerdä¸­pauseé•œåƒåœ°å€</strong></span></h3><p>ä¸ºäº†é˜²æ­¢å®‰è£…è¿‡ç¨‹ä¸­å‡ºç°pauseé•œåƒä¸‹è½½å¤±è´¥çš„é—®é¢˜ï¼Œå»ºè®®è¿è¡Œ<code>containerd config dump &gt; /etc/containerd/config.toml </code>å‘½ä»¤ï¼Œå°†å½“å‰é…ç½®å¯¼å‡ºåˆ°æ–‡ä»¶ï¼Œå¹¶ä¿®æ”¹<code>sandbox_image</code>é…ç½®ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># å¦‚æœæ²¡æœ‰/etc/containerd/config.tomlæ–‡ä»¶ï¼Œå°†é»˜è®¤é…ç½®å¯¼å‡ºåˆ°/etc/containerd/config.tomlã€‚</span></span></span><br><span class="line">containerd config default &gt; /etc/containerd/config.toml</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># ä¿®æ”¹é…ç½®æ–‡ä»¶/etc/containerd/config.tomlï¼Œ æ›´æ”¹sandbox_imageé…ç½®</span></span></span><br><span class="line">[plugins]</span><br><span class="line">  [plugins.&quot;io.containerd.grpc.v1.cri&quot;]</span><br><span class="line">    sandbox_image = &quot;registry.aliyuncs.com/google_containers/pause:3.9&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># PS: å¦‚æœç”Ÿæˆçš„/etc/containerd/config.tomlä¸­æ²¡æœ‰å¦‚ä¸Šé…ç½®é¡¹ï¼Œå¯ä»¥è¿è¡Œå¦‚ä¸‹å‘½ä»¤å¯¼å‡ºå½“å‰æ‰€æœ‰é…ç½®é¡¹åå†ä¿®æ”¹æ–‡ä»¶/etc/containerd/config.toml</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">containerd config dump &gt; /etc/containerd/config.toml</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># é‡å¯containerd</span></span></span><br><span class="line">systemctl restart containerd</span><br></pre></td></tr></table></figure><h2><span id="3-éƒ¨ç½²kubeadm-kubelet-kubectl"><strong>3. éƒ¨ç½²kubeadm, kubelet, kubectl</strong></span></h2><p>kubeadmï¼šå¯åŠ¨k8sé›†ç¾¤çš„å·¥å…·</p><p>kubelet: è¯¥ç»„ä»¶åœ¨é›†ç¾¤ä¸­çš„æ‰€æœ‰æœºå™¨ä¸Šè¿è¡Œï¼Œå¹¶æ‰§è¡Œå¯åŠ¨podå’Œå®¹å™¨ä¹‹ç±»çš„ä»»åŠ¡ã€‚</p><p>kubectl: ä¸é›†ç¾¤é€šä¿¡çš„å·¥å…·ã€‚å¯ä»¥åªåœ¨masterèŠ‚ç‚¹ä¸Šå®‰è£…ã€‚</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes</span><br><span class="line"></span><br><span class="line">## å¼€æœºå¯åŠ¨kubelet</span><br><span class="line">sudo systemctl enable --now kubelet</span><br></pre></td></tr></table></figure><p>éªŒè¯</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹kubeadmç‰ˆæœ¬</span></span><br><span class="line">[root@master ~]<span class="comment"># sudo kubeadm version</span></span><br><span class="line">kubeadm version: &amp;version.Info&#123;Major:<span class="string">&quot;1&quot;</span>, Minor:<span class="string">&quot;28&quot;</span>, GitVersion:<span class="string">&quot;v1.28.2&quot;</span>, GitCommit:<span class="string">&quot;89a4ea3e1e4ddd7f7572286090359983e0387b2f&quot;</span>, GitTreeState:<span class="string">&quot;clean&quot;</span>, BuildDate:<span class="string">&quot;2023-09-13T09:34:32Z&quot;</span>, GoVersion:<span class="string">&quot;go1.20.8&quot;</span>, Compiler:<span class="string">&quot;gc&quot;</span>, Platform:<span class="string">&quot;linux/amd64&quot;</span>&#125;</span><br></pre></td></tr></table></figure><h2><span id="4-åˆå§‹åŒ–masterèŠ‚ç‚¹kubeadm-init"><strong>4.</strong> åˆå§‹åŒ–MasterèŠ‚ç‚¹ï¼ˆkubeadm initï¼‰</span></h2><p><em>åœ¨MasterèŠ‚ç‚¹è¿è¡Œ</em></p><h3><span id="41-æ›´æ”¹é…ç½®æ–‡ä»¶"><strong>4.1. æ›´æ”¹é…ç½®æ–‡ä»¶</strong></span></h3><p><code>kubeadm init</code>å‘½ä»¤ç”¨äºåˆå§‹åŒ–masterèŠ‚ç‚¹ã€‚kubeadm init çš„å‚æ•°å¯ä»¥é€šè¿‡<strong>å‘½ä»¤è¡Œ</strong>æˆ–<strong>yamlæ–‡ä»¶</strong>è¿›è¡Œé…ç½®ã€‚æœ¬æ–‡ä»‹ç»å¦‚ä½•é€šè¿‡yamlæ–‡ä»¶è¿›è¡Œé…ç½®ã€‚å¯ä»¥é€šè¿‡<code>kubeadm config print init-defaults</code>å‘½ä»¤å¾—åˆ°ä¸€ä»½é»˜è®¤é…ç½®ï¼Œç„¶åå¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm config <span class="built_in">print</span> init-defaults &gt; kubeadm.yaml</span><br></pre></td></tr></table></figure><p>å¯¹kubeadm.yamlè¿›è¡Œç¼–è¾‘ï¼Œä¿®æ”¹å†…å®¹å¦‚ä¸‹ï¼š</p><ol><li>ä¿®æ”¹<code>advertiseAddress</code>ä¸ºmaster IPåœ°å€</li><li><code>imageRepository</code>ä¿®æ”¹ä¸º<code>registry.aliyuncs.com/google_containers</code>ï¼Œé˜²æ­¢é•œåƒæ‹‰ä¸ä¸‹æ¥</li><li>å»ºè®®å°†<code>networking.podSubnet</code>ä¿®æ”¹ä¸º<code>10.244.0.0/16</code>ï¼Œ å’Œåç»­å®‰è£…çš„flannel CNI æ’ä»¶çš„é»˜è®¤é…ç½®ä¿æŒä¸€è‡´ã€‚</li></ol><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: kubeadm.k8s.io/v1beta3</span><br><span class="line">bootstrapTokens:</span><br><span class="line">- groups:</span><br><span class="line">  - system:bootstrappers:kubeadm:default-node-token</span><br><span class="line">  token: abcdef.0123456789abcdef</span><br><span class="line">  ttl: 24h0m0s</span><br><span class="line">  usages:</span><br><span class="line">  - signing</span><br><span class="line">  - authentication</span><br><span class="line">kind: InitConfiguration</span><br><span class="line">localAPIEndpoint:</span><br><span class="line">  advertiseAddress: 192.168.246.133    ## change the IP of apiserver.</span><br><span class="line">  bindPort: 6443</span><br><span class="line">nodeRegistration:</span><br><span class="line">  criSocket: unix:///var/run/containerd/containerd.sock</span><br><span class="line">  imagePullPolicy: IfNotPresent</span><br><span class="line">  name: node</span><br><span class="line">  taints: null</span><br><span class="line">---</span><br><span class="line">apiServer:</span><br><span class="line">  timeoutForControlPlane: 4m0s</span><br><span class="line">apiVersion: kubeadm.k8s.io/v1beta3</span><br><span class="line">certificatesDir: /etc/kubernetes/pki</span><br><span class="line">clusterName: kubernetes</span><br><span class="line">controllerManager: &#123;&#125;</span><br><span class="line">dns: &#123;&#125;</span><br><span class="line">etcd:</span><br><span class="line">  local:</span><br><span class="line">    dataDir: /var/lib/etcd</span><br><span class="line">imageRepository: registry.aliyuncs.com/google_containers   ## change imageRepository to aliyun.</span><br><span class="line">kind: ClusterConfiguration</span><br><span class="line">kubernetesVersion: 1.28.0</span><br><span class="line">networking:</span><br><span class="line">  dnsDomain: cluster.local</span><br><span class="line">  podSubnet: 10.244.0.0/16  ## add this line to config POD network. Same with CNI config.</span><br><span class="line">  serviceSubnet: 10.96.0.0/12</span><br><span class="line">scheduler: &#123;&#125;</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šé…ç½®æ–‡ä»¶ç­‰ä»·äºå‘½ä»¤è¡Œï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kubeadm init \</span><br><span class="line">  --apiserver-advertise-address=192.168.246.133 \</span><br><span class="line">  --image-repository registry.aliyuncs.com/google_containers \</span><br><span class="line">  --kubernetes-version v1.28.0 \</span><br><span class="line">  --service-cidr=10.96.0.0/12 \</span><br><span class="line">  --pod-network-cidr=10.244.0.0/16 </span><br></pre></td></tr></table></figure><ul><li>â€“apiserver-advertise-address é›†ç¾¤é€šå‘Šåœ°å€</li><li>â€“image-repository ç”±äºé»˜è®¤æ‹‰å–é•œåƒåœ°å€<a href="https://link.zhihu.com/?target=http://k8s.gcr.io">http://k8s.gcr.io</a>å›½å†…æ— æ³•è®¿é—®ï¼Œè¿™é‡ŒæŒ‡å®šé˜¿é‡Œäº‘é•œåƒä»“åº“åœ°å€</li><li>â€“kubernetes-version K8sç‰ˆæœ¬ï¼Œä¸ä¸Šé¢å®‰è£…çš„ä¸€è‡´</li><li>â€“service-cidr é›†ç¾¤å†…éƒ¨è™šæ‹Ÿç½‘ç»œï¼ŒPodç»Ÿä¸€è®¿é—®å…¥å£</li><li>â€“pod-network-cidr Podç½‘ç»œï¼Œ<strong>ä¸ä¸‹é¢éƒ¨ç½²çš„CNIç½‘ç»œç»„ä»¶yamlä¸­ä¿æŒä¸€è‡´</strong></li></ul><h3><span id="42-æå‰pullé•œåƒå¯é€‰"><strong>4.2 æå‰pullé•œåƒï¼ˆå¯é€‰ï¼‰</strong></span></h3><p>ä¸ºäº†ä½¿åç»­å®‰è£…æ›´å¿«ï¼Œå»ºè®®å…ˆæŠŠå®‰è£…éœ€è¦çš„é•œåƒpullä¸‹æ¥ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## éªŒè¯é…ç½®æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®</span></span><br><span class="line">[shirley@master k8s_install]$ kubeadm config validate --config kubeadm.yaml</span><br><span class="line">ok</span><br><span class="line"></span><br><span class="line"><span class="comment">## æŸ¥çœ‹éœ€è¦ä¸‹è½½å“ªäº›é•œåƒã€‚éœ€è¦å…³æ³¨ä¸‹è½½çš„repositoryåœ°å€æ˜¯å¦æ­£ç¡®ã€‚</span></span><br><span class="line"><span class="comment">## å¦‚ä¸Šåœ¨kubeadm.yamlæ–‡ä»¶é…ç½®äº†imageRepositoryï¼šregistry.aliyuncs.com/google_containersï¼Œå› æ­¤imagesä¼šä»aliyunçš„repoä¸‹è½½ã€‚</span></span><br><span class="line">[shirley@master k8s_install]$ kubeadm config images list --config kubeadm.yaml</span><br><span class="line">registry.aliyuncs.com/google_containers/kube-apiserver:v1.28.0</span><br><span class="line">registry.aliyuncs.com/google_containers/kube-controller-manager:v1.28.0</span><br><span class="line">registry.aliyuncs.com/google_containers/kube-scheduler:v1.28.0</span><br><span class="line">registry.aliyuncs.com/google_containers/kube-proxy:v1.28.0</span><br><span class="line">registry.aliyuncs.com/google_containers/pause:3.9</span><br><span class="line">registry.aliyuncs.com/google_containers/etcd:3.5.9-0</span><br><span class="line">registry.aliyuncs.com/google_containers/coredns:v1.10.1</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="comment">## pullé•œåƒã€‚pullé•œåƒæœ‰ç‚¹æ…¢ï¼Œç¬¬ä¸€ä¸ªé•œåƒpullæˆåŠŸåæ‰æœ‰æ—¥å¿—è¾“å‡ºã€‚å‘½ä»¤è¿è¡Œåå‘ç°æ²¡æœ‰æ—¥å¿—ä¸è¦ç€æ€¥ï¼Œå¤šç­‰ä¸€ä¼šã€‚</span></span><br><span class="line">[shirley@master k8s_install]$ sudo kubeadm config images pull --config kubeadm.yaml</span><br><span class="line">[config/images] Pulled registry.aliyuncs.com/google_containers/kube-apiserver:v1.28.0</span><br><span class="line">[config/images] Pulled registry.aliyuncs.com/google_containers/kube-controller-manager:v1.28.0</span><br><span class="line">[config/images] Pulled registry.aliyuncs.com/google_containers/kube-scheduler:v1.28.0</span><br><span class="line">[config/images] Pulled registry.aliyuncs.com/google_containers/kube-proxy:v1.28.0</span><br><span class="line">[config/images] Pulled registry.aliyuncs.com/google_containers/pause:3.9</span><br><span class="line">[config/images] Pulled registry.aliyuncs.com/google_containers/etcd:3.5.9-0</span><br><span class="line">[config/images] Pulled registry.aliyuncs.com/google_containers/coredns:v1.10.1</span><br></pre></td></tr></table></figure><h3><span id="43-kubeadm-initåˆå§‹åŒ–"><strong>4.3 kubeadm initåˆå§‹åŒ–</strong></span></h3><p>è¿è¡Œ<code>kubeadm init --config kubeadm.yaml</code>ï¼Œ å½“çœ‹åˆ°<code>Your Kubernetes control-plane has initialized successfully!</code>æ—¶è¡¨ç¤ºå®‰è£…æˆåŠŸã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@master k8s_install]<span class="comment"># kubeadm init --config kubeadm.yaml</span></span><br><span class="line">... ...</span><br><span class="line">Your Kubernetes control-plane has initialized successfully!</span><br><span class="line"></span><br><span class="line">To start using your cluster, you need to run the following as a regular user:</span><br><span class="line"></span><br><span class="line">  <span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">  sudo <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">  sudo <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line">Alternatively, <span class="keyword">if</span> you are the root user, you can run:</span><br><span class="line"></span><br><span class="line">  <span class="built_in">export</span> KUBECONFIG=/etc/kubernetes/admin.conf</span><br><span class="line"></span><br><span class="line">You should now deploy a pod network to the cluster.</span><br><span class="line">Run <span class="string">&quot;kubectl apply -f [podnetwork].yaml&quot;</span> with one of the options listed at:</span><br><span class="line">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class="line"></span><br><span class="line">Then you can <span class="built_in">join</span> any number of worker nodes by running the following on each as root:</span><br><span class="line"></span><br><span class="line">kubeadm <span class="built_in">join</span> 192.168.246.133:6443 --token abcdef.0123456789abcdef \</span><br><span class="line">        --discovery-token-ca-cert-hash sha256:9f7d37c768e658119242dfb49675eaeb3cbdbb7d191526bfa197dd92373b40ab</span><br></pre></td></tr></table></figure><p><strong>PSï¼šæœ€å¥½å°†æœ€åä¸€è¡Œlogéœ€è¦è®°ä¸‹æ¥ï¼ŒworkerèŠ‚ç‚¹å®‰è£…ä¼šç”¨åˆ°ã€‚</strong></p><p>æ ¹æ®æç¤ºï¼Œé€€å‡ºrootè´¦æˆ·åè¿è¡Œå‘½ä»¤</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">sudo <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">sudo <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br></pre></td></tr></table></figure><h3><span id="44-éªŒè¯"><strong>4.4 éªŒè¯</strong></span></h3><p>éªŒè¯masterèŠ‚ç‚¹æ˜¯å¦éƒ¨ç½²æˆåŠŸã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## kubectl è¿è¡Œæ­£å¸¸. STATUS=NotReadyæ˜¯å› ä¸ºCNIæ’ä»¶è¿˜æ²¡è£…ã€‚</span></span><br><span class="line">[shirley@master k8s_install]$ kubectl get node</span><br><span class="line">NAME   STATUS     ROLES           AGE   VERSION</span><br><span class="line">node   NotReady   control-plane   20m   v1.28.2</span><br><span class="line"></span><br><span class="line"><span class="comment">## é€šè¿‡crictlå‘½ä»¤å¯ä»¥æŸ¥çœ‹åˆ°è¿è¡Œçš„container</span></span><br><span class="line">[shirley@master k8s_install]$ sudo crictl ps -a</span><br><span class="line">CONTAINER           IMAGE               CREATED             STATE               NAME                      ATTEMPT             POD ID              POD</span><br><span class="line">955b0c87ad621       ea1030da44aa1       26 minutes ago      Running             kube-proxy                0                   78efbee65dfac       kube-proxy-kp9kw</span><br><span class="line">f69d8c3246904       73deb9a3f7025       26 minutes ago      Running             etcd                      0                   77180bc7ff0a8       etcd-node</span><br><span class="line">3efba65f263d3       f6f496300a2ae       26 minutes ago      Running             kube-scheduler            0                   f89fb4bb60e2e       kube-scheduler-node</span><br><span class="line">5dfb28390f30b       4be79c38a4bab       26 minutes ago      Running             kube-controller-manager   0                   b716cb4652e1c       kube-controller-manager-node</span><br><span class="line">b8cfce31fa842       bb5e0dde9054c       26 minutes ago      Running             kube-apiserver            0                   006db1ce43cfe       kube-apiserver-node</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰å¤§å®¶å¯èƒ½æœ‰ä¸ªç–‘æƒ‘ï¼Œä¸ºä»€ä¹ˆdocker psçœ‹ä¸åˆ°è¿è¡Œçš„å®¹å™¨</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## è¿è¡Œdockerå‘½ä»¤ï¼Œå‘ç°æ²¡æœ‰container</span></span><br><span class="line">[shirley@master k8s_install]$ sudo docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸ºkubernetesä½¿ç”¨çš„containerdä½œä¸ºå®¹å™¨è¿è¡Œæ—¶ï¼Œè€Œä¸æ˜¯Docker engine. kubernetesæ”¯æŒ4ä¸­å®¹å™¨è¿è¡Œæ—¶ï¼š</p><table><thead><tr><th>Runtime</th><th>Path to Unix domain socketï¼ˆCRI socketï¼‰</th></tr></thead><tbody><tr><td>containerd</td><td>unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;containerd&#x2F;containerd.sock</td></tr><tr><td>CRI-O</td><td>unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;crio&#x2F;crio.sock</td></tr><tr><td>Docker Engine (using cri-dockerd)</td><td>unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;cri-dockerd.sock</td></tr><tr><td>Mirantis Container Runtime (MCR)(using cri-dockerd)</td><td>unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;cri-dockerd.sock</td></tr></tbody></table><p>By default, Kubernetes uses the Container Runtime Interface (CRI) to interface with your chosen container runtime.</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œkubernetesä¼šç”¨CRIæ‰¾åˆ°é€‰æ‹©çš„å®¹å™¨è¿è¡Œæ—¶ã€‚åœ¨æˆ‘ä»¬å®‰è£…dockeræ—¶ï¼Œå®‰è£…äº†containerdï¼Œå› æ­¤k8sæ‰¾åˆ°äº†containerdä½œä¸ºå®¹å™¨è¿è¡Œæ—¶ã€‚åœ¨kubeadm.yamæ–‡ä»¶ä¸­ä¹Ÿèƒ½çœ‹åˆ°ç›¸åº”çš„é…ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nodeRegistration:</span><br><span class="line">  criSocket: unix:///var/run/containerd/containerd.sock</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆk8sä¸é€‰ç”¨docker engineä½œä¸ºå®¹å™¨è¿è¡Œæ—¶ï¼Ÿå› ä¸ºå¦‚æœä½¿ç”¨docker engine, è¿˜éœ€è¦å®‰è£…cri-dockerdï¼Œæ‰èƒ½ä½œä¸ºå®¹å™¨æ—¶è¢«k8sè¯†åˆ«ã€‚è€Œå¦‚ä¸Šæ“ä½œå¹¶æœªå®‰è£…ã€‚</p><p>æ­¤å¤–ï¼Œk8sæ¨èç›´æ¥ä½¿ç”¨containerdä½œä¸ºå®¹å™¨è¿è¡Œæ—¶ã€‚</p><h2><span id="5-åˆå§‹åŒ–å·¥ä½œèŠ‚ç‚¹"><strong>5. åˆå§‹åŒ–å·¥ä½œèŠ‚ç‚¹</strong></span></h2><h3><span id="51-è¿è¡Œkubeadm-joinå°†å·¥ä½œèŠ‚ç‚¹åŠ å…¥é›†ç¾¤"><strong>5.1 è¿è¡Œkubeadm joinå°†å·¥ä½œèŠ‚ç‚¹åŠ å…¥é›†ç¾¤</strong></span></h3><p>åœ¨masterèŠ‚ç‚¹kubeadm initå®‰è£…å®Œæˆåï¼Œä¼šæœ‰å¦‚ä¸‹ç±»ä¼¼log</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.. ... </span><br><span class="line">Then you can <span class="built_in">join</span> any number of worker nodes by running the following on each as root:</span><br><span class="line"></span><br><span class="line">kubeadm <span class="built_in">join</span> 192.168.246.133:6443 --token abcdef.0123456789abcdef \</span><br><span class="line">        --discovery-token-ca-cert-hash sha256:9f7d37c768e658119242dfb49675eaeb3cbdbb7d191526bfa197dd92373b40ab</span><br></pre></td></tr></table></figure><p>å°†ä¸Šè¿°å‘½ä»¤ç²˜è´´åˆ°å·¥ä½œèŠ‚ç‚¹ï¼Œå°†å·¥ä½œèŠ‚ç‚¹æ·»åŠ åˆ°é›†ç¾¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@slave ~]# kubeadm join 192.168.246.133:6443 --token abcdef.0123456789abcdef \</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">        --discovery-token-ca-cert-hash sha256:9f7d37c768e658119242dfb49675eaeb3cbdbb7d191526bfa197dd92373b40ab</span></span><br><span class="line">[preflight] Running pre-flight checks</span><br><span class="line">        [WARNING Hostname]: hostname &quot;slave.k8s&quot; could not be reached</span><br><span class="line">        [WARNING Hostname]: hostname &quot;slave.k8s&quot;: lookup slave.k8s on 192.168.246.2:53: no such host</span><br><span class="line">[preflight] Reading configuration from the cluster...</span><br><span class="line">[preflight] FYI: You can look at this config file with &#x27;kubectl -n kube-system get cm kubeadm-config -o yaml&#x27;</span><br><span class="line">[kubelet-start] Writing kubelet configuration to file &quot;/var/lib/kubelet/config.yaml&quot;</span><br><span class="line">[kubelet-start] Writing kubelet environment file with flags to file &quot;/var/lib/kubelet/kubeadm-flags.env&quot;</span><br><span class="line">[kubelet-start] Starting the kubelet</span><br><span class="line">[kubelet-start] Waiting for the kubelet to perform the TLS Bootstrap...</span><br><span class="line"></span><br><span class="line">This node has joined the cluster:</span><br><span class="line">* Certificate signing request was sent to apiserver and a response was received.</span><br><span class="line">* The Kubelet was informed of the new secure connection details.</span><br><span class="line"></span><br><span class="line">Run &#x27;kubectl get nodes&#x27; on the control-plane to see this node join the cluster.</span><br></pre></td></tr></table></figure><h3><span id="52-éªŒè¯"><strong>5.2 éªŒè¯</strong></span></h3><p>åˆ°masterèŠ‚ç‚¹è¿è¡Œkubelet get node,å¯ä»¥çœ‹åˆ°åŠ è¿›æ¥çš„node</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[shirley@master k8s_install]$ kubectl get nodes</span><br><span class="line">NAME        STATUS     ROLES           AGE    VERSION</span><br><span class="line">node        NotReady   control-plane   121m   v1.28.2</span><br><span class="line">slave.k8s   NotReady   &lt;none&gt;          28s    v1.28.2</span><br></pre></td></tr></table></figure><p>å½“å‰STATUSéƒ½æ˜¯NotReadyï¼Œè¿™æ˜¯å› ä¸ºè¿˜æ²¡æœ‰å®‰è£…ç½‘ç»œæ’ä»¶CNI</p><h3><span id="53-å¿˜è®°tokenæ€ä¹ˆåŠ"><strong>5.3 å¿˜è®°tokenæ€ä¹ˆåŠ</strong></span></h3><p>å¦‚æœmasterèŠ‚ç‚¹å®‰è£…æ—¶ï¼Œæ²¡æœ‰è®°å½•ä¸‹tokenï¼Œæˆ–tokenè¶…æ—¶(é»˜è®¤24å°æ—¶)ï¼Œå¯ä»¥è¿è¡Œå¦‚ä¸‹å‘½ä»¤é‡æ–°ç”Ÿæˆ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[shirley@master k8s_install]$ kubeadm token create --print-join-command</span><br><span class="line">kubeadm join 192.168.246.133:6443 --token by8q23.65btteq9iud7ypso --discovery-token-ca-cert-hash sha256:9f7d37c768e658119242dfb49675eaeb3cbdbb7d191526bfa197dd92373b40ab</span><br></pre></td></tr></table></figure><h2><span id="6-å®‰è£…cniç½‘ç»œæ’ä»¶"><strong>6. å®‰è£…CNIç½‘ç»œæ’ä»¶</strong></span></h2><p>Kubernetes å®ƒéœ€è¦ç½‘ç»œæ’ä»¶æ¥æä¾›é›†ç¾¤å†…éƒ¨å’Œé›†ç¾¤å¤–éƒ¨çš„ç½‘ç»œé€šä¿¡ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„ k8s ç½‘ç»œæ’ä»¶ï¼š</p><ul><li>Flannelï¼šFlannel æ˜¯æœ€å¸¸ç”¨çš„ k8s ç½‘ç»œæ’ä»¶ä¹‹ä¸€ï¼Œå®ƒä½¿ç”¨äº†è™šæ‹Ÿç½‘ç»œæŠ€æœ¯æ¥å®ç°å®¹å™¨ä¹‹é—´çš„é€šä¿¡ï¼Œæ”¯æŒå¤šç§ç½‘ç»œåç«¯ï¼Œå¦‚ VXLANã€UDP å’Œ Host-GWã€‚</li><li>Calicoï¼šCalico æ˜¯ä¸€ç§åŸºäº BGP çš„ç½‘ç»œæ’ä»¶ï¼Œå®ƒä½¿ç”¨è·¯ç”±è¡¨æ¥è·¯ç”±å®¹å™¨ä¹‹é—´çš„æµé‡ï¼Œæ”¯æŒå¤šç§ç½‘ç»œæ‹“æ‰‘ç»“æ„ï¼Œå¹¶æä¾›äº†å®‰å…¨æ€§å’Œç½‘ç»œç­–ç•¥åŠŸèƒ½ã€‚</li><li>Canalï¼šCanal æ˜¯ä¸€ä¸ªç»„åˆäº† Flannel å’Œ Calico çš„ç½‘ç»œæ’ä»¶ï¼Œå®ƒä½¿ç”¨ Flannel æ¥æä¾›å®¹å™¨ä¹‹é—´çš„é€šä¿¡ï¼ŒåŒæ—¶ä½¿ç”¨ Calico æ¥æä¾›ç½‘ç»œç­–ç•¥å’Œå®‰å…¨æ€§åŠŸèƒ½ã€‚</li><li>Weave Netï¼šWeave Net æ˜¯ä¸€ç§è½»é‡çº§çš„ç½‘ç»œæ’ä»¶ï¼Œå®ƒä½¿ç”¨è™šæ‹Ÿç½‘ç»œæŠ€æœ¯æ¥ä¸ºå®¹å™¨æä¾› IP åœ°å€ï¼Œå¹¶æ”¯æŒå¤šç§ç½‘ç»œåç«¯ï¼Œå¦‚ VXLANã€UDP å’Œ TCP&#x2F;IPï¼ŒåŒæ—¶è¿˜æä¾›äº†ç½‘ç»œç­–ç•¥å’Œå®‰å…¨æ€§åŠŸèƒ½ã€‚</li><li>Ciliumï¼šCilium æ˜¯ä¸€ç§åŸºäº eBPF (Extended Berkeley Packet Filter) æŠ€æœ¯çš„ç½‘ç»œæ’ä»¶ï¼Œå®ƒä½¿ç”¨ Linux å†…æ ¸çš„åŠ¨æ€æ’ä»¶æ¥æä¾›ç½‘ç»œåŠŸèƒ½ï¼Œå¦‚è·¯ç”±ã€è´Ÿè½½å‡è¡¡ã€å®‰å…¨æ€§å’Œç½‘ç»œç­–ç•¥ç­‰ã€‚</li><li>Contivï¼šContiv æ˜¯ä¸€ç§åŸºäº SDN æŠ€æœ¯çš„ç½‘ç»œæ’ä»¶ï¼Œå®ƒæä¾›äº†å¤šç§ç½‘ç»œåŠŸèƒ½ï¼Œå¦‚è™šæ‹Ÿç½‘ç»œã€ç½‘ç»œéš”ç¦»ã€è´Ÿè½½å‡è¡¡å’Œå®‰å…¨ç­–ç•¥ç­‰ã€‚</li><li>Antreaï¼šAntrea æ˜¯ä¸€ç§åŸºäº OVS (Open vSwitch) æŠ€æœ¯çš„ç½‘ç»œæ’ä»¶ï¼Œå®ƒæä¾›äº†å®¹å™¨ä¹‹é—´çš„é€šä¿¡ã€ç½‘ç»œç­–ç•¥å’Œå®‰å…¨æ€§ç­‰åŠŸèƒ½ï¼Œè¿˜æ”¯æŒå¤šç§ç½‘ç»œæ‹“æ‰‘ç»“æ„ã€‚</li></ul><table><thead><tr><th>æä¾›å•†</th><th>ç½‘ç»œæ¨¡å‹</th><th>è·¯çº¿åˆ†å‘</th><th>ç½‘ç»œç­–ç•¥</th><th>ç½‘æ ¼</th><th>å¤–éƒ¨æ•°æ®å­˜å‚¨</th><th>åŠ å¯†</th><th>Ingress&#x2F;Egress ç­–ç•¥</th></tr></thead><tbody><tr><td>Canal</td><td>å°è£… (VXLAN)</td><td>å¦</td><td>æ˜¯</td><td>å¦</td><td>K8s API</td><td>æ˜¯</td><td>æ˜¯</td></tr><tr><td>Flannel</td><td>å°è£… (VXLAN)</td><td>å¦</td><td>å¦</td><td>å¦</td><td>K8s API</td><td>æ˜¯</td><td>å¦</td></tr><tr><td>Calico</td><td>å°è£…ï¼ˆVXLANï¼ŒIPIPï¼‰æˆ–æœªå°è£…</td><td>æ˜¯</td><td>æ˜¯</td><td>æ˜¯</td><td>Etcd å’Œ K8s API</td><td>æ˜¯</td><td>æ˜¯</td></tr><tr><td>Weave</td><td>å°è£…</td><td>æ˜¯</td><td>æ˜¯</td><td>æ˜¯</td><td>å¦</td><td>æ˜¯</td><td>æ˜¯</td></tr><tr><td>Cilium</td><td>å°è£… (VXLAN)</td><td>æ˜¯</td><td>æ˜¯</td><td>æ˜¯</td><td>Etcd å’Œ K8s API</td><td>æ˜¯</td><td>æ˜¯</td></tr></tbody></table><p>Calico å’Œ Flanneléƒ½æ˜¯å¸¸ç”¨çš„CNIï¼Œå¦‚ä¸‹ä»‹ç»å¦‚ä½•å®‰è£…flannelç½‘ç»œæ’ä»¶</p><h3><span id="61-å®‰è£…flannelç½‘ç»œæ’ä»¶"><strong>6.1 å®‰è£…flannelç½‘ç»œæ’ä»¶</strong></span></h3><ol><li>ä¸‹è½½kube-flannel.yml</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 1. ä¸‹è½½kube-flannel.yml</span></span></span><br><span class="line">wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span><br></pre></td></tr></table></figure><p><code>kube-flannel.yaml</code>æ–‡ä»¶ä¸­ï¼Œéœ€è¦æ³¨æ„ï¼Œnet-conf.jsoné‡Œçš„networkè¦å’Œkubeadm.yamlé‡Œé…ç½®çš„networking.podSubnetç›¸åŒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">... ...</span><br><span class="line">  net-conf.json: |</span><br><span class="line">    &#123;</span><br><span class="line">      ### è¿™é‡Œçš„networkå’Œkubeadm.yamlé‡Œé…ç½®çš„networking.podSubnetç›¸åŒ </span><br><span class="line">      &quot;Network&quot;: &quot;10.244.0.0/16&quot;,</span><br><span class="line">      &quot;Backend&quot;: &#123;</span><br><span class="line">        &quot;Type&quot;: &quot;vxlan&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">... ...</span><br></pre></td></tr></table></figure><ol start="2"><li>å®¹å™¨éƒ¨ç½²flannel</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[shirley@master k8s_install]$ kubectl apply -f kube-flannel.yml</span><br><span class="line">namespace/kube-flannel created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/flannel created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/flannel created</span><br><span class="line">serviceaccount/flannel created</span><br><span class="line">configmap/kube-flannel-cfg created</span><br><span class="line">daemonset.apps/kube-flannel-ds created</span><br></pre></td></tr></table></figure><h3><span id="62-éªŒè¯cni"><strong>6.2 éªŒè¯CNI</strong></span></h3><p>å®‰è£…åï¼Œè¿è¡Œ<code>kubectl -n kube-system get pod -o wide</code>ï¼Œ å¯ä»¥çœ‹åˆ°åœ¨masterèŠ‚ç‚¹å’ŒslaveèŠ‚ç‚¹åˆ†åˆ«è¿è¡Œäº†ä¸€ä¸ªkube-proxy</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½è¿è¡Œäº†kube-proxy</span></span></span><br><span class="line">[shirley@master k8s_install]$ kubectl -n kube-system get pod -o wide</span><br><span class="line">NAME                           READY   STATUS    RESTARTS   AGE     IP                NODE        NOMINATED NODE   READINESS GATES</span><br><span class="line">coredns-66f779496c-d8rws       1/1     Running   0          4h40m   10.244.0.3        node        &lt;none&gt;           &lt;none&gt;</span><br><span class="line">coredns-66f779496c-fzmjm       1/1     Running   0          4h40m   10.244.0.2        node        &lt;none&gt;           &lt;none&gt;</span><br><span class="line">etcd-node                      1/1     Running   0          4h41m   192.168.246.133   node        &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-apiserver-node            1/1     Running   0          4h41m   192.168.246.133   node        &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-controller-manager-node   1/1     Running   0          4h41m   192.168.246.133   node        &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-proxy-bpv8d               1/1     Running   0          160m    192.168.246.132   slave.k8s   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-proxy-kp9kw               1/1     Running   0          4h40m   192.168.246.133   node        &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-scheduler-node            1/1     Running   0          4h41m   192.168.246.133   node        &lt;none&gt;           &lt;none&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># nodeçŠ¶æ€æ˜¾ç¤ºä¸ºReady</span></span></span><br><span class="line">[shirley@master k8s_install]$ kubectl get node</span><br><span class="line">NAME        STATUS   ROLES           AGE     VERSION</span><br><span class="line">node        Ready    control-plane   4h38m   v1.28.2</span><br><span class="line">slave.k8s   Ready    &lt;none&gt;          158m    v1.28.2</span><br></pre></td></tr></table></figure><p>è‡ªæ­¤ï¼Œé›†ç¾¤æ­å»ºå®Œæˆã€‚</p><h2><span id="å…¶ä»–è¯´æ˜"><strong>å…¶ä»–è¯´æ˜</strong></span></h2><p>å¦å¤–ï¼Œåœ¨åˆå§‹å®‰è£…çš„MasterèŠ‚ç‚¹ä¸Šä¹Ÿå¯åŠ¨äº†<code>kubelet</code>å’Œ<code>kube-proxy</code>ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹å¹¶ä¸å‚ä¸å·¥ä½œè´Ÿè½½çš„è°ƒåº¦ã€‚å¦‚æœå¸Œæœ›MasterèŠ‚ç‚¹ä¹Ÿä½œä¸ºNodeè§’è‰²ï¼Œåˆ™å¯ä»¥è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼ˆåˆ é™¤MasterèŠ‚ç‚¹çš„ï¼š<code>node-role.kubernetes.io/control-plane:NoSchedule</code>ï¼‰ï¼Œè®©MasterèŠ‚ç‚¹ä¹Ÿæˆä¸ºä¸€ä¸ªNodeï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl taint nodes --all node-role.kubernetes.io/control-plane-</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;&#92;blog&#92;assets&#92;css&#92;APlayer.min.css&quot;&gt;&lt;script src=&quot;&#92;blog&#92;assets&#92;js&#92;APlayer.m</summary>
      
    
    
    
    <category term="k8s" scheme="https://smartxia.github.io/blog/categories/k8s/"/>
    
    
    <category term="k8s" scheme="https://smartxia.github.io/blog/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>k8s-IPVSæ¦‚å¿µåŸç†ä»¥åŠåº”ç”¨</title>
    <link href="https://smartxia.github.io/blog/2024/03/18/tech/devops/k8s/K8s-2-IPVS%E6%A6%82%E5%BF%B5%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E5%BA%94%E7%94%A8/"/>
    <id>https://smartxia.github.io/blog/2024/03/18/tech/devops/k8s/K8s-2-IPVS%E6%A6%82%E5%BF%B5%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E5%BA%94%E7%94%A8/</id>
    <published>2024-03-18T03:24:31.000Z</published>
    <updated>2024-04-12T02:34:47.746Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\blog\assets\css\APlayer.min.css"><script src="\blog\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\blog\assets\js\Meting.min.js"></script><h3><span id="ipvsçš„æ¦‚å¿µ-åŸç†åŠåº”ç”¨">IPVSçš„æ¦‚å¿µã€åŸç†åŠåº”ç”¨</span></h3><h3><span id="ä¸€-ä»€ä¹ˆæ˜¯ipvs">ä¸€ã€ä»€ä¹ˆæ˜¯IPVS</span></h3><p>LVSï¼ˆLinux è™šæ‹ŸæœåŠ¡å™¨ï¼‰å’Œ IPVSï¼ˆIP è™šæ‹ŸæœåŠ¡å™¨ï¼‰æ˜¯ Linux ä¸­ç”¨äºæ„å»ºå¯æ‰©å±•å’Œé«˜æ€§èƒ½ç½‘ç»œæœåŠ¡çš„ä¸¤ç§ç›¸å…³æŠ€æœ¯ã€‚</p><p>LVS æ˜¯ Linux ç³»ç»Ÿçš„å†…æ ¸çº§è´Ÿè½½å‡è¡¡è§£å†³æ–¹æ¡ˆã€‚ å®ƒå…è®¸æ‚¨åœ¨å¤šä¸ªæœåŠ¡å™¨ä¹‹é—´åˆ†é…ä¼ å…¥çš„ç½‘ç»œæµé‡ï¼Œåˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨é›†ç¾¤ï¼Œåœ¨å®¢æˆ·ç«¯çœ‹æ¥å°±åƒä¸€ä¸ªè™šæ‹ŸæœåŠ¡å™¨ã€‚ LVS ä¸­çš„è´Ÿè½½å‡è¡¡ç®—æ³•å¯ä»¥æ ¹æ®å„ç§å› ç´ ï¼ˆä¾‹å¦‚å¾ªç¯æ³•ã€æœ€å°‘è¿æ¥æ•°å’Œæº IP å“ˆå¸Œï¼‰æ¥åˆ†é…æµé‡ã€‚ </p><h3><span id="äºŒ-ipvsçš„å·¥ä½œåŸç†">äºŒã€IPVSçš„å·¥ä½œåŸç†</span></h3><p>IPVSçš„å·¥ä½œåŸç†åŸºäºç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNetwork Address Translationï¼ŒNATï¼‰å’Œç«¯å£è½¬æ¢ï¼ˆPort Translationï¼‰ã€‚</p><p>å½“ä¸€ä¸ªç½‘ç»œè¯·æ±‚åˆ°è¾¾IPVSï¼ŒIPVSä¼šæ ¹æ®é¢„è®¾çš„è°ƒåº¦ç®—æ³•é€‰æ‹©ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œç„¶åä¿®æ”¹ç½‘ç»œè¯·æ±‚çš„ç›®æ ‡IPåœ°å€å’Œç«¯å£ï¼Œä½¿å…¶æŒ‡å‘é€‰æ‹©çš„åç«¯æœåŠ¡å™¨ã€‚</p><p>å½“åç«¯æœåŠ¡å™¨å¤„ç†å®Œè¯·æ±‚åï¼ŒIPVSä¼šå°†æœåŠ¡å™¨çš„å“åº”è½¬å‘å›åŸå§‹è¯·æ±‚çš„å®¢æˆ·ç«¯ã€‚</p><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯å¹¶ä¸çŸ¥é“å®é™…ä¸Šæ˜¯å“ªä¸ªåç«¯æœåŠ¡å™¨å¤„ç†äº†å®ƒçš„è¯·æ±‚ã€‚</p><h3><span id="ä¸‰-ipvsçš„ä¸»è¦ç‰¹æ€§">ä¸‰ã€IPVSçš„ä¸»è¦ç‰¹æ€§</span></h3><p>ä¸°å¯Œçš„è°ƒåº¦ç®—æ³•ï¼šIPVSæ”¯æŒå¤šç§è°ƒåº¦ç®—æ³•ï¼ŒåŒ…æ‹¬æœ€å°è¿æ¥ï¼ˆLeast-Connectionï¼‰ã€è½®è¯¢ï¼ˆRound-Robinï¼‰å’ŒåŠ æƒè½®è¯¢ï¼ˆWeighted Round-Robinï¼‰ç­‰ï¼Œæ»¡è¶³ä¸åŒåº”ç”¨åœºæ™¯çš„éœ€æ±‚ã€‚<br>å¥åº·æ£€æŸ¥ï¼šIPVSèƒ½å¤Ÿå®šæœŸå¯¹åç«¯æœåŠ¡å™¨è¿›è¡Œå¥åº·æ£€æŸ¥ï¼Œå½“æ£€æµ‹åˆ°æŸä¸ªæœåŠ¡å™¨æ•…éšœæ—¶ï¼Œå¯ä»¥å°†å…¶ä»æœåŠ¡åˆ—è¡¨ä¸­ç§»é™¤ï¼Œé˜²æ­¢å‘æ•…éšœæœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚<br>é«˜æ€§èƒ½ï¼šç”±äºIPVSæ˜¯Linuxå†…æ ¸çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤å¤„ç†ç½‘ç»œè¯·æ±‚çš„æ•ˆç‡éå¸¸é«˜ã€‚IPVSæ”¯æŒå¤§è§„æ¨¡å¹¶å‘è¿æ¥ï¼Œèƒ½å¤Ÿå¤„ç†æ¯ç§’æ•°ä»¥ä¸‡è®¡çš„ç½‘ç»œè¯·æ±‚ã€‚<br>æ˜“äºé›†æˆï¼šIPVSå¯ä»¥ä¸å…¶ä»–Linuxå†…æ ¸æ¨¡å—å’Œç”¨æˆ·ç©ºé—´å·¥å…·ä¸€èµ·ä½¿ç”¨ï¼Œå¦‚iptableså’Œkeepalivedç­‰ï¼Œæä¾›æ›´åŠ å¼ºå¤§å’Œçµæ´»çš„ç½‘ç»œæœåŠ¡ã€‚</p><h3><span id="å››-ipvsçš„åº”ç”¨åœºæ™¯">å››ã€IPVSçš„åº”ç”¨åœºæ™¯</span></h3><p>IPVSå¹¿æ³›åº”ç”¨äºå¤§è§„æ¨¡çš„äº’è”ç½‘æœåŠ¡ï¼Œå¦‚ç½‘ç«™ã€åœ¨çº¿è§†é¢‘å’Œæ¸¸æˆç­‰ï¼Œæä¾›é«˜å¯ç”¨æ€§å’Œé«˜æ€§èƒ½çš„ç½‘ç»œæœåŠ¡ã€‚</p><p>æ­¤å¤–ï¼ŒIPVSä¹Ÿåœ¨äº‘è®¡ç®—ã€å¤§æ•°æ®å’Œå®¹å™¨æŠ€æœ¯ç­‰é¢†åŸŸæœ‰å¹¿æ³›çš„åº”ç”¨ï¼Œä¾‹å¦‚åœ¨Kubernetesä¸­ï¼ŒIPVSä½œä¸ºæœåŠ¡ä»£ç†çš„ä¸€ç§æ¨¡å¼ï¼Œä¸ºé›†ç¾¤å†…çš„æœåŠ¡æä¾›è´Ÿè½½å‡è¡¡ã€‚</p><p>ç»¼ä¸Šæ‰€è¿°ï¼ŒLVS æ˜¯ Linux ç³»ç»Ÿçš„ç»¼åˆè´Ÿè½½å‡è¡¡è§£å†³æ–¹æ¡ˆï¼Œè€Œ IPVS æ˜¯ LVS ä¸­ä¸“é—¨å¤„ç† IP è´Ÿè½½å‡è¡¡çš„ç»„ä»¶ã€‚ LVS åˆ©ç”¨ IPVS åœ¨å¤šä¸ªçœŸå®æœåŠ¡å™¨ä¹‹é—´åˆ†å‘æµé‡ï¼Œå¹¶ä¸ºå„ç§ç½‘ç»œæœåŠ¡æä¾›å¯æ‰©å±•æ€§å’Œå®¹é”™æ€§</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;&#92;blog&#92;assets&#92;css&#92;APlayer.min.css&quot;&gt;&lt;script src=&quot;&#92;blog&#92;assets&#92;js&#92;APlayer.m</summary>
      
    
    
    
    <category term="k8s" scheme="https://smartxia.github.io/blog/categories/k8s/"/>
    
    
    <category term="k8s" scheme="https://smartxia.github.io/blog/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>PHP-ææ„å‡½æ•°-destruct</title>
    <link href="https://smartxia.github.io/blog/2024/03/12/tech/backend/php/PHP-%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0-destruct/"/>
    <id>https://smartxia.github.io/blog/2024/03/12/tech/backend/php/PHP-%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0-destruct/</id>
    <published>2024-03-12T03:55:12.845Z</published>
    <updated>2024-03-12T03:55:12.845Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\blog\assets\css\APlayer.min.css"><script src="\blog\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\blog\assets\js\Meting.min.js"></script><blockquote><p>phpStrom é‡Œalt+insert ä¼šå‡ºç°çš„ä¸€äº›å‡½æ•°</p></blockquote><h3><span id="ææ„å‡½æ•°destruct">ææ„å‡½æ•°destruct</span></h3><p><img src="http://s2-cdn.oneitfarm.com/d7f45961508248afb2f08e0bd137ca9c.png" alt="image.png"></p><p>ç®€å•ç†è§£ï¼šæ„é€ å‡½æ•°çš„å¯¹ç«‹é¢<br>æ„é€ å‡½æ•°ï¼š__construct()åœ¨åˆå§‹åŒ–å¯¹è±¡çš„æ—¶å€™é»˜è®¤æ‰§è¡Œçš„<br>ææ„å‡½æ•°ï¼š__destruct()åœ¨å¯¹è±¡é”€æ¯å›æ”¶æ—¶å€™é»˜è®¤æ‰§è¡Œçš„ï¼Œç±»ä¼¼äºwebæ¡†æ¶é‡Œé¢çš„é’©å­å‡½æ•°</p><p>è§¦å‘æ¡ä»¶ å½“å¯¹è±¡æˆ–è€…å˜é‡ æ¶ˆå¤±æ—¶å€™</p><p>å…³é”®è¯ï¼šunsetæˆ–è€…å¯¹è±¡ç”Ÿå‘½å‘¨æœŸç»“æŸ</p><p>phpStrom é‡Œalt+insert ä¼šå‡ºç°çš„ä¸€äº›å‡½æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">calss A&#123;</span><br><span class="line">    </span><br><span class="line">protected $data = [];</span><br><span class="line"></span><br><span class="line">public function insert($data)</span><br><span class="line">    &#123;</span><br><span class="line">        $data[&#x27;appkey&#x27;] = getAppkey();</span><br><span class="line">        $data[&#x27;channel&#x27;] = getChannel();</span><br><span class="line">        $this-&gt;data[] = $data;</span><br><span class="line">        //è¿™ä¸ª[]æ„æ€åœ¨å¤šä¸ªå¤šæ¬¡è°ƒç”¨çš„æ—¶å€™æ’å…¥æ•´ä¸ªæ•°ç»„å¾ˆå…³é”®ï¼Œå¯ä»¥çœ‹ä¸‹é¢å†…å®¹ è¯·æ±‚ä¸­ php å¦‚ä½•åˆ†é…phpfpm</span><br><span class="line">    &#125;</span><br><span class="line"> public function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        if ($this-&gt;data) &#123;</span><br><span class="line">            $this-&gt;getDB()-&gt;insert_batch($this-&gt;table, $this-&gt;data);</span><br><span class="line">            $id = $this-&gt;getDB()-&gt;insert_id();</span><br><span class="line">            Ioc()-&gt;CallRecordModel-&gt;_delete([</span><br><span class="line">                &#x27;id &lt;&#x27; =&gt; $id - 50000</span><br><span class="line">            ], &#x27;&#x27;, 1000);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$zend=new A();</span><br><span class="line">$zend-&gt;insert([&quot;aaaaa&quot;]);</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;&#92;blog&#92;assets&#92;css&#92;APlayer.min.css&quot;&gt;&lt;script src=&quot;&#92;blog&#92;assets&#92;js&#92;APlayer.m</summary>
      
    
    
    
    <category term="PHP" scheme="https://smartxia.github.io/blog/categories/PHP/"/>
    
    
    <category term="php" scheme="https://smartxia.github.io/blog/tags/php/"/>
    
  </entry>
  
  <entry>
    <title>GOLANG-ç¬”è®°-ArrayMapSlice</title>
    <link href="https://smartxia.github.io/blog/2024/03/12/tech/backend/golang/GOLANG-%E7%AC%94%E8%AE%B03-nil-slice-map/"/>
    <id>https://smartxia.github.io/blog/2024/03/12/tech/backend/golang/GOLANG-%E7%AC%94%E8%AE%B03-nil-slice-map/</id>
    <published>2024-03-12T03:55:12.820Z</published>
    <updated>2024-03-12T03:55:12.820Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\blog\assets\css\APlayer.min.css"><script src="\blog\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\blog\assets\js\Meting.min.js"></script><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">### 1. := = ==</span><br><span class="line"></span><br><span class="line">:= ç»™æŸå˜é‡çš„ç¬¬ä¸€æ¬¡èµ‹å€¼ï¼Œåˆå§‹åŒ–</span><br><span class="line"></span><br><span class="line">= å˜é‡çš„éç¬¬ä¸€æ¬¡èµ‹å€¼</span><br><span class="line"></span><br><span class="line">== ç­‰äºæ“ä½œç¬¦</span><br><span class="line"></span><br><span class="line">### 2. goä¸­nilçš„ä½¿ç”¨</span><br><span class="line"></span><br><span class="line">æŒ‡é’ˆã€åˆ‡ç‰‡ã€æ˜ å°„ã€é€šé“ã€å‡½æ•°å’Œæ¥å£çš„é›¶å€¼åˆ™æ˜¯ nilã€‚</span><br><span class="line"></span><br><span class="line">- nil æ ‡è¯†ç¬¦æ˜¯ä¸èƒ½æ¯”è¾ƒçš„</span><br><span class="line">- nil ä¸æ˜¯å…³é”®å­—æˆ–ä¿ç•™å­—</span><br><span class="line">- nil æ²¡æœ‰é»˜è®¤ç±»å‹</span><br><span class="line">- ä¸åŒç±»å‹ nil çš„æŒ‡é’ˆæ˜¯ä¸€æ ·çš„</span><br><span class="line">- ä¸åŒç±»å‹çš„ nil æ˜¯ä¸èƒ½æ¯”è¾ƒçš„</span><br><span class="line">- ä¸¤ä¸ªç›¸åŒç±»å‹çš„ nil å€¼ä¹Ÿå¯èƒ½æ— æ³•æ¯”è¾ƒ</span><br><span class="line">- nil æ˜¯ mapã€sliceã€pointerã€channelã€funcã€interface çš„é›¶å€¼</span><br><span class="line">- ä¸åŒç±»å‹çš„ nil å€¼å ç”¨çš„å†…å­˜å¤§å°å¯èƒ½æ˜¯ä¸ä¸€æ ·çš„</span><br><span class="line"></span><br><span class="line">### 3.åˆ‡ç‰‡ slice</span><br><span class="line"></span><br><span class="line">ç±»ä¼¼äºpyæˆ–Javaçš„list ,æ˜¯æ•°ç»„çš„æŠ½è±¡,æ”¯æŒæ•°ç»„æ‰©å®¹ å®šä¹‰:</span><br><span class="line">slice1 := make([]type, len)</span><br><span class="line"></span><br><span class="line">len è·å–é•¿åº¦ cap è·å–å®¹é‡ append(slice1 ,v1,...) copy(new_slice,slice1)</span><br><span class="line"></span><br><span class="line">### 4.é›†åˆ map</span><br><span class="line"></span><br><span class="line">map æ— åºk-v ,å¿«é€Ÿæ ¹æ®k æ‰¾åˆ°v,ç±»ä¼¼äºç´¢å¼•,åœ¨åšå¾ªç¯æ‰“å°çš„æ—¶å€™ï¼Œæ— æ³•å›ºå®šè¿”å›é¡ºåºï¼Œå› ä¸ºmap ç”¨hashè¡¨æ¥å®ç°çš„</span><br><span class="line"></span><br><span class="line">- å£°æ˜å˜é‡ï¼Œé»˜è®¤ map æ˜¯ nil var map_val map[key_data_type]value_data_type</span><br><span class="line"></span><br><span class="line">- ä½¿ç”¨ make å‡½æ•° map_val := make(map[key_data_type]value_data_type)</span><br><span class="line"></span><br><span class="line">### å¹¶å‘</span><br><span class="line">goroutine </span><br><span class="line">go sync()</span><br><span class="line">### é€šé“ channel</span><br><span class="line">æ—¢ç„¶å·²ç»æœ‰äº†çº¿ç¨‹çš„æ¦‚å¿µï¼Œé‚£ä¹ˆå°±ä¼šå­˜åœ¨çº¿ç¨‹é—´çš„åŒæ­¥å’Œé€šè®¯é—®é¢˜ï¼ŒGo ä½¿ç”¨é€šé“ï¼ˆchannelï¼‰æ¥å®ç°ã€‚</span><br><span class="line"></span><br><span class="line">é€šé“å¯ç”¨äºä¸¤ä¸ª goroutine ä¹‹é—´é€šè¿‡ä¼ é€’ä¸€ä¸ªæŒ‡å®šç±»å‹çš„å€¼æ¥åŒæ­¥è¿è¡Œå’Œé€šè®¯ã€‚ä½¿ç”¨æ“ä½œç¬¦ &lt;-ï¼Œç¬¦å·å·¦è¾¹æ˜¯æ¥æ”¶è€…ï¼Œå³è¾¹æ˜¯å‘é€è€…ã€‚</span><br><span class="line"></span><br><span class="line">ä½¿ç”¨ make åˆ›å»º channelï¼Œå¦‚ä¸‹ï¼š</span><br><span class="line"></span><br><span class="line">â€‹```</span><br><span class="line">ch := make(chan int, 100) // make ç¬¬äºŒä¸ªå‚æ•° 100 æ˜¯è¯¥é€šé“çš„ç¼“å†²åŒºï¼Œæ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé‚£ä¹ˆå°±æ˜¯æ— ç¼“å†²çš„é€šé“</span><br><span class="line">ch &lt;- v    // æŠŠ v å‘é€åˆ°é€šé“ ch</span><br><span class="line">v := &lt;-ch  // ä» ch æ¥æ”¶æ•°æ®</span><br><span class="line">// å¹¶æŠŠå€¼èµ‹ç»™ v</span><br><span class="line">â€‹```</span><br><span class="line">é€šé“ä¸æ¶ˆæ¯é˜Ÿåˆ—æ˜¯ç­‰æ•ˆçš„ï¼Œå¦‚æœé€šé“ç¼“å†²åŒºæ»¡ï¼Œé‚£ä¹ˆå†å¾€é€šé“é‡Œå¡æ•°æ®ï¼Œå°±ä¼šé˜»å¡è¯¥ goroutineï¼›åŒæ ·ï¼Œå¦‚æœé€šé“ç¼“å†²åŒºæ²¡æœ‰æ•°æ®äº†ï¼Œå†æ¬¡æ¥æ”¶é€šé“æ•°æ®ï¼Œä¹Ÿä¼šé˜»å¡è¯¥ goroutineã€‚</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;&#92;blog&#92;assets&#92;css&#92;APlayer.min.css&quot;&gt;&lt;script src=&quot;&#92;blog&#92;assets&#92;js&#92;APlayer.m</summary>
      
    
    
    
    <category term="GOLANG" scheme="https://smartxia.github.io/blog/categories/GOLANG/"/>
    
    
    <category term="Slice" scheme="https://smartxia.github.io/blog/tags/Slice/"/>
    
  </entry>
  
  <entry>
    <title>darp Docs</title>
    <link href="https://smartxia.github.io/blog/2022/03/16/tech/devops/darp-Docs/"/>
    <id>https://smartxia.github.io/blog/2022/03/16/tech/devops/darp-Docs/</id>
    <published>2022-03-16T06:59:18.000Z</published>
    <updated>2024-03-12T03:55:12.897Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\blog\assets\css\APlayer.min.css"><script src="\blog\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\blog\assets\js\Meting.min.js"></script><p>dapr æ–‡æ¡£è´¡çŒ®<br>dapr æ–‡æ¡£è´¡çŒ®è§„åˆ™ï¼š<a href="https://docs.dapr.io/zh-hans/contributing/contributing-docs/">https://docs.dapr.io/zh-hans/contributing/contributing-docs/</a></p><p>dapr æ–‡æ¡£ç½‘ç«™ä½¿ç”¨hugo å¼€å‘å·¥å…·ï¼š</p><p>Windowsï¼šå®‰è£…æµç¨‹<br>å®‰è£…scoope<br>powerSheel ï¼šæ‰§è¡Œå‘½ä»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">set-executionpolicy remotesigned -scope currentuser</span><br><span class="line"></span><br><span class="line">iex (new-object net.webclient).downloadstring(&#x27;https://get.scoop.sh&#x27;)</span><br><span class="line"></span><br><span class="line">æ‰§è¡Œscoope help æŸ¥çœ‹æ˜¯å¦å®‰è£…æ­£å¸¸</span><br><span class="line"></span><br><span class="line">æ‰§è¡Œ   scoop install hugo</span><br><span class="line">      scoop install hugo-extended</span><br><span class="line">è¿™ä¸¤éƒ¨å³å¯ å®Œæˆå¯¹å…¶å®‰è£…</span><br><span class="line"></span><br><span class="line">æ–‡æ¡£ï¼šhttps://gohugo.io/getting-started/installing/</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3><span id="1æ‰§è¡Œdocä»“åº“ä¸‹è½½å’Œå®‰è£…ä¾èµ–">1.æ‰§è¡Œdocä»“åº“ä¸‹è½½å’Œå®‰è£…ä¾èµ–</span></h3><p>ä»“åº“ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">https://github.com.cnpmjs.org/dapr/docs.git</span><br><span class="line"></span><br><span class="line">æ‰§è¡Œï¼š</span><br><span class="line">git submodule update --init --recursive</span><br><span class="line"></span><br><span class="line">è¿™æ­¥å¯èƒ½é‡åˆ°ä¸‹è½½ä¸ä¸‹æ¥æƒ…å†µï¼Œå¯ä»¥æŒ‰ç…§æ­¤æ­¥éª¤è¿›è¡Œæ“ä½œ</span><br><span class="line"></span><br><span class="line">1.æ‰§è¡Œ git submodule update --init</span><br><span class="line">2.å».gitmodulesæ–‡ä»¶ è¿›è¡Œç¼–è¾‘å°†æ‰€æœ‰çš„https://github.com  åç¼€åŠ ä¸Š cnpmjs.org</span><br><span class="line">(è¿™ä¸ªåŸç†å¯ä»¥å‚è€ƒ:è°·æ­Œæ’ä»¶---GitHubåŠ é€Ÿ1.3.5)</span><br><span class="line">3.ç„¶ååˆ©ç”¨git submodule syncæ›´æ–°å­é¡¹ç›®å¯¹åº”çš„url</span><br><span class="line">4.git submodule update --init --recursiveï¼Œæœ€åæ‰§è¡Œ</span><br><span class="line"></span><br><span class="line">//s2-cdn.oneitfarm.com/6d3518411d074f9eae604f77da39da83.png</span><br></pre></td></tr></table></figure><p><img src="//s2-cdn.oneitfarm.com/a23f2220daff4375ba97522c7edc552c.png"></p><p>é”™è¯¯1.</p><p><img src="//s2-cdn.oneitfarm.com/c036d24abc364f00be0870faec874818.png" alt="image-20220316151455745"></p><p>è§£å†³æ–¹æ¡ˆï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ä½¿ç”¨gitä»£ç†ï¼š</span><br><span class="line">git config *--global https.proxy*</span><br><span class="line">æ‰§è¡Œå‘½ä»¤åå–æ¶ˆä»£ç†</span><br><span class="line">git config --global --unset https.proxy</span><br></pre></td></tr></table></figure><p>é”™è¯¯2ï¼š</p><p><img src="//s2-cdn.oneitfarm.com/b933985e39524c7ea6763610f552ecd7.png" alt="//s2-cdn.oneitfarm.com/b933985e39524c7ea6763610f552ecd7.png"></p><p>è§£å†³æ–¹æ¡ˆï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¿™ä¸ªæ˜¯å› ä¸ºæ²¡æœ‰æ‰§è¡Œgit moduleçš„ ä¸‹è½½</span><br></pre></td></tr></table></figure><h3><span id="2å®‰è£…ä¾èµ–">2.å®‰è£…ä¾èµ–</span></h3><p>æ­¤é¡¹ç›®ä½¿ç”¨çš„è¿˜æ˜¯npm </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install ï¼ˆå¾ˆæ…¢ï¼‰ </span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;&#92;blog&#92;assets&#92;css&#92;APlayer.min.css&quot;&gt;&lt;script src=&quot;&#92;blog&#92;assets&#92;js&#92;APlayer.m</summary>
      
    
    
    
    <category term="dapr" scheme="https://smartxia.github.io/blog/categories/dapr/"/>
    
    
  </entry>
  
  <entry>
    <title>GOLANG-grpc-2</title>
    <link href="https://smartxia.github.io/blog/2021/12/09/tech/backend/golang/GOLANG-%E7%AC%94%E8%AE%B013grpc-2/"/>
    <id>https://smartxia.github.io/blog/2021/12/09/tech/backend/golang/GOLANG-%E7%AC%94%E8%AE%B013grpc-2/</id>
    <published>2021-12-09T07:05:54.000Z</published>
    <updated>2024-03-12T03:55:12.807Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\blog\assets\css\APlayer.min.css"><script src="\blog\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\blog\assets\js\Meting.min.js"></script><p>è„‘å›¾ï¼š</p><p><a href="https://naotu.baidu.com/file/c80e753e20e8ab18a80cb573ac08e912?token=e89e127e95b325d5">https://naotu.baidu.com/file/c80e753e20e8ab18a80cb573ac08e912?token=e89e127e95b325d5</a></p><p>æœåŠ¡ç«¯çš„æ“ä½œï¼š</p><p>å–å‡ºserver</p><p>æŒ‚è½½æ–¹æ³•</p><p>æ³¨å†ŒæœåŠ¡</p><p>åˆ›å»ºç›‘å¬</p><p>å®¢æˆ·ç«¯ï¼š</p><p>åˆ›å»ºé“¾æ¥</p><p>new ä¸€ä¸ªclient</p><p>è°ƒç”¨clientæ–¹æ³•</p><p>è·å–è¿”å›å€¼</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;&#92;blog&#92;assets&#92;css&#92;APlayer.min.css&quot;&gt;&lt;script src=&quot;&#92;blog&#92;assets&#92;js&#92;APlayer.m</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>x86å’Œarmæ¶æ„åŒºåˆ«</title>
    <link href="https://smartxia.github.io/blog/2021/12/02/%E5%BB%BA%E7%AB%99/x86%E5%92%8Carm%E6%9E%B6%E6%9E%84%E5%8C%BA%E5%88%AB/"/>
    <id>https://smartxia.github.io/blog/2021/12/02/%E5%BB%BA%E7%AB%99/x86%E5%92%8Carm%E6%9E%B6%E6%9E%84%E5%8C%BA%E5%88%AB/</id>
    <published>2021-12-02T08:22:44.000Z</published>
    <updated>2024-03-12T03:55:12.898Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\blog\assets\css\APlayer.min.css"><script src="\blog\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\blog\assets\js\Meting.min.js"></script><h3><span id="ä»€ä¹ˆæ˜¯armæ¶æ„">ä»€ä¹ˆæ˜¯armæ¶æ„</span></h3><p>ARMæ¶æ„è¿‡å»ç§°ä¹‹ä¸ºè¿›é˜¶ç²¾ç®€æŒ‡ä»¤é›†æœºå™¨ï¼Œæ˜¯ä¸€ä¸ª32ä½çš„ç²¾ç®€æŒ‡ä»¤é›†ï¼ˆRISCï¼‰å¤„ç†å™¨æ¶æ„ï¼Œå…¶å¹¿æ³›çš„ä½¿ç”¨åœ¨åµŒå…¥å¼ç³»ç»Ÿè®¾è®¡ï¼Œç”±äºèŠ‚èƒ½çš„ç‰¹ç‚¹ï¼ŒARMéå¸¸é€‚åˆå¤„ç†ç§»åŠ¨é€šè®¯é¢†åŸŸï¼Œç¬¦åˆå…¶è®¾è®¡ç›®æ ‡ä½æ¶ˆè€— ç”µé‡çš„ç‰¹æ€§ï¼Œåœ¨ä»Šæ—¥ï¼ŒARMå®¶æ—å äº†æ‰€æœ‰32ä½åµŒå…¥å¼å¤„ç†å™¨75%çš„æ¯”ä¾‹ï¼Œä½¿å®ƒæˆä¸ºå å…¨ä¸–ç•Œæœ€å¤šæ•°çš„32ä½æ¶æ„ä¹‹ä¸€ã€‚ARMå¤„ç†å™¨å¯ä»¥åœ¨å¾ˆå¤šæ¶ˆè´¹æ€§ç”µå­äº§å“ä¸Šçœ‹åˆ°ï¼Œä»å¯æºå¼è£…ç½®ï¼ˆPDAã€ç§»åŠ¨ç”µè¯ã€å¤šåª’ä½“æ’­æ”¾å™¨ã€æŒä¸Šå‹ç”µå­æ¸¸æˆï¼Œå’Œè®¡ç®—æœºï¼‰åˆ°ç”µè„‘å¤–è®¾ï¼ˆç¡¬ç›˜ã€æ¡Œä¸Šå‹è·¯ç”±å™¨ï¼‰ç”šè‡³åœ¨å¯¼å¼¹çš„å¼¹è½½è®¡ç®—æœºç­‰å†›ç”¨è®¾æ–½ä¸­éƒ½æœ‰ä»–çš„å­˜åœ¨ã€‚åœ¨æ­¤è¿˜æœ‰ä¸€äº›åŸºäºARMè®¾è®¡çš„æ´¾ç”Ÿäº§å“ï¼Œé‡è¦äº§å“è¿˜åŒ…æ‹¬Marvellçš„XScaleæ¶æ„å’Œå¾·å·ä»ªå™¨çš„OMAPç³»åˆ—.</p><p>armæ¶æ„å›¾</p><p>ä¸‹å›¾æ‰€ç¤ºçš„æ˜¯ARMæ„æ¶å›¾ã€‚å®ƒç”±32ä½ALUã€è‹¥å¹²ä¸ª32ä½é€šç”¨å¯„å­˜å™¨ä»¥åŠçŠ¶æ€å¯„å­˜å™¨ã€32&TImes;8ä½ä¹˜æ³•å™¨ã€32&TImes;32ä½æ¡¶å½¢ç§»ä½å¯„å­˜å™¨ã€æŒ‡ä»¤è¯‘ç ä»¥åŠæ§åˆ¶é€»è¾‘ã€æŒ‡ä»¤æµæ°´çº¿å’Œæ•°æ®&#x2F;åœ°å€å¯„å­˜å™¨ç»„æˆ.</p><p><img src="http://file.elecfans.com/web1/M00/50/D9/o4YBAFr7zl2AGVr8AABPkxqzXZA667.jpg"></p><p>1ã€ALUï¼šå®ƒæœ‰ä¸¤ä¸ªæ“ä½œæ•°é”å­˜å™¨ã€åŠ æ³•å™¨ã€é€»è¾‘åŠŸèƒ½ã€ç»“æœä»¥åŠé›¶æ£€æµ‹é€»è¾‘æ„æˆã€‚</p><p>2ã€æ¡¶å½¢ç§»ä½å¯„å­˜å™¨ï¼šARMé‡‡ç”¨äº†32&TImes;32ä½çš„æ¡¶å½¢ç§»ä½å¯„å­˜å™¨ï¼Œè¿™æ ·å¯ä»¥ä½¿åœ¨å·¦ç§»&#x2F;å³ç§»nä½ã€ç¯ç§»nä½å’Œç®—æœ¯å³ç§»nä½ç­‰éƒ½å¯ä»¥ä¸€æ¬¡å®Œæˆã€‚</p><p>3ã€é«˜é€Ÿä¹˜æ³•å™¨ï¼šä¹˜æ³•å™¨ä¸€èˆ¬é‡‡ç”¨â€œåŠ ä¸€ç§»ä½â€çš„æ–¹æ³•æ¥å®ç°ä¹˜æ³•ã€‚ARMä¸ºäº†æé«˜è¿ç®—é€Ÿåº¦ï¼Œåˆ™é‡‡ç”¨ä¸¤ä½ä¹˜æ³•çš„æ–¹æ³•ï¼Œæ ¹æ®ä¹˜æ•°çš„2ä½æ¥å®ç°â€œåŠ ä¸€ç§»ä½â€è¿ç®—;ARMé«˜é€Ÿä¹˜æ³•å™¨é‡‡ç”¨32&TImes;8ä½çš„ç»“æ„ï¼Œè¿™æ ·ï¼Œå¯ä»¥é™ä½é›†æˆåº¦ï¼ˆå…¶ç›¸åº”èŠ¯ç‰‡é¢ç§¯ä¸åˆ°å¹¶è¡Œä¹˜æ³•å™¨çš„1&#x2F;3ï¼‰ã€‚</p><p>4ã€æµ®ç‚¹éƒ¨ä»¶ï¼šæµ®ç‚¹éƒ¨ä»¶æ˜¯ä½œä¸ºé€‰ä»¶ä¾›ARMæ„æ¶ä½¿ç”¨ã€‚FPA10æµ®ç‚¹åŠ é€Ÿå™¨æ˜¯ä½œä¸ºåå¤„ç†æ–¹å¼ä¸ARMç›¸è¿ï¼Œå¹¶é€šè¿‡åå¤„ç†æŒ‡ä»¤çš„è§£é‡Šæ¥æ‰§è¡Œã€‚</p><p>5ã€æ§åˆ¶å™¨ï¼šARMçš„æ§åˆ¶å™¨é‡‡ç”¨çš„æ˜¯ç¡¬æ¥çº¿çš„å¯ç¼–ç¨‹é€»è¾‘é˜µåˆ—PLAã€‚</p><p>6ã€å¯„å­˜å™¨</p><h2><span id="x86æ¶æ„"><strong>x86æ¶æ„</strong></span></h2><p><img src="http://file.elecfans.com/web1/M00/50/ED/pIYBAFr7zpSASlXUAABbDZ2xUGo091.jpg"></p><p>å½“ç„¶ï¼Œè¿™ä¸ªæ¶æ„å›¾å¹¶ä¸æ˜¯æ‰€æœ‰çš„éƒ½æ˜¯å¦‚æ­¤ï¼Œæ ¹æ®ä¸åŒçš„ä¸»æ¿ï¼Œå¹³å°ï¼Œæ¶æ„æ˜¯ç•¥æœ‰å·®åˆ«çš„æ¯”å¦‚è¯´ï¼Œç›®å‰å¾ˆå¤šä¸»æ¿å·²ç»å°†åŒ—æ¡¥é›†æˆåˆ°CPUå½“ä¸­ï¼Œå°†å—æ¡¥é›†æˆä¸ºPCHï¼Œä½†å¤§è‡´çš„æ¡†æ¶è¿˜æ˜¯å¦‚æ­¤çš„ã€‚ä¸‹é¢å¯¹è¿™ä¸ªæ¶æ„å›¾ä¸Šçš„å„ä¸ªå†…å®¹åˆ†åˆ«è¿›è¡Œä¸€äº›ç®€ä»‹:</p><p>   1ï¼šCPUï¼Œå¤§å®¶éƒ½ä¸é™Œç”Ÿçš„åè¯ï¼Œä¸­å¤®å¤„ç†å™¨ï¼Œè®¡ç®—æœºçš„æ ¸å¿ƒå¤§è„‘ã€‚</p><p>ã€€2ï¼š åŒ—æ¡¥ï¼ˆNorth Bridge Chipsetï¼‰ï¼šåŒ—æ¡¥æ˜¯ç”µè„‘ä¸»æ¿ä¸Šçš„ä¸€å—èŠ¯ç‰‡ï¼Œä½äºCPUæ’åº§è¾¹ï¼Œèµ·è¿æ¥ä½œç”¨ã€‚</p><p>ã€€3ï¼šå—æ¡¥èŠ¯ç‰‡ï¼ˆSouth Bridgeï¼‰æ˜¯ä¸»æ¿èŠ¯ç‰‡ç»„çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œä¸€èˆ¬ä½äºä¸»æ¿ä¸Šç¦»CPUæ’æ§½è¾ƒè¿œçš„ä¸‹æ–¹ï¼ŒPCIæ’æ§½çš„é™„è¿‘ï¼Œè¿™ç§å¸ƒå±€æ˜¯è€ƒè™‘åˆ°å®ƒæ‰€è¿æ¥çš„I&#x2F;Oæ€»çº¿è¾ƒå¤šï¼Œç¦»å¤„ç†å™¨è¿œä¸€ç‚¹æœ‰åˆ©äºå¸ƒçº¿ã€‚</p><p>ã€€4ï¼š å†…å­˜æ˜¯è®¡ç®—æœºä¸­é‡è¦çš„éƒ¨ä»¶ä¹‹ä¸€ï¼Œå®ƒæ˜¯ä¸CPUè¿›è¡Œæ²Ÿé€šçš„æ¡¥æ¢ã€‚è®¡ç®—æœºä¸­æ‰€æœ‰ç¨‹åºçš„è¿è¡Œéƒ½æ˜¯åœ¨å†…å­˜ä¸­è¿›è¡Œçš„ï¼Œå› æ­¤å†…å­˜çš„æ€§èƒ½å¯¹è®¡ç®—æœºçš„å½±å“éå¸¸å¤§ã€‚</p><p>ã€€5ï¼šæ˜¾å¡ï¼ˆVideo cardï¼ŒGraphics cardï¼‰å…¨ç§°æ˜¾ç¤ºæ¥å£å¡ï¼Œåˆç§°æ˜¾ç¤ºé€‚é…å™¨ï¼Œæ˜¯è®¡ç®—æœºæœ€åŸºæœ¬é…ç½®ã€æœ€é‡è¦çš„é…ä»¶ä¹‹ä¸€ã€‚</p><p>ã€€6ï¼šæ˜¾ç¤ºjæ¥å£</p><p>ã€€7ï¼šç½‘å¡æ˜¯å·¥ä½œåœ¨é“¾è·¯å±‚çš„ç½‘ç»œç»„ä»¶ï¼Œæ˜¯å±€åŸŸç½‘ä¸­è¿æ¥è®¡ç®—æœºå’Œä¼ è¾“ä»‹è´¨çš„æ¥å£ï¼Œä¸ä»…èƒ½å®ç°ä¸å±€åŸŸç½‘ä¼ è¾“ä»‹è´¨ä¹‹é—´çš„ç‰©ç†è¿æ¥å’Œç”µä¿¡å·åŒ¹é…ï¼Œè¿˜æ¶‰åŠå¸§çš„å‘é€ä¸æ¥æ”¶ã€å¸§çš„å°è£…ä¸æ‹†å°ã€ä»‹è´¨è®¿é—®æ§åˆ¶ã€æ•°æ®çš„ç¼–ç ä¸è§£ç ä»¥åŠæ•°æ®ç¼“å­˜çš„åŠŸèƒ½ç­‰ã€‚</p><p>ã€€8ï¼šå£°å¡çš„åŸºæœ¬åŠŸèƒ½æ˜¯æŠŠæ¥è‡ªè¯ç­’ã€ç£å¸¦ã€å…‰ç›˜çš„åŸå§‹å£°éŸ³ä¿¡å·åŠ ä»¥è½¬æ¢ï¼Œè¾“å‡ºåˆ°è€³æœºã€æ‰¬å£°å™¨ã€æ‰©éŸ³æœºã€å½•éŸ³æœºç­‰å£°å“è®¾å¤‡ï¼Œæˆ–é€šè¿‡éŸ³ä¹è®¾å¤‡æ•°å­—æ¥å£ï¼ˆMIDIï¼‰ä½¿ä¹å™¨å‘å‡ºç¾å¦™çš„å£°éŸ³ã€‚</p><p>ã€€9ï¼šSATAï¼ˆSerial Advanced Technology Attachmentï¼Œä¸²è¡Œé«˜çº§æŠ€æœ¯é™„ä»¶ï¼‰æ˜¯ä¸€ç§åŸºäºè¡Œä¸šæ ‡å‡†çš„ä¸²è¡Œç¡¬ä»¶é©±åŠ¨å™¨æ¥å£ï¼Œæ˜¯ç”±Intelã€IBMã€Dellã€APTã€Maxtorå’ŒSeagateå…¬å¸å…±åŒæå‡ºçš„ç¡¬ç›˜æ¥å£è§„èŒƒã€‚</p><p>ã€€10ï¼šç¡¬ç›˜æ˜¯ç”µè„‘ä¸»è¦çš„å­˜å‚¨åª’ä»‹ä¹‹ä¸€ï¼Œç”±ä¸€ä¸ªæˆ–è€…å¤šä¸ªé“åˆ¶æˆ–è€…ç»ç’ƒåˆ¶çš„ç¢Ÿç‰‡ç»„æˆã€‚ç¢Ÿç‰‡å¤–è¦†ç›–æœ‰é“ç£æ€§ææ–™ã€‚</p><p>ã€€11ï¼šæ€»çº¿</p><h2><span id="armæ¶æ„å’Œx86æ¶æ„æœ‰ä»€ä¹ˆåŒºåˆ«"><strong>armæ¶æ„å’Œx86æ¶æ„æœ‰ä»€ä¹ˆåŒºåˆ«</strong></span></h2><p><strong>ä¸€ã€æ€§èƒ½</strong> </p><p>â€‹    X86ç»“æ„çš„ç”µè„‘æ— è®ºå¦‚ä½•éƒ½æ¯”ARMç»“æ„çš„ç³»ç»Ÿåœ¨æ€§èƒ½æ–¹é¢è¦å¿«å¾—å¤šã€å¼ºå¾—å¤šã€‚X86çš„CPUéšä¾¿å°±æ˜¯1Gä»¥ä¸Šã€åŒæ ¸ã€å››æ ¸å¤§è¡Œå…¶é“ï¼Œé€šå¸¸ä½¿ç”¨45nmï¼ˆç”šè‡³æ›´é«˜çº§ï¼‰åˆ¶ç¨‹çš„å·¥è‰ºè¿›è¡Œç”Ÿäº§ï¼›è€ŒARMæ–¹é¢ï¼šCPUé€šå¸¸æ˜¯å‡ ç™¾å…†ï¼Œæœ€è¿‘æ‰å‡ºç°1Gå·¦å³çš„CPUï¼Œåˆ¶ç¨‹é€šå¸¸ä½¿ç”¨ä¸åˆ°65nmåˆ¶ç¨‹çš„å·¥è‰ºï¼Œå¯ä»¥è¯´åœ¨æ€§èƒ½å’Œç”Ÿäº§å·¥è‰ºæ–¹é¢ARMæ ¹æœ¬ä¸æ˜¯X86ç»“æ„ç³»ç»Ÿçš„å¯¹æ‰‹ã€‚</p><p>ã€€ã€€ä½†ARMçš„ä¼˜åŠ¿ä¸åœ¨äºæ€§èƒ½å¼ºå¤§è€Œåœ¨äºæ•ˆç‡ï¼ŒARMé‡‡ç”¨RISCæµæ°´çº¿æŒ‡ä»¤é›†ï¼Œåœ¨å®Œæˆç»¼åˆæ€§å·¥ä½œæ–¹é¢æ ¹æœ¬å°±å¤„äºåŠ£åŠ¿ï¼Œè€Œåœ¨ä¸€äº›ä»»åŠ¡ç›¸å¯¹å›ºå®šçš„åº”ç”¨åœºåˆå…¶ä¼˜åŠ¿å°±èƒ½å‘æŒ¥å¾—æ·‹æ¼“å°½è‡´.</p><p><strong>äºŒã€æ‰©å±•èƒ½åŠ›</strong></p><p>â€‹    X86ç»“æ„çš„ç”µè„‘é‡‡ç”¨â€œæ¡¥â€çš„æ–¹å¼ä¸æ‰©å±•è®¾å¤‡ï¼ˆå¦‚ï¼šç¡¬ç›˜ã€å†…å­˜ç­‰ï¼‰è¿›è¡Œè¿æ¥ï¼Œè€Œä¸”x86ç»“æ„çš„ç”µè„‘å‡ºç°äº†è¿‘30å¹´ï¼Œå…¶é…å¥—æ‰©å±•çš„è®¾å¤‡ç§ç±»å¤šã€ä»·æ ¼ä¹Ÿæ¯”è¾ƒä¾¿å®œï¼Œæ‰€ä»¥x86ç»“æ„çš„ç”µè„‘èƒ½å¾ˆå®¹æ˜“è¿›è¡Œæ€§èƒ½æ‰©å±•ï¼Œå¦‚å¢åŠ å†…å­˜ã€ç¡¬ç›˜ç­‰.</p><p>ã€€ã€€ARMç»“æ„çš„ç”µè„‘æ˜¯é€šè¿‡ä¸“ç”¨çš„æ•°æ®æ¥å£ä½¿CPUä¸æ•°æ®å­˜å‚¨è®¾å¤‡è¿›è¡Œè¿æ¥ï¼Œæ‰€ä»¥ARMçš„å­˜å‚¨ã€å†…å­˜ç­‰æ€§èƒ½æ‰©å±•éš¾ä»¥è¿›è¡Œï¼ˆä¸€èˆ¬åœ¨äº§å“è®¾è®¡æ—¶å·²ç»å®šå¥½å…¶å†…å­˜åŠæ•°æ®å­˜å‚¨çš„å®¹é‡ï¼‰ï¼Œæ‰€ä»¥é‡‡ç”¨ARMç»“æ„çš„ç³»ç»Ÿï¼Œä¸€èˆ¬ä¸è€ƒè™‘æ‰©å±•ã€‚åŸºæœ¬å¥‰è¡Œâ€œå¤Ÿç”¨å°±å¥½â€çš„åŸåˆ™.</p><p> <strong>ä¸‰ã€æ“ä½œç³»ç»Ÿçš„å…¼å®¹æ€§</strong></p><p>â€‹    X86ç³»ç»Ÿç”±å¾®è½¯åŠIntelæ„å»ºçš„Wintelè”ç›Ÿä¸€ç»Ÿå¤©ä¸‹ï¼Œå„æ–­äº†ä¸ªäººç”µè„‘æ“ä½œç³»ç»Ÿè¿‘30å¹´ï¼Œå½¢æˆå·¨å¤§çš„ç”¨æˆ·ç¾¤ï¼Œä¹Ÿæ·±æ·±å›ºåŒ–äº†ä¼—å¤šç”¨æˆ·çš„ä½¿ç”¨ä¹ æƒ¯ï¼ŒåŒæ—¶x86ç³»ç»Ÿåœ¨ç¡¬ä»¶å’Œè½¯ä»¶å¼€å‘æ–¹é¢å·²ç»å½¢æˆç»Ÿä¸€çš„æ ‡å‡†ï¼Œå‡ ä¹æ‰€æœ‰x86ç¡¬ä»¶å¹³å°éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨å¾®è½¯çš„è§†çª—ç³»ç»ŸåŠç°åœ¨æµè¡Œçš„å‡ ä¹æ‰€æœ‰å·¥å…·è½¯ä»¶ï¼Œæ‰€ä»¥x86ç³»ç»Ÿåœ¨å…¼å®¹æ€§æ–¹é¢å…·æœ‰æ— å¯æ¯”æ‹Ÿçš„ä¼˜åŠ¿ã€‚</p><p>ã€€ã€€ARMç³»ç»Ÿå‡ ä¹éƒ½é‡‡ç”¨<strong>Linux</strong>çš„æ“ä½œç³»ç»Ÿï¼Œè€Œä¸”å‡ ä¹æ‰€æœ‰çš„ç¡¬ä»¶ç³»ç»Ÿéƒ½è¦å•ç‹¬æ„å»ºè‡ªå·±çš„ç³»ç»Ÿï¼Œä¸å…¶ä»–ç³»ç»Ÿä¸èƒ½å…¼å®¹ï¼Œè¿™ä¹Ÿå¯¼è‡´å…¶åº”ç”¨è½¯ä»¶ä¸èƒ½æ–¹ä¾¿ç§»æ¤ï¼Œè¿™ä¸€ç‚¹ä¸€ç›´ä¸¥é‡åˆ¶çº¦äº†ARMç³»ç»Ÿçš„å‘å±•å’Œåº”ç”¨ã€‚GOOGLEå¼€å‘äº†å¼€æ”¾å¼çš„<strong>Android</strong>ç³»ç»Ÿåï¼Œç»Ÿä¸€äº†ARMç»“æ„ç”µè„‘çš„æ“ä½œç³»ç»Ÿï¼Œä½¿æ–°æ¨å‡ºåŸºäºARMç»“æ„çš„ç”µè„‘ç³»ç»Ÿæœ‰äº†ç»Ÿä¸€çš„ã€å¼€æ”¾å¼çš„ã€å…è´¹çš„æ“ä½œç³»ç»Ÿï¼Œä¸ºARMçš„å‘å±•æä¾›äº†å¼ºå¤§çš„æ”¯æŒå’ŒåŠ¨åŠ›.</p><p><strong>å››ã€è½¯ä»¶å¼€å‘çš„æ–¹ä¾¿æ€§åŠå¯ä½¿ç”¨å·¥å…·çš„å¤šæ ·æ€§</strong></p><p>â€‹    X86ç»“æ„çš„ç³»ç»Ÿæ¨å‡ºå·²ç»è¿‘30å¹´ï¼Œåœ¨æ­¤æœŸé—´ï¼Œx86ç”µè„‘ç»è¿‡é£é€Ÿå‘å±•çš„é»„é‡‘æ—¶æœŸï¼Œç”¨æˆ·çš„åº”ç”¨ã€è½¯ä»¶é…å¥—ã€è½¯ä»¶å¼€å‘å·¥å…·çš„é…å¥—åŠå…¼å®¹ç­‰å·¥ä½œï¼Œå·²ç»åˆ°è¾¾éå¸¸æˆç†Ÿç”šè‡³å¯ä»¥è¯´æ˜¯å®Œç¾çš„å¢ƒç•Œã€‚æ‰€ä»¥ä½¿ç”¨X86ç”µè„‘ç³»ç»Ÿä¸ä»…æœ‰å¤§é‡çš„ç¬¬ä¸‰æ–¹è½¯ä»¶å¯ä¾›é€‰æ‹©ï¼Œä¹Ÿæœ‰å¤§é‡çš„è½¯ä»¶ç¼–ç¨‹å·¥å…·å¯ä»¥å¸®åŠ©æ‚¨å®Œæˆæ‚¨æ‰€å¸Œæœ›å®Œæˆçš„å·¥ä½œã€‚</p><p>ã€€ã€€Armç»“æ„çš„ç”µè„‘ç³»ç»Ÿå› ä¸ºç¡¬ä»¶æ€§èƒ½çš„åˆ¶çº¦ã€æ“ä½œç³»ç»Ÿçš„ç²¾ç®€ã€ä»¥åŠç³»ç»Ÿå…¼å®¹ç­‰é—®é¢˜çš„åˆ¶çº¦ï¼Œé€ æˆArmç»“æ„çš„ç”µè„‘ç³»ç»Ÿä¸å¯èƒ½åƒX86ç”µè„‘ç³»ç»Ÿé‚£æ ·æœ‰ä¼—å¤šçš„ç¼–ç¨‹å·¥å…·å’Œç¬¬ä¸‰æ–¹è½¯ä»¶å¯ä¾›é€‰æ‹©åŠä½¿ç”¨ï¼ŒARMçš„ç¼–ç¨‹è¯­è¨€å¤§å¤šé‡‡ç”¨Cå’ŒJAVAã€‚</p><p>ã€€ã€€å¯¹è¿™ä¸€ç‚¹çš„æ¯”è¾ƒï¼Œæ›´ç›´æ¥çš„ç»“è®ºæ˜¯ï¼šåŸºäºx86ç»“æ„ç”µè„‘ç³»ç»Ÿå¹³å°å¼€å‘è½¯ä»¶æ¯”armç»“æ„ç³»ç»Ÿæ›´å®¹æ˜“ã€æ›´ç®€å•ã€å®é™…æˆæœ¬ä¹Ÿæ›´ä½ï¼ŒåŒæ—¶æ›´å®¹æ˜“æ‰¾åˆ°ç¬¬ä¸‰æ–¹è½¯ä»¶ï¼ˆå…å»è‡ªå·±å¼€å‘çš„æ—¶é—´å’Œæˆæœ¬ï¼‰ï¼Œè€Œä¸”è½¯ä»¶ç§»æ¤æ›´å®¹æ˜“ã€‚</p><p>ã€€ã€€ä»ä»¥ä¸Šå¯¹æ¯”åˆ†æï¼Œç»™äº†æˆ‘ä»¬çš„ä¸€ä¸ªå¾ˆæ¸…æ™°çš„æ„Ÿè§‰ï¼ŒARMå’ŒX86ç»“æ„çš„ç”µè„‘æ ¹æœ¬å°±æ— æ³•å¯¹æ¯”ï¼ŒARMæ ¹æœ¬å°±ä¸æ˜¯X86ç”µè„‘çš„çš„å¯¹æ‰‹ã€‚æ˜¯çš„ï¼Œå¦‚æœåªè€ƒè™‘ä¸Šè¿°å‡ ä¸ªæ–¹é¢çš„è¦æ•°ï¼ŒARMç¡®å®æ— æ³•ä¸X86ç”µè„‘ç«äº‰ï¼Œç”šè‡³è¿æ¯”è¾ƒçš„èµ„æ ¼éƒ½æ²¡æœ‰ã€‚ä½†æ˜¯è¿‘1ã€2å¹´ï¼ŒARMçš„äº§å“åœ¨ç»ˆç«¯åº”ç”¨ç‰¹åˆ«æ˜¯æ‰‹æŒç»ˆç«¯åº”ç”¨é£é€Ÿå‘å±•ï¼ˆå¦‚ï¼šæ™ºèƒ½æ‰‹æœºã€å¹³æ¿ç”µè„‘ç­‰ï¼‰ï¼Œå…¶é”€å”®æ•°é‡å·²ç»è¿œè¿œè¶…å‡ºx86ç»“æ„çš„ç”µè„‘é”€å”®æ•°é‡ï¼Œå¯è§ARMæ˜¯å…·æœ‰å…¶ä¸X86ç»“æ„ç”µè„‘ä¸å¯å¯¹æ¯”çš„ä¼˜åŠ¿ã€‚è¯¥ä¼˜åŠ¿å°±æ˜¯ï¼š<strong>åŠŸè€—.</strong></p><p><strong>äº”ã€åŠŸè€—</strong> </p><p>X86ç”µè„‘å› è€ƒè™‘è¦é€‚åº”å„ç§åº”ç”¨çš„éœ€æ±‚ï¼Œå…¶å‘å±•æ€è·¯æ˜¯ï¼šæ€§èƒ½+é€Ÿåº¦ã€‚20å¤šå¹´æ¥x86ç”µè„‘çš„é€Ÿåº¦ä»åŸæ¥8088çš„å‡ Må‘å±•åˆ°ç°åœ¨éšä¾¿å°±æ˜¯å‡ Gï¼Œè€Œä¸”è¿˜æ˜¯å‡ æ ¸ï¼Œå…¶é€Ÿåº¦å’Œæ€§èƒ½å·²ç»æå‡äº†åƒã€ä¸‡å€ï¼ŒæŠ€æœ¯è¿›æ­¥ä½¿x86ç”µè„‘æˆä¸ºå¤§ä¼—ç”Ÿæ´»ä¸­ä¸å¯ç¼ºå°‘çš„ä¸€éƒ¨åˆ†ã€‚ä½†æ˜¯x86ç”µè„‘å‘å±•çš„æ–¹å‘å’Œæ¨¡å¼ï¼Œä½¿å…¶åŠŸè€—ä¸€ç›´å±…é«˜ä¸ä¸‹ï¼Œä¸€å°ç”µè„‘éšä¾¿å°±æ˜¯å‡ ç™¾ç“¦ï¼Œå³ä½¿æ˜¯å·ç§°ä½åŠŸè€—èŠ‚èƒ½çš„æ‰‹æç”µè„‘æˆ–ä¸Šç½‘æœ¬ï¼Œä¹Ÿæœ‰åå‡ ã€äºŒåå¤šç“¦çš„åŠŸè€—ï¼Œè¿™ä¸ARMç»“æ„çš„ç”µè„‘å°±æ— æ³•ç›¸æ¯”.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;&#92;blog&#92;assets&#92;css&#92;APlayer.min.css&quot;&gt;&lt;script src=&quot;&#92;blog&#92;assets&#92;js&#92;APlayer.m</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>x86å’Œarmæ¶æ„åŒºåˆ«</title>
    <link href="https://smartxia.github.io/blog/2021/12/02/tech/devops/site/x86%E5%92%8Carm%E6%9E%B6%E6%9E%84%E5%8C%BA%E5%88%AB/"/>
    <id>https://smartxia.github.io/blog/2021/12/02/tech/devops/site/x86%E5%92%8Carm%E6%9E%B6%E6%9E%84%E5%8C%BA%E5%88%AB/</id>
    <published>2021-12-02T08:22:44.000Z</published>
    <updated>2025-10-15T09:32:54.183Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\blog\assets\css\APlayer.min.css"><script src="\blog\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\blog\assets\js\Meting.min.js"></script><h3><span id="ä»€ä¹ˆæ˜¯armæ¶æ„">ä»€ä¹ˆæ˜¯armæ¶æ„</span></h3><p>ARMæ¶æ„è¿‡å»ç§°ä¹‹ä¸ºè¿›é˜¶ç²¾ç®€æŒ‡ä»¤é›†æœºå™¨ï¼Œæ˜¯ä¸€ä¸ª32ä½çš„ç²¾ç®€æŒ‡ä»¤é›†ï¼ˆRISCï¼‰å¤„ç†å™¨æ¶æ„ï¼Œå…¶å¹¿æ³›çš„ä½¿ç”¨åœ¨åµŒå…¥å¼ç³»ç»Ÿè®¾è®¡ï¼Œç”±äºèŠ‚èƒ½çš„ç‰¹ç‚¹ï¼ŒARMéå¸¸é€‚åˆå¤„ç†ç§»åŠ¨é€šè®¯é¢†åŸŸï¼Œç¬¦åˆå…¶è®¾è®¡ç›®æ ‡ä½æ¶ˆè€— ç”µé‡çš„ç‰¹æ€§ï¼Œåœ¨ä»Šæ—¥ï¼ŒARMå®¶æ—å äº†æ‰€æœ‰32ä½åµŒå…¥å¼å¤„ç†å™¨75%çš„æ¯”ä¾‹ï¼Œä½¿å®ƒæˆä¸ºå å…¨ä¸–ç•Œæœ€å¤šæ•°çš„32ä½æ¶æ„ä¹‹ä¸€ã€‚ARMå¤„ç†å™¨å¯ä»¥åœ¨å¾ˆå¤šæ¶ˆè´¹æ€§ç”µå­äº§å“ä¸Šçœ‹åˆ°ï¼Œä»å¯æºå¼è£…ç½®ï¼ˆPDAã€ç§»åŠ¨ç”µè¯ã€å¤šåª’ä½“æ’­æ”¾å™¨ã€æŒä¸Šå‹ç”µå­æ¸¸æˆï¼Œå’Œè®¡ç®—æœºï¼‰åˆ°ç”µè„‘å¤–è®¾ï¼ˆç¡¬ç›˜ã€æ¡Œä¸Šå‹è·¯ç”±å™¨ï¼‰ç”šè‡³åœ¨å¯¼å¼¹çš„å¼¹è½½è®¡ç®—æœºç­‰å†›ç”¨è®¾æ–½ä¸­éƒ½æœ‰ä»–çš„å­˜åœ¨ã€‚åœ¨æ­¤è¿˜æœ‰ä¸€äº›åŸºäºARMè®¾è®¡çš„æ´¾ç”Ÿäº§å“ï¼Œé‡è¦äº§å“è¿˜åŒ…æ‹¬Marvellçš„XScaleæ¶æ„å’Œå¾·å·ä»ªå™¨çš„OMAPç³»åˆ—.</p><p>armæ¶æ„å›¾</p><p>ä¸‹å›¾æ‰€ç¤ºçš„æ˜¯ARMæ„æ¶å›¾ã€‚å®ƒç”±32ä½ALUã€è‹¥å¹²ä¸ª32ä½é€šç”¨å¯„å­˜å™¨ä»¥åŠçŠ¶æ€å¯„å­˜å™¨ã€32&TImes;8ä½ä¹˜æ³•å™¨ã€32&TImes;32ä½æ¡¶å½¢ç§»ä½å¯„å­˜å™¨ã€æŒ‡ä»¤è¯‘ç ä»¥åŠæ§åˆ¶é€»è¾‘ã€æŒ‡ä»¤æµæ°´çº¿å’Œæ•°æ®&#x2F;åœ°å€å¯„å­˜å™¨ç»„æˆ.</p><p><img src="http://file.elecfans.com/web1/M00/50/D9/o4YBAFr7zl2AGVr8AABPkxqzXZA667.jpg"></p><p>1ã€ALUï¼šå®ƒæœ‰ä¸¤ä¸ªæ“ä½œæ•°é”å­˜å™¨ã€åŠ æ³•å™¨ã€é€»è¾‘åŠŸèƒ½ã€ç»“æœä»¥åŠé›¶æ£€æµ‹é€»è¾‘æ„æˆã€‚</p><p>2ã€æ¡¶å½¢ç§»ä½å¯„å­˜å™¨ï¼šARMé‡‡ç”¨äº†32&TImes;32ä½çš„æ¡¶å½¢ç§»ä½å¯„å­˜å™¨ï¼Œè¿™æ ·å¯ä»¥ä½¿åœ¨å·¦ç§»&#x2F;å³ç§»nä½ã€ç¯ç§»nä½å’Œç®—æœ¯å³ç§»nä½ç­‰éƒ½å¯ä»¥ä¸€æ¬¡å®Œæˆã€‚</p><p>3ã€é«˜é€Ÿä¹˜æ³•å™¨ï¼šä¹˜æ³•å™¨ä¸€èˆ¬é‡‡ç”¨â€åŠ ä¸€ç§»ä½â€çš„æ–¹æ³•æ¥å®ç°ä¹˜æ³•ã€‚ARMä¸ºäº†æé«˜è¿ç®—é€Ÿåº¦ï¼Œåˆ™é‡‡ç”¨ä¸¤ä½ä¹˜æ³•çš„æ–¹æ³•ï¼Œæ ¹æ®ä¹˜æ•°çš„2ä½æ¥å®ç°â€åŠ ä¸€ç§»ä½â€è¿ç®—;ARMé«˜é€Ÿä¹˜æ³•å™¨é‡‡ç”¨32&TImes;8ä½çš„ç»“æ„ï¼Œè¿™æ ·ï¼Œå¯ä»¥é™ä½é›†æˆåº¦ï¼ˆå…¶ç›¸åº”èŠ¯ç‰‡é¢ç§¯ä¸åˆ°å¹¶è¡Œä¹˜æ³•å™¨çš„1&#x2F;3ï¼‰ã€‚</p><p>4ã€æµ®ç‚¹éƒ¨ä»¶ï¼šæµ®ç‚¹éƒ¨ä»¶æ˜¯ä½œä¸ºé€‰ä»¶ä¾›ARMæ„æ¶ä½¿ç”¨ã€‚FPA10æµ®ç‚¹åŠ é€Ÿå™¨æ˜¯ä½œä¸ºåå¤„ç†æ–¹å¼ä¸ARMç›¸è¿ï¼Œå¹¶é€šè¿‡åå¤„ç†æŒ‡ä»¤çš„è§£é‡Šæ¥æ‰§è¡Œã€‚</p><p>5ã€æ§åˆ¶å™¨ï¼šARMçš„æ§åˆ¶å™¨é‡‡ç”¨çš„æ˜¯ç¡¬æ¥çº¿çš„å¯ç¼–ç¨‹é€»è¾‘é˜µåˆ—PLAã€‚</p><p>6ã€å¯„å­˜å™¨</p><h2><span id="x86æ¶æ„"><strong>x86æ¶æ„</strong></span></h2><p><img src="http://file.elecfans.com/web1/M00/50/ED/pIYBAFr7zpSASlXUAABbDZ2xUGo091.jpg"></p><p>å½“ç„¶ï¼Œè¿™ä¸ªæ¶æ„å›¾å¹¶ä¸æ˜¯æ‰€æœ‰çš„éƒ½æ˜¯å¦‚æ­¤ï¼Œæ ¹æ®ä¸åŒçš„ä¸»æ¿ï¼Œå¹³å°ï¼Œæ¶æ„æ˜¯ç•¥æœ‰å·®åˆ«çš„æ¯”å¦‚è¯´ï¼Œç›®å‰å¾ˆå¤šä¸»æ¿å·²ç»å°†åŒ—æ¡¥é›†æˆåˆ°CPUå½“ä¸­ï¼Œå°†å—æ¡¥é›†æˆä¸ºPCHï¼Œä½†å¤§è‡´çš„æ¡†æ¶è¿˜æ˜¯å¦‚æ­¤çš„ã€‚ä¸‹é¢å¯¹è¿™ä¸ªæ¶æ„å›¾ä¸Šçš„å„ä¸ªå†…å®¹åˆ†åˆ«è¿›è¡Œä¸€äº›ç®€ä»‹:</p><p>   1ï¼šCPUï¼Œå¤§å®¶éƒ½ä¸é™Œç”Ÿçš„åè¯ï¼Œä¸­å¤®å¤„ç†å™¨ï¼Œè®¡ç®—æœºçš„æ ¸å¿ƒå¤§è„‘ã€‚</p><p>ã€€2ï¼š åŒ—æ¡¥ï¼ˆNorth Bridge Chipsetï¼‰ï¼šåŒ—æ¡¥æ˜¯ç”µè„‘ä¸»æ¿ä¸Šçš„ä¸€å—èŠ¯ç‰‡ï¼Œä½äºCPUæ’åº§è¾¹ï¼Œèµ·è¿æ¥ä½œç”¨ã€‚</p><p>ã€€3ï¼šå—æ¡¥èŠ¯ç‰‡ï¼ˆSouth Bridgeï¼‰æ˜¯ä¸»æ¿èŠ¯ç‰‡ç»„çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œä¸€èˆ¬ä½äºä¸»æ¿ä¸Šç¦»CPUæ’æ§½è¾ƒè¿œçš„ä¸‹æ–¹ï¼ŒPCIæ’æ§½çš„é™„è¿‘ï¼Œè¿™ç§å¸ƒå±€æ˜¯è€ƒè™‘åˆ°å®ƒæ‰€è¿æ¥çš„I&#x2F;Oæ€»çº¿è¾ƒå¤šï¼Œç¦»å¤„ç†å™¨è¿œä¸€ç‚¹æœ‰åˆ©äºå¸ƒçº¿ã€‚</p><p>ã€€4ï¼š å†…å­˜æ˜¯è®¡ç®—æœºä¸­é‡è¦çš„éƒ¨ä»¶ä¹‹ä¸€ï¼Œå®ƒæ˜¯ä¸CPUè¿›è¡Œæ²Ÿé€šçš„æ¡¥æ¢ã€‚è®¡ç®—æœºä¸­æ‰€æœ‰ç¨‹åºçš„è¿è¡Œéƒ½æ˜¯åœ¨å†…å­˜ä¸­è¿›è¡Œçš„ï¼Œå› æ­¤å†…å­˜çš„æ€§èƒ½å¯¹è®¡ç®—æœºçš„å½±å“éå¸¸å¤§ã€‚</p><p>ã€€5ï¼šæ˜¾å¡ï¼ˆVideo cardï¼ŒGraphics cardï¼‰å…¨ç§°æ˜¾ç¤ºæ¥å£å¡ï¼Œåˆç§°æ˜¾ç¤ºé€‚é…å™¨ï¼Œæ˜¯è®¡ç®—æœºæœ€åŸºæœ¬é…ç½®ã€æœ€é‡è¦çš„é…ä»¶ä¹‹ä¸€ã€‚</p><p>ã€€6ï¼šæ˜¾ç¤ºjæ¥å£</p><p>ã€€7ï¼šç½‘å¡æ˜¯å·¥ä½œåœ¨é“¾è·¯å±‚çš„ç½‘ç»œç»„ä»¶ï¼Œæ˜¯å±€åŸŸç½‘ä¸­è¿æ¥è®¡ç®—æœºå’Œä¼ è¾“ä»‹è´¨çš„æ¥å£ï¼Œä¸ä»…èƒ½å®ç°ä¸å±€åŸŸç½‘ä¼ è¾“ä»‹è´¨ä¹‹é—´çš„ç‰©ç†è¿æ¥å’Œç”µä¿¡å·åŒ¹é…ï¼Œè¿˜æ¶‰åŠå¸§çš„å‘é€ä¸æ¥æ”¶ã€å¸§çš„å°è£…ä¸æ‹†å°ã€ä»‹è´¨è®¿é—®æ§åˆ¶ã€æ•°æ®çš„ç¼–ç ä¸è§£ç ä»¥åŠæ•°æ®ç¼“å­˜çš„åŠŸèƒ½ç­‰ã€‚</p><p>ã€€8ï¼šå£°å¡çš„åŸºæœ¬åŠŸèƒ½æ˜¯æŠŠæ¥è‡ªè¯ç­’ã€ç£å¸¦ã€å…‰ç›˜çš„åŸå§‹å£°éŸ³ä¿¡å·åŠ ä»¥è½¬æ¢ï¼Œè¾“å‡ºåˆ°è€³æœºã€æ‰¬å£°å™¨ã€æ‰©éŸ³æœºã€å½•éŸ³æœºç­‰å£°å“è®¾å¤‡ï¼Œæˆ–é€šè¿‡éŸ³ä¹è®¾å¤‡æ•°å­—æ¥å£ï¼ˆMIDIï¼‰ä½¿ä¹å™¨å‘å‡ºç¾å¦™çš„å£°éŸ³ã€‚</p><p>ã€€9ï¼šSATAï¼ˆSerial Advanced Technology Attachmentï¼Œä¸²è¡Œé«˜çº§æŠ€æœ¯é™„ä»¶ï¼‰æ˜¯ä¸€ç§åŸºäºè¡Œä¸šæ ‡å‡†çš„ä¸²è¡Œç¡¬ä»¶é©±åŠ¨å™¨æ¥å£ï¼Œæ˜¯ç”±Intelã€IBMã€Dellã€APTã€Maxtorå’ŒSeagateå…¬å¸å…±åŒæå‡ºçš„ç¡¬ç›˜æ¥å£è§„èŒƒã€‚</p><p>ã€€10ï¼šç¡¬ç›˜æ˜¯ç”µè„‘ä¸»è¦çš„å­˜å‚¨åª’ä»‹ä¹‹ä¸€ï¼Œç”±ä¸€ä¸ªæˆ–è€…å¤šä¸ªé“åˆ¶æˆ–è€…ç»ç’ƒåˆ¶çš„ç¢Ÿç‰‡ç»„æˆã€‚ç¢Ÿç‰‡å¤–è¦†ç›–æœ‰é“ç£æ€§ææ–™ã€‚</p><p>ã€€11ï¼šæ€»çº¿</p><h2><span id="armæ¶æ„å’Œx86æ¶æ„æœ‰ä»€ä¹ˆåŒºåˆ«"><strong>armæ¶æ„å’Œx86æ¶æ„æœ‰ä»€ä¹ˆåŒºåˆ«</strong></span></h2><p><strong>ä¸€ã€æ€§èƒ½</strong> </p><p>â€‹    X86ç»“æ„çš„ç”µè„‘æ— è®ºå¦‚ä½•éƒ½æ¯”ARMç»“æ„çš„ç³»ç»Ÿåœ¨æ€§èƒ½æ–¹é¢è¦å¿«å¾—å¤šã€å¼ºå¾—å¤šã€‚X86çš„CPUéšä¾¿å°±æ˜¯1Gä»¥ä¸Šã€åŒæ ¸ã€å››æ ¸å¤§è¡Œå…¶é“ï¼Œé€šå¸¸ä½¿ç”¨45nmï¼ˆç”šè‡³æ›´é«˜çº§ï¼‰åˆ¶ç¨‹çš„å·¥è‰ºè¿›è¡Œç”Ÿäº§ï¼›è€ŒARMæ–¹é¢ï¼šCPUé€šå¸¸æ˜¯å‡ ç™¾å…†ï¼Œæœ€è¿‘æ‰å‡ºç°1Gå·¦å³çš„CPUï¼Œåˆ¶ç¨‹é€šå¸¸ä½¿ç”¨ä¸åˆ°65nmåˆ¶ç¨‹çš„å·¥è‰ºï¼Œå¯ä»¥è¯´åœ¨æ€§èƒ½å’Œç”Ÿäº§å·¥è‰ºæ–¹é¢ARMæ ¹æœ¬ä¸æ˜¯X86ç»“æ„ç³»ç»Ÿçš„å¯¹æ‰‹ã€‚</p><p>ã€€ã€€ä½†ARMçš„ä¼˜åŠ¿ä¸åœ¨äºæ€§èƒ½å¼ºå¤§è€Œåœ¨äºæ•ˆç‡ï¼ŒARMé‡‡ç”¨RISCæµæ°´çº¿æŒ‡ä»¤é›†ï¼Œåœ¨å®Œæˆç»¼åˆæ€§å·¥ä½œæ–¹é¢æ ¹æœ¬å°±å¤„äºåŠ£åŠ¿ï¼Œè€Œåœ¨ä¸€äº›ä»»åŠ¡ç›¸å¯¹å›ºå®šçš„åº”ç”¨åœºåˆå…¶ä¼˜åŠ¿å°±èƒ½å‘æŒ¥å¾—æ·‹æ¼“å°½è‡´.</p><p><strong>äºŒã€æ‰©å±•èƒ½åŠ›</strong></p><p>â€‹    X86ç»“æ„çš„ç”µè„‘é‡‡ç”¨â€æ¡¥â€çš„æ–¹å¼ä¸æ‰©å±•è®¾å¤‡ï¼ˆå¦‚ï¼šç¡¬ç›˜ã€å†…å­˜ç­‰ï¼‰è¿›è¡Œè¿æ¥ï¼Œè€Œä¸”x86ç»“æ„çš„ç”µè„‘å‡ºç°äº†è¿‘30å¹´ï¼Œå…¶é…å¥—æ‰©å±•çš„è®¾å¤‡ç§ç±»å¤šã€ä»·æ ¼ä¹Ÿæ¯”è¾ƒä¾¿å®œï¼Œæ‰€ä»¥x86ç»“æ„çš„ç”µè„‘èƒ½å¾ˆå®¹æ˜“è¿›è¡Œæ€§èƒ½æ‰©å±•ï¼Œå¦‚å¢åŠ å†…å­˜ã€ç¡¬ç›˜ç­‰.</p><p>ã€€ã€€ARMç»“æ„çš„ç”µè„‘æ˜¯é€šè¿‡ä¸“ç”¨çš„æ•°æ®æ¥å£ä½¿CPUä¸æ•°æ®å­˜å‚¨è®¾å¤‡è¿›è¡Œè¿æ¥ï¼Œæ‰€ä»¥ARMçš„å­˜å‚¨ã€å†…å­˜ç­‰æ€§èƒ½æ‰©å±•éš¾ä»¥è¿›è¡Œï¼ˆä¸€èˆ¬åœ¨äº§å“è®¾è®¡æ—¶å·²ç»å®šå¥½å…¶å†…å­˜åŠæ•°æ®å­˜å‚¨çš„å®¹é‡ï¼‰ï¼Œæ‰€ä»¥é‡‡ç”¨ARMç»“æ„çš„ç³»ç»Ÿï¼Œä¸€èˆ¬ä¸è€ƒè™‘æ‰©å±•ã€‚åŸºæœ¬å¥‰è¡Œâ€å¤Ÿç”¨å°±å¥½â€çš„åŸåˆ™.</p><p> <strong>ä¸‰ã€æ“ä½œç³»ç»Ÿçš„å…¼å®¹æ€§</strong></p><p>â€‹    X86ç³»ç»Ÿç”±å¾®è½¯åŠIntelæ„å»ºçš„Wintelè”ç›Ÿä¸€ç»Ÿå¤©ä¸‹ï¼Œå„æ–­äº†ä¸ªäººç”µè„‘æ“ä½œç³»ç»Ÿè¿‘30å¹´ï¼Œå½¢æˆå·¨å¤§çš„ç”¨æˆ·ç¾¤ï¼Œä¹Ÿæ·±æ·±å›ºåŒ–äº†ä¼—å¤šç”¨æˆ·çš„ä½¿ç”¨ä¹ æƒ¯ï¼ŒåŒæ—¶x86ç³»ç»Ÿåœ¨ç¡¬ä»¶å’Œè½¯ä»¶å¼€å‘æ–¹é¢å·²ç»å½¢æˆç»Ÿä¸€çš„æ ‡å‡†ï¼Œå‡ ä¹æ‰€æœ‰x86ç¡¬ä»¶å¹³å°éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨å¾®è½¯çš„è§†çª—ç³»ç»ŸåŠç°åœ¨æµè¡Œçš„å‡ ä¹æ‰€æœ‰å·¥å…·è½¯ä»¶ï¼Œæ‰€ä»¥x86ç³»ç»Ÿåœ¨å…¼å®¹æ€§æ–¹é¢å…·æœ‰æ— å¯æ¯”æ‹Ÿçš„ä¼˜åŠ¿ã€‚</p><p>ã€€ã€€ARMç³»ç»Ÿå‡ ä¹éƒ½é‡‡ç”¨<strong>Linux</strong>çš„æ“ä½œç³»ç»Ÿï¼Œè€Œä¸”å‡ ä¹æ‰€æœ‰çš„ç¡¬ä»¶ç³»ç»Ÿéƒ½è¦å•ç‹¬æ„å»ºè‡ªå·±çš„ç³»ç»Ÿï¼Œä¸å…¶ä»–ç³»ç»Ÿä¸èƒ½å…¼å®¹ï¼Œè¿™ä¹Ÿå¯¼è‡´å…¶åº”ç”¨è½¯ä»¶ä¸èƒ½æ–¹ä¾¿ç§»æ¤ï¼Œè¿™ä¸€ç‚¹ä¸€ç›´ä¸¥é‡åˆ¶çº¦äº†ARMç³»ç»Ÿçš„å‘å±•å’Œåº”ç”¨ã€‚GOOGLEå¼€å‘äº†å¼€æ”¾å¼çš„<strong>Android</strong>ç³»ç»Ÿåï¼Œç»Ÿä¸€äº†ARMç»“æ„ç”µè„‘çš„æ“ä½œç³»ç»Ÿï¼Œä½¿æ–°æ¨å‡ºåŸºäºARMç»“æ„çš„ç”µè„‘ç³»ç»Ÿæœ‰äº†ç»Ÿä¸€çš„ã€å¼€æ”¾å¼çš„ã€å…è´¹çš„æ“ä½œç³»ç»Ÿï¼Œä¸ºARMçš„å‘å±•æä¾›äº†å¼ºå¤§çš„æ”¯æŒå’ŒåŠ¨åŠ›.</p><p><strong>å››ã€è½¯ä»¶å¼€å‘çš„æ–¹ä¾¿æ€§åŠå¯ä½¿ç”¨å·¥å…·çš„å¤šæ ·æ€§</strong></p><p>â€‹    X86ç»“æ„çš„ç³»ç»Ÿæ¨å‡ºå·²ç»è¿‘30å¹´ï¼Œåœ¨æ­¤æœŸé—´ï¼Œx86ç”µè„‘ç»è¿‡é£é€Ÿå‘å±•çš„é»„é‡‘æ—¶æœŸï¼Œç”¨æˆ·çš„åº”ç”¨ã€è½¯ä»¶é…å¥—ã€è½¯ä»¶å¼€å‘å·¥å…·çš„é…å¥—åŠå…¼å®¹ç­‰å·¥ä½œï¼Œå·²ç»åˆ°è¾¾éå¸¸æˆç†Ÿç”šè‡³å¯ä»¥è¯´æ˜¯å®Œç¾çš„å¢ƒç•Œã€‚æ‰€ä»¥ä½¿ç”¨X86ç”µè„‘ç³»ç»Ÿä¸ä»…æœ‰å¤§é‡çš„ç¬¬ä¸‰æ–¹è½¯ä»¶å¯ä¾›é€‰æ‹©ï¼Œä¹Ÿæœ‰å¤§é‡çš„è½¯ä»¶ç¼–ç¨‹å·¥å…·å¯ä»¥å¸®åŠ©æ‚¨å®Œæˆæ‚¨æ‰€å¸Œæœ›å®Œæˆçš„å·¥ä½œã€‚</p><p>ã€€ã€€Armç»“æ„çš„ç”µè„‘ç³»ç»Ÿå› ä¸ºç¡¬ä»¶æ€§èƒ½çš„åˆ¶çº¦ã€æ“ä½œç³»ç»Ÿçš„ç²¾ç®€ã€ä»¥åŠç³»ç»Ÿå…¼å®¹ç­‰é—®é¢˜çš„åˆ¶çº¦ï¼Œé€ æˆArmç»“æ„çš„ç”µè„‘ç³»ç»Ÿä¸å¯èƒ½åƒX86ç”µè„‘ç³»ç»Ÿé‚£æ ·æœ‰ä¼—å¤šçš„ç¼–ç¨‹å·¥å…·å’Œç¬¬ä¸‰æ–¹è½¯ä»¶å¯ä¾›é€‰æ‹©åŠä½¿ç”¨ï¼ŒARMçš„ç¼–ç¨‹è¯­è¨€å¤§å¤šé‡‡ç”¨Cå’ŒJAVAã€‚</p><p>ã€€ã€€å¯¹è¿™ä¸€ç‚¹çš„æ¯”è¾ƒï¼Œæ›´ç›´æ¥çš„ç»“è®ºæ˜¯ï¼šåŸºäºx86ç»“æ„ç”µè„‘ç³»ç»Ÿå¹³å°å¼€å‘è½¯ä»¶æ¯”armç»“æ„ç³»ç»Ÿæ›´å®¹æ˜“ã€æ›´ç®€å•ã€å®é™…æˆæœ¬ä¹Ÿæ›´ä½ï¼ŒåŒæ—¶æ›´å®¹æ˜“æ‰¾åˆ°ç¬¬ä¸‰æ–¹è½¯ä»¶ï¼ˆå…å»è‡ªå·±å¼€å‘çš„æ—¶é—´å’Œæˆæœ¬ï¼‰ï¼Œè€Œä¸”è½¯ä»¶ç§»æ¤æ›´å®¹æ˜“ã€‚</p><p>ã€€ã€€ä»ä»¥ä¸Šå¯¹æ¯”åˆ†æï¼Œç»™äº†æˆ‘ä»¬çš„ä¸€ä¸ªå¾ˆæ¸…æ™°çš„æ„Ÿè§‰ï¼ŒARMå’ŒX86ç»“æ„çš„ç”µè„‘æ ¹æœ¬å°±æ— æ³•å¯¹æ¯”ï¼ŒARMæ ¹æœ¬å°±ä¸æ˜¯X86ç”µè„‘çš„çš„å¯¹æ‰‹ã€‚æ˜¯çš„ï¼Œå¦‚æœåªè€ƒè™‘ä¸Šè¿°å‡ ä¸ªæ–¹é¢çš„è¦æ•°ï¼ŒARMç¡®å®æ— æ³•ä¸X86ç”µè„‘ç«äº‰ï¼Œç”šè‡³è¿æ¯”è¾ƒçš„èµ„æ ¼éƒ½æ²¡æœ‰ã€‚ä½†æ˜¯è¿‘1ã€2å¹´ï¼ŒARMçš„äº§å“åœ¨ç»ˆç«¯åº”ç”¨ç‰¹åˆ«æ˜¯æ‰‹æŒç»ˆç«¯åº”ç”¨é£é€Ÿå‘å±•ï¼ˆå¦‚ï¼šæ™ºèƒ½æ‰‹æœºã€å¹³æ¿ç”µè„‘ç­‰ï¼‰ï¼Œå…¶é”€å”®æ•°é‡å·²ç»è¿œè¿œè¶…å‡ºx86ç»“æ„çš„ç”µè„‘é”€å”®æ•°é‡ï¼Œå¯è§ARMæ˜¯å…·æœ‰å…¶ä¸X86ç»“æ„ç”µè„‘ä¸å¯å¯¹æ¯”çš„ä¼˜åŠ¿ã€‚è¯¥ä¼˜åŠ¿å°±æ˜¯ï¼š<strong>åŠŸè€—.</strong></p><p><strong>äº”ã€åŠŸè€—</strong> </p><p>X86ç”µè„‘å› è€ƒè™‘è¦é€‚åº”å„ç§åº”ç”¨çš„éœ€æ±‚ï¼Œå…¶å‘å±•æ€è·¯æ˜¯ï¼šæ€§èƒ½+é€Ÿåº¦ã€‚20å¤šå¹´æ¥x86ç”µè„‘çš„é€Ÿåº¦ä»åŸæ¥8088çš„å‡ Må‘å±•åˆ°ç°åœ¨éšä¾¿å°±æ˜¯å‡ Gï¼Œè€Œä¸”è¿˜æ˜¯å‡ æ ¸ï¼Œå…¶é€Ÿåº¦å’Œæ€§èƒ½å·²ç»æå‡äº†åƒã€ä¸‡å€ï¼ŒæŠ€æœ¯è¿›æ­¥ä½¿x86ç”µè„‘æˆä¸ºå¤§ä¼—ç”Ÿæ´»ä¸­ä¸å¯ç¼ºå°‘çš„ä¸€éƒ¨åˆ†ã€‚ä½†æ˜¯x86ç”µè„‘å‘å±•çš„æ–¹å‘å’Œæ¨¡å¼ï¼Œä½¿å…¶åŠŸè€—ä¸€ç›´å±…é«˜ä¸ä¸‹ï¼Œä¸€å°ç”µè„‘éšä¾¿å°±æ˜¯å‡ ç™¾ç“¦ï¼Œå³ä½¿æ˜¯å·ç§°ä½åŠŸè€—èŠ‚èƒ½çš„æ‰‹æç”µè„‘æˆ–ä¸Šç½‘æœ¬ï¼Œä¹Ÿæœ‰åå‡ ã€äºŒåå¤šç“¦çš„åŠŸè€—ï¼Œè¿™ä¸ARMç»“æ„çš„ç”µè„‘å°±æ— æ³•ç›¸æ¯”.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;&#92;blog&#92;assets&#92;css&#92;APlayer.min.css&quot;&gt;&lt;script src=&quot;&#92;blog&#92;assets&#92;js&#92;APlayer.m</summary>
      
    
    
    
    <category term="è¿ç»´éƒ¨ç½²" scheme="https://smartxia.github.io/blog/categories/%E8%BF%90%E7%BB%B4%E9%83%A8%E7%BD%B2/"/>
    
    
  </entry>
  
  <entry>
    <title>HTTP è¯·æ±‚æ–¹æ³•ä¹‹CONNECT method</title>
    <link href="https://smartxia.github.io/blog/2021/11/25/tech/network/http/HTTP-%E8%AF%B7%E6%B1%82%E6%96%B9%E6%B3%95%E4%B9%8BCONNECT-method/"/>
    <id>https://smartxia.github.io/blog/2021/11/25/tech/network/http/HTTP-%E8%AF%B7%E6%B1%82%E6%96%B9%E6%B3%95%E4%B9%8BCONNECT-method/</id>
    <published>2021-11-25T01:36:06.000Z</published>
    <updated>2024-03-12T03:55:12.824Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\blog\assets\css\APlayer.min.css"><script src="\blog\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\blog\assets\js\Meting.min.js"></script><blockquote><p>HTTP1.1 ä¸­çš„connect<br>1.httpè¯·æ±‚ä»£ç†å°±æ˜¯connectè¿™ä¸ªæ–¹æ³•ï¼Œconnectç½‘é¡µå¼€å‘ä¸­ä¸ä¼šä½¿ç”¨<br>2.connectçš„ä½œç”¨å°†æœåŠ¡å™¨ä½œä¸ºä»£ç†ï¼Œè®©æœåŠ¡å™¨æç”¨æˆ·è®¿é—®å…¶ä»–ç½‘é¡µï¼ˆç¿»å¢™ï¼‰ï¼Œä¹‹åå°†æ•°æ®è¿”å›ç”¨æˆ·<br>3.connectæ˜¯å°†é€šè¿‡TCPä»£ç†é“¾æ¥æœåŠ¡å™¨çš„ï¼Œå‡å¦‚æˆ‘æƒ³è®©ä»£ç†æœåŠ¡å™¨è®¿é—®ï¼Œ<a href="https://baidu.comç½‘ç«™,é¦–å…ˆè¦ç®€å†ä¸€æ¡å®¢æˆ·ç«¯åˆ°ä»£ç†æœåŠ¡å™¨çš„tcpçš„é“¾æ¥/">https://baidu.comç½‘ç«™ï¼Œé¦–å…ˆè¦ç®€å†ä¸€æ¡å®¢æˆ·ç«¯åˆ°ä»£ç†æœåŠ¡å™¨çš„tcpçš„é“¾æ¥</a><br>ç„¶åç»™ä»£ç†æœåŠ¡å™¨å‘é€ä¸€ä¸ªhttpæŠ¥æ–‡</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CONNECT https://www.jianshu.com/u/f67233ce6c0c:80 HTTP/1.1</span><br><span class="line">Host: www.web-tinker.com:80</span><br><span class="line">Proxy-Connection: Keep-Alive</span><br><span class="line">Proxy-Authorization: Basic *</span><br><span class="line">Content-Length: 0</span><br></pre></td></tr></table></figure><p>åœ¨å‘é€å®Œè¿™ä¸ªè¯·æ±‚ä¹‹åï¼Œä»£ç†æœåŠ¡å™¨ä¼šå“åº”è¯·æ±‚ï¼Œè¿”å›ä¸€ä¸ª200çš„ä¿¡æ¯ï¼Œä½†è¿™ä¸ª200å¹¶ä¸åŒäºæˆ‘ä»¬å¹³æ—¶è§åˆ°çš„OKï¼Œè€Œæ˜¯Connection Established</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;&#92;blog&#92;assets&#92;css&#92;APlayer.min.css&quot;&gt;&lt;script src=&quot;&#92;blog&#92;assets&#92;js&#92;APlayer.m</summary>
      
    
    
    
    <category term="HTTP" scheme="https://smartxia.github.io/blog/categories/HTTP/"/>
    
    
  </entry>
  
  <entry>
    <title>å¼±åŠ¿æ–‡åŒ–</title>
    <link href="https://smartxia.github.io/blog/2021/11/22/%E6%88%91%E7%9A%84%E6%97%A5%E8%AE%B0/%E5%BC%B1%E5%8A%BF%E6%96%87%E5%8C%96/"/>
    <id>https://smartxia.github.io/blog/2021/11/22/%E6%88%91%E7%9A%84%E6%97%A5%E8%AE%B0/%E5%BC%B1%E5%8A%BF%E6%96%87%E5%8C%96/</id>
    <published>2021-11-22T05:37:08.000Z</published>
    <updated>2024-03-12T03:55:12.916Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\blog\assets\css\APlayer.min.css"><script src="\blog\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\blog\assets\js\Meting.min.js"></script><p><img src="https://pic1.zhimg.com/v2-bb213c477bc9d02350862acc72395838_720w.jpg?source=3af55fa1" alt="preview"></p><p>çŸ¥è¯†çš„å¿«é¤ï¼šæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦æ‡‚ç‚¹å“²å­¦<br>ä»€ä¹ˆæ˜¯å“²å­¦ï¼Œå“²å­¦å¯ä¸å¯ä»¥ç†è§£æˆä¸ºäººçš„è®¤çŸ¥çš„å·®å¼‚ï¼Œå“²å­¦é‡Œçš„æ–‡åŒ–å±æ€§åˆ°åº•ä»£è¡¨ç€ä»€ä¹ˆ</p><blockquote><p>é—²æš‡äº§ç”Ÿæ€è¾¨ï¼Œæ€è¾¨æ¶ˆè§£æ•™æ¡ä¸»ä¹‰å’Œé™ˆè…ä¹ ä¿—ï¼Œå‘å±•å‡ºæ•é”çš„æ„ŸçŸ¥ï¼Œè®©äººä¸§å¤±è¡ŒåŠ¨çš„å†³æ–­ã€‚</p><p>æ€æƒ³ï¼Œåœ¨åˆ†æè¿·å®«å†’é™©å‰è¡Œï¼Œå‘ç°ç¤¾ä¼šèƒŒåçš„ä¸ªä½“ï¼Œç»ç’ƒå…¶æ­£å¸¸çš„ç¤¾ä¼šåŠŸèƒ½ï¼Œè½¬å‘å†…åœ¨ï¼Œå‘ç°è‡ªæˆ‘</p><p>å…±åŒçš„åˆ©ç›Šï¼Œå’Œå…±åŒä½“çš„æ„è¯†è¡°é€€ï¼Œå¦‚ä»Šæ²¡æœ‰å…¬æ°‘åªæœ‰ä¸ªäºº</p><p>ä¸ªä½“é€šè¿‡æ€ç´¢æ„è¯†åˆ°è‡ªå·±æœ¬èº«å°±æ˜¯ç”Ÿå­˜çš„ç›®çš„ï¼Œä»–è¦æ±‚å›½é™…ä»æ­¤ä»¥å¾€åŠ å¼ºè€Œä¸æ˜¯åˆ©ç”¨ä»–çš„èƒ½åŠ›ï¼Œä»¥æ­¤ä¸ºä»£ä»·ï¼Œä¸ªäººå°†ç»´æŒå›½å®¶çš„æŒç»­</p></blockquote><p><strong>ç¤¾ä¼šç»æµçš„å‘å±•å¸¦æ¥çš„æˆ‘ä»¬ç‰©è´¨å’Œç”Ÿæ´»çš„å¢é•¿ï¼Œè¢«å† ä»¥ç€æ•°åå¹´æ¥é€šè¿‡ä¸ªä½“åŠªåŠ›çš„ç»“æœï¼Œäºæ˜¯å›½å®¶é€ å°±äº†å¼±åŠ¿æ–‡åŒ–çš„å…¸å‹æ€æƒ³:è¯¯ä»¥ä¸ºå°†è‡ªå·±çš„ç”Ÿæ´»æ°´å¹³çš„æé«˜ï¼Œæ˜¯é€šè¿‡è‡ªå·±å‹¤åŠ³è·å–çš„ï¼Œæ®Šä¸çŸ¥è¿™æ˜¯åƒç€å›½å®¶çš„çº¢åˆ©ï¼Œè€Œå¹¶éè‡ªå·±çœŸçš„å¯ä»¥é€šè¿‡çœŸæ­£çš„åŠªåŠ›è·å–çš„æ¸©é¥±</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;&#92;blog&#92;assets&#92;css&#92;APlayer.min.css&quot;&gt;&lt;script src=&quot;&#92;blog&#92;assets&#92;js&#92;APlayer.m</summary>
      
    
    
    
    <category term="diary" scheme="https://smartxia.github.io/blog/categories/diary/"/>
    
    
  </entry>
  
  <entry>
    <title>GOLANG-GPMçš„æ·±å…¥ç†è§£</title>
    <link href="https://smartxia.github.io/blog/2021/11/18/tech/backend/golang/GOLANG-%E7%AC%94%E8%AE%B012-GPM%E7%9A%84%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3/"/>
    <id>https://smartxia.github.io/blog/2021/11/18/tech/backend/golang/GOLANG-%E7%AC%94%E8%AE%B012-GPM%E7%9A%84%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3/</id>
    <published>2021-11-18T02:08:03.000Z</published>
    <updated>2024-03-12T03:55:12.806Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\blog\assets\css\APlayer.min.css"><script src="\blog\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\blog\assets\js\Meting.min.js"></script><p>æ·±å…¥golang runtimeçš„è°ƒåº¦</p><h3><span id="ç†è§£è°ƒåº¦å™¨çš„å¯åŠ¨">ç†è§£è°ƒåº¦å™¨çš„å¯åŠ¨</span></h3><p>runtimeï¼š</p><p>scheduler:</p><p>TLS:</p><p>spinning:</p><p>systemstack,mcall,asmcgocall</p><p>ä¸»è¦æºç æ–‡ä»¶:</p><p>è°ƒåº¦åŸºæœ¬ç»„ä»¶ï¼š</p><p>**G(goroutine)**ï¼šè°ƒåº¦å™¨çš„åŸºæœ¬å•ä½ï¼Œå­˜å‚¨çš„goroutineçš„æ‰§è¡Œstackä¿¡æ¯ï¼ŒçŠ¶æ€ä»¥åŠä»»åŠ¡å‡½æ•°</p><p>åœ¨gçš„çœ¼ä¸­åªæœ‰p,på°±æ˜¯è¿è¡Œçš„Gçš„â€œCPUâ€</p><p>ç›¸å½“äºä¸¤çº§çº¿ç¨‹</p><blockquote><p>gçš„ä»»åŠ¡å‡½æ•°</p></blockquote><p>æ¯ä¸ªgçš„å®ä¾‹éƒ½æœ‰ä»»åŠ¡å‡½æ•°ï¼Œå¦‚ä¸‹ä»£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">userFun:=func()&#123;fmt.Println(&quot;111&quot;)&#125;</span><br><span class="line">go userFunc();</span><br></pre></td></tr></table></figure><p>goçš„å…³é”®è¯åˆ›å»ºäº†ä¸€ä¸ªgoroutine,æ­¤æ—¶gouroutineçš„ä»»åŠ¡å‡½æ•°userFun</p><p><strong>Pï¼ˆprocessorï¼‰</strong></p><p>pè¡¨ç¤ºé€»è¾‘processorï¼Œä»£è¡¨Mæ‰§è¡Œçš„ä¸Šä¸‹æ–‡</p><p>pçš„æœ€å¤§ä½œç”¨æ˜¯æ‹¥æœ‰å„ç§Gçš„å¯¹è±¡é˜Ÿåˆ—ï¼Œé“¾è¡¨ï¼Œcache,å’ŒçŠ¶æ€</p><p>pçš„æ•°é‡ä¹Ÿä»£è¡¨goçš„æ‰§è¡Œå¹¶å‘åº¦ï¼Œå³å¤šå°‘ä¸ªgoroutineå¯ä»¥åŒæ—¶æ‰§è¡Œ</p><p>è¿™é‡Œçš„pè™½ç„¶è¡¨ç¤ºé€»è¾‘å¤„ç†å™¨ï¼Œä½†æ˜¯på¹¶ä¸ä»£è¡¨ä»»ä½•æ‰§è¡Œä»£ç ï¼Œå¯¹äºgæ¥è¯´ï¼Œpç›¸å½“äºcpuçš„æ ¸ï¼Œgåªæœ‰ç»‘å®špæ‰èƒ½è°ƒåº¦ã€‚å¯¹äºMæ¥è¯´ï¼Œpæä¾›äº†æ‰§è¡Œç¯å¢ƒï¼ˆContextï¼‰ï¼Œå¦‚åˆ†é…å†…å­˜çŠ¶æ€ï¼ˆmcacheï¼‰,ä»»åŠ¡é˜Ÿåˆ—Gç­‰</p><p><strong>M(machine)</strong></p><p>Mä»£è¡¨çœŸæ­£çš„æ‰§è¡Œè®¡ç®—èµ„æºï¼Œå¯ä»¥ä»»åŠ¡ä»–å°±æ˜¯os thread(ç³»ç»Ÿçº¿ç¨‹)</p><p>Mæ˜¯çœŸæ­£çš„æ‰§è¡Œè€…ï¼Œæ¯ä¸ªMå°±åƒä¸€ä¸ªå‹¤åŠ³çš„å·¥ä½œè€…ï¼Œæ€»æ˜¯ä»å„ç§é˜Ÿåˆ—æ‰¾åˆ°å¯è¿è¡Œçš„G,è€Œä¸”è¿™æ ·çš„Mçš„å¯ä»¥åŒæ—¶å­˜åœ¨å¤šä¸ª</p><p>Måœ¨ç»‘å®šæœ‰æ•ˆPï¼Œå¯ä»¥è¿›è¡Œè°ƒåº¦å¾ªç¯ï¼Œè€Œä¸”Må¹¶ä¸ä¿ç•™GçŠ¶æ€ï¼Œè¿™ä¸ªæ˜¯gå¯ä»¥è·¨Mè°ƒåº¦çš„åŸºç¡€</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;&#92;blog&#92;assets&#92;css&#92;APlayer.min.css&quot;&gt;&lt;script src=&quot;&#92;blog&#92;assets&#92;js&#92;APlayer.m</summary>
      
    
    
    
    <category term="GOLANG" scheme="https://smartxia.github.io/blog/categories/GOLANG/"/>
    
    
    <category term="golang" scheme="https://smartxia.github.io/blog/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>GOLANG-çº¯çº¯çš„è¯­æ³•ä»”çš„æ²¡è½</title>
    <link href="https://smartxia.github.io/blog/2021/11/17/tech/backend/golang/GOLANG-%E7%AC%94%E8%AE%B09-%E7%BA%AF%E7%BA%AF%E7%9A%84%E8%AF%AD%E6%B3%95%E4%BB%94%E7%9A%84%E6%B2%A1%E8%90%BD/"/>
    <id>https://smartxia.github.io/blog/2021/11/17/tech/backend/golang/GOLANG-%E7%AC%94%E8%AE%B09-%E7%BA%AF%E7%BA%AF%E7%9A%84%E8%AF%AD%E6%B3%95%E4%BB%94%E7%9A%84%E6%B2%A1%E8%90%BD/</id>
    <published>2021-11-17T03:57:39.000Z</published>
    <updated>2024-03-12T03:55:12.821Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\blog\assets\css\APlayer.min.css"><script src="\blog\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\blog\assets\js\Meting.min.js"></script><h2><span id="åŸºç¡€">åŸºç¡€</span></h2><h3><span id="1-å¯¹äºå·²ç»å…³é—­çš„channelçš„å¤„ç†">1. å¯¹äºå·²ç»å…³é—­çš„channelçš„å¤„ç†</span></h3><p>è¯»å·²ç»å…³é—­çš„channelï¼Œä¸€ç›´èƒ½è¯»åˆ°ä¸œè¥¿ï¼Œä½†æ˜¯è¯»åˆ°çš„ä¸œè¥¿æ ¹æ®é€šé“å†…å…³é—­å‰æ˜¯å¦æœ‰å…ƒç´ è€Œä¸åŒï¼Œ</p><ul><li>å…³é—­å‰ï¼Œbufferæœ‰è¿˜æœªè¯»å–çš„ï¼Œä¼šè¯»å–åˆ°chanå†…çš„å€¼ï¼Œä¸”è¿”å›æ˜¯å¦è¯»å–æˆåŠŸçš„boolå€¼ä¸ºtrue</li><li>å…³é—­å‰ï¼Œbufferçš„å€¼è¯»å®Œï¼Œchannelå…ƒç´ å€¼ä¸º0ï¼Œboolå€¼ä¸ºfalse</li></ul><p>å†™å…¥ï¼šç›´æ¥panic</p><h3><span id="2-makeå’ŒnewåŒºåˆ«">2. Makeå’ŒnewåŒºåˆ«</span></h3><p>makeï¼šè¿”å›ç‰¹å®šç±»å‹channelï¼Œslice,map</p><p>new: å¼€è¾Ÿæ–°å†…å­˜å’ŒæŒ‡é’ˆï¼Œæ³›åŒ–ç±»å‹</p><h3><span id="3-nil-åˆ‡ç‰‡å’Œç©ºåˆ‡ç‰‡ä¸€ä¸ä¸€æ ·">3. nil åˆ‡ç‰‡å’Œç©ºåˆ‡ç‰‡ä¸€ä¸ä¸€æ ·</span></h3><p>æŒ‡å‘çš„åœ°å€ä¸ä¸€æ ·ã€‚nillå¼•ç”¨æŒ‡é’ˆåœ°å€ä¸º0ï¼Œç©ºåˆ‡ç‰‡æ‰§è¡Œæ•°ç»„æŒ‡é’ˆåœ°å€ï¼Œä¸”ä¸ºä¸€ä¸ªå›ºå®šå€¼</p><p>æ•°æ®ç»“æ„ï¼šdata,len,cap</p><h3><span id="4-å­—ç¬¦ä¸²è½¬byteæ•°ç»„ä¼šå‘ç”Ÿå†…å­˜æ‹·è´å—">4. å­—ç¬¦ä¸²è½¬byteæ•°ç»„ï¼Œä¼šå‘ç”Ÿå†…å­˜æ‹·è´å—</span></h3><p>ä¸¥æ ¼æ¥è¯´ï¼Œåªè¦å‘ç”Ÿç±»å‹å¼ºè½¬ï¼Œéƒ½ä¼šå‘ç”Ÿå†…å­˜æ‹·è´ã€‚</p><p>é‚£ä¹ˆgoæœ‰ä¸ªå¾ˆå¼ºçš„åŒ…å« <code>unsafe</code> ã€‚å…ˆè·å–å˜é‡åœ°å€ï¼Œå­—ç¬¦ä¸²è½¬æˆåº•å±‚ç»“æ„ï¼Œé€šè¿‡unsafeåŒ…ï¼Œè½¬ä¸ºåˆ‡ç‰‡æ•°ç»„,å†é€šè¿‡æŒ‡é’ˆæŒ‡å‘å®é™…å†…å®¹</p><p>string æ•°æ®ç»“æ„ {data,len} </p><h3><span id="5-jsonåŒ…å˜é‡ä¸åŠ tagä¼šæ€ä¹ˆæ ·">5. jsonåŒ…å˜é‡ä¸åŠ tagä¼šæ€ä¹ˆæ ·</span></h3><p>å’Œkeyçš„å¤§å°å†™æœ‰å…³</p><h3><span id="6-gpm">6. GPM</span></h3><p>æŒ‡å‘å¦ä¸€ç¯‡è¯¦ç»†ï¼ˆï¼‰</p><h3><span id="7docker-çš„ç½‘ç»œé€šä¿¡æ¨¡å¼">7.Docker çš„ç½‘ç»œé€šä¿¡æ¨¡å¼ã€‚</span></h3><p>å››ç§ï¼š</p><p>1.hostæ¨¡å¼ï¼šå’Œå®¿ä¸»æœºå…¬ç”¨ä¸€ä¸ªnetwork NameSpace ã€‚å®¹å™¨ä¸ä¼šé…ç½®ä»»ä½•è‡ªå·±ç½‘å¡ï¼Œè€Œæ˜¯ä½¿ç”¨è‡ªå·±å®¿ä¸»æœºçš„IPå’Œç«¯å£</p><p>2.containeræ¨¡å¼ï¼šæŒ‡å®šå’Œå…¶ä»–å®¹å™¨å…±äº«network nameSpace,è€Œä¸æ˜¯å’Œå®¿ä¸»æœºå…±äº«</p><p>3.noneæ¨¡å¼ï¼šå‘Šè¯‰å®¹å™¨æ”¾åˆ°è‡ªå·±ç½‘ç«™å †é‡Œï¼Œä½†æ˜¯ä¸è¦é…ç½®ä»–çš„ç½‘ç»œ</p><p>4.bridegæ¨¡å¼ï¼šdockeré»˜è®¤çš„ç½‘ç»œæ¨¡å¼ï¼Œæ­¤æ¨¡å¼ä¼šå°†ä¸»æœºdockeré“¾æ¥åˆ°è™šæ‹Ÿç½‘æ¡¥ä¸Š</p><h3><span id="8è®¿é—®ç§æœ‰æˆå‘˜">8.è®¿é—®ç§æœ‰æˆå‘˜</span></h3><blockquote><p>è°ƒç”¨å…¶ä»–åŒ…å…±æœ‰ç»“æ„çš„ç§æœ‰æˆå‘˜å˜<strong>é‡</strong></p></blockquote><p><strong>ç»•è¿‡å°å†™ä¸å…¬å¼€</strong></p><p>ç”¨unsafeåŒ…ä¸­çš„unsafe.Pointerè·å–åˆ°ç»“æ„ä½“å¯¹è±¡çš„é¦–åœ°å€ï¼Œç„¶ååŠ ä¸Šæƒ³è®¿é—®çš„ç§æœ‰å˜é‡çš„åç§»åœ°å€å°±æ˜¯ç§æœ‰å˜é‡çš„åœ°å€</p><h3><span id="9-æ•°ç»„å’Œåˆ‡ç‰‡çš„åŒºåˆ«">9ã€æ•°ç»„å’Œåˆ‡ç‰‡çš„åŒºåˆ«</span></h3><p>é•¿åº¦ï¼Œå®¹é‡ï¼Œæ•°ç»„æŒ‡é’ˆ</p><p>åˆ‡ç‰‡æ˜¯æŒ‡é’ˆç±»å‹ï¼Œæ•°ç»„æ˜¯æ˜¯å€¼ç±»å‹</p><p>æ•°æ®é•¿åº¦å›ºå®šï¼Œåˆ‡ç‰‡ä¸å›ºå®š</p><p>åˆ‡ç‰‡æ¯”æ•°ç»„å¤šä¸ªå±æ€§ï¼ˆcapï¼‰,åˆ‡ç‰‡åº•å±‚æ˜¯æ•°ç»„</p><ul><li>æ‰©å®¹ï¼šå°äº1024 æ¯æ¬¡capç¿»å€ï¼Œè¶…è¿‡å˜æˆ1.25</li><li>æ‰©å®¹åæ²¡è§¦åŠåŸæ•°ç»„å®¹é‡ï¼Œé‚£ä¹ˆåˆ‡ç‰‡æŒ‡é’ˆæŒ‡å‘çš„ä½ç½®ï¼Œè¿˜æ˜¯åŸæ•°ç»„ï¼Œæ‰©å®¹åï¼Œè¶…è¿‡åŸæ•°ç»„å®¹é‡ï¼Œä¼šå¼€è¾Ÿä¸€å—æ–°å†…å­˜ï¼ŒåŸæ¥çš„å€¼æ‹·è´è¿‡æ¥ï¼Œä¹Ÿä¸ä¼šå½±å“åŸæ¥æ•°ç»„</li><li>append:</li></ul><h3><span id="10ä»‹ç»-rune-ç±»å‹">10.ä»‹ç» rune ç±»å‹</span></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">package main</span><br><span class="line">import &quot;fmt&quot;</span><br><span class="line">func main() &#123;</span><br><span class="line">    var str = &quot;hello ä½ å¥½&quot;</span><br><span class="line">    fmt.Println(&quot;len(str):&quot;, len(str))</span><br><span class="line">    //12ä¸ª </span><br><span class="line">    //ä¸­æ–‡å­—ç¬¦åœ¨unicodeä¸‹å 2ä¸ªå­—èŠ‚ï¼Œåœ¨utf-8ç¼–ç ä¸‹å 3ä¸ªå­—èŠ‚ goé»˜è®¤utf-8 5+1+3*2</span><br><span class="line">    //é€šè¿‡runeç±»å‹å¤„ç†unicodeå­—ç¬¦</span><br><span class="line">    fmt.Println(&quot;rune:&quot;, len([]rune(str))) //8ä¸ª</span><br><span class="line">    fmt.Println(&quot;RuneCountInString:&quot;, utf8.RuneCountInString(str))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>byteç­‰åŒäºuint8ï¼Œè€Œä¸æ˜¯int8</p><p>rune ç­‰åŒäºint32,å¸¸ç”¨æ¥å¤„ç†unicodeæˆ–utf-8å­—ç¬¦</p><h3><span id="11-panic-defer-recover">11 panic defer recover</span></h3><p>panic() å‡½æ•°</p><p>å‡½æ•°ä¸­é‡åˆ°panicè¯­å¥ï¼Œä¼šç«‹å³ç»ˆæ­¢å½“å‰å‡½æ•°çš„æ‰§è¡Œï¼Œåœ¨panicæ‰€åœ¨å‡½æ•°å†…å¦‚æœå­˜åœ¨è¦æ‰§è¡Œçš„deferå‡½æ•°åˆ—è¡¨ï¼ŒæŒ‰ç…§deferçš„é€†åºæ‰§è¡Œ</p><p>recover() å‡½æ•°</p><p>recoverå‡½æ•°çš„è¿”å›å€¼æŠ¥å‘Šåç¨‹æ˜¯å¦æ­£åœ¨é­é‡panic</p><p>æœ‰å¼‚å¸¸æ—¶ï¼Œrecover()åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œåé¢å†æ¬¡è°ƒç”¨åˆ™æ•è·ä¸åˆ°ä»»ä½•å¼‚å¸¸</p><p>é€šå¸¸åŠæ³•ï¼šgoä¸­å¯ä»¥æŠ›å‡ºä¸€ä¸ªpanicçš„å¼‚å¸¸ï¼Œç„¶ååœ¨deferä¸­é€šè¿‡recoveræ•è·è¿™ä¸ªå¼‚å¸¸ï¼Œç„¶åæ­£å¸¸å¤„ç†ï¼Œä»è€Œæ¢å¤æ­£å¸¸ä»£ç çš„æ‰§è¡Œ</p><h3><span id="12-è¯»å†™é”å’Œäº’æ–¥é”">12 è¯»å†™é”å’Œäº’æ–¥é”</span></h3><p>æ€»ç»“ï¼š</p><ol><li>1.åœ¨å•çº¯çš„åªæ˜¯è·å–é”å’Œé‡Šæ”¾é”æ—¶ï¼Œäº’æ–¥é”çš„ç”¨æ—¶è¦å°‘ä¸€äº›ï¼Œè¿™ä¸»è¦æ˜¯å› ä¸ºå¤šä¸ªçº¿ç¨‹åŒæ—¶è·å–è¯»å†™é”çš„æƒ…å†µæ¯”è¾ƒå°‘å‡ºç°ã€‚</li><li>golangåº•å±‚å®ç°ä¸Šï¼Œäº’æ–¥é”ç¡®å®è¦æ¯”è¯»å†™é”çš„æ€§èƒ½è¦å¥½ä¸€äº›ï¼Œè¿™ä¸»è¦æ˜¯å› ä¸ºè¯»å†™é”çš„åº•å±‚å®ç°å…¶å®æ˜¯äº’æ–¥é”åŠ ä¸Šè®¡æ•°å™¨</li><li>åœ¨ å¢ å¼º å ç¨‹ äº’ ç›¸ å†² çª çš„ æ•ˆ æœ å ï¼Œ è¯» å†™ é” çš„ æ€§ èƒ½ è¦ æ˜ æ˜¾ é«˜ äº äº’ æ–¥ é”</li></ol><h3><span id="13ç»“æ„ä½“æ˜¯å¦å¯ä»¥æ¯”è¾ƒ">13.ç»“æ„ä½“æ˜¯å¦å¯ä»¥æ¯”è¾ƒ</span></h3><p>å›åˆ°ä¸Šé¢çš„åˆ’é‡ç‚¹éƒ¨åˆ†ï¼Œåœ¨æ€»ç»“ä¸­æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œgolangä¸­ <em>Slice</em>ï¼Œ<em>Map</em>ï¼Œ<em>Function</em> è¿™ä¸‰ç§æ•°æ®ç±»å‹æ˜¯ä¸å¯ä»¥ç›´æ¥æ¯”è¾ƒçš„ã€‚æˆ‘ä»¬å†çœ‹çœ‹Sç»“æ„ä½“ï¼Œè¯¥ç»“æ„ä½“å¹¶æ²¡æœ‰åŒ…å«ä¸å¯æ¯”è¾ƒçš„æˆå‘˜å˜é‡ï¼Œæ‰€ä»¥è¯¥ç»“æ„ä½“æ˜¯å¯ä»¥ç›´æ¥æ¯”è¾ƒçš„ã€‚</p><p> <em>reflect.DeepEqual å‡½æ•°</em> æ¥å¯¹ä¸¤ä¸ªå˜é‡è¿›è¡Œæ¯”è¾ƒã€‚</p><h3><span id="14golang-channelæ˜¯çº¿ç¨‹å®‰å…¨çš„å—">14.golang channelæ˜¯çº¿ç¨‹å®‰å…¨çš„å—</span></h3><p>å¦‚æœæŠŠçº¿ç¨‹å®‰å…¨å®šä¹‰ä¸ºå…è®¸å¤šä¸ªgoroutineåŒæ—¶å»è¯»å†™ï¼Œé‚£ä¹ˆgolang çš„channel æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä¸éœ€è¦åœ¨å¹¶å‘è¯»å†™åŒä¸€ä¸ªchanneæ—¶åŠ é”ã€‚</p><h3><span id="15channelæ•°æ®ç»“æ„">15.channelæ•°æ®ç»“æ„</span></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> hchan <span class="keyword">struct</span> &#123;</span><br><span class="line">    qcount   <span class="type">uint</span>           <span class="comment">// total data in the queue</span></span><br><span class="line">    dataqsiz <span class="type">uint</span>           <span class="comment">// size of the circular queue</span></span><br><span class="line">    buf      unsafe.Pointer <span class="comment">// points to an array of dataqsiz elements</span></span><br><span class="line">    elemsize <span class="type">uint16</span></span><br><span class="line">    closed   <span class="type">uint32</span></span><br><span class="line">    elemtype *_type <span class="comment">// element type</span></span><br><span class="line">    sendx    <span class="type">uint</span>   <span class="comment">// send index</span></span><br><span class="line">    recvx    <span class="type">uint</span>   <span class="comment">// receive index</span></span><br><span class="line">    recvq    waitq  <span class="comment">// list of recv waiters</span></span><br><span class="line">    sendq    waitq  <span class="comment">// list of send waiters</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// lock protects all fields in hchan, as well as several</span></span><br><span class="line">    <span class="comment">// fields in sudogs blocked on this channel.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// Do not change another G&#x27;s status while holding this lock</span></span><br><span class="line">    <span class="comment">// (in particular, do not ready a G), as this can deadlock</span></span><br><span class="line">    <span class="comment">// with stack shrinking.</span></span><br><span class="line">    lock mutex</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> waitq <span class="keyword">struct</span> &#123;</span><br><span class="line">    first *sudog</span><br><span class="line">    last  *sudog</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;&#92;blog&#92;assets&#92;css&#92;APlayer.min.css&quot;&gt;&lt;script src=&quot;&#92;blog&#92;assets&#92;js&#92;APlayer.m</summary>
      
    
    
    
    <category term="GOLANG" scheme="https://smartxia.github.io/blog/categories/GOLANG/"/>
    
    
    <category term="golang" scheme="https://smartxia.github.io/blog/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>GOLANG-grpc</title>
    <link href="https://smartxia.github.io/blog/2021/11/17/tech/backend/golang/GOLANG-%E7%AC%94%E8%AE%B014grpc/"/>
    <id>https://smartxia.github.io/blog/2021/11/17/tech/backend/golang/GOLANG-%E7%AC%94%E8%AE%B014grpc/</id>
    <published>2021-11-17T02:28:40.000Z</published>
    <updated>2024-03-12T03:55:12.807Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\blog\assets\css\APlayer.min.css"><script src="\blog\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\blog\assets\js\Meting.min.js"></script><blockquote><p>grpc å®˜ç½‘ï¼š<a href="https://grpc.io/docs/languages/go/basics/">https://grpc.io/docs/languages/go/basics/</a> ä¸­æ–‡ç¿»è¯‘ç‰ˆæœ¬ï¼š<a href="http://doc.oschina.net/grpc?t=56831">http://doc.oschina.net/grpc?t=56831</a></p></blockquote><p>1ã€ä¸‹è½½protobufçš„ç¼–è¯‘å™¨protoc</p><p>åœ°å€ï¼š</p><p>1ã€<code>https://github.com/google/protobuf/releases</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">windowï¼š</span><br><span class="line">  ä¸‹è½½: protoc-3.3.0-win32.zip</span><br><span class="line">  è§£å‹ï¼ŒæŠŠbinç›®å½•ä¸‹çš„protoc.exeå¤åˆ¶åˆ°GOPATH/binä¸‹ï¼ŒGOPATH/binåŠ å…¥ç¯å¢ƒå˜é‡ã€‚</span><br><span class="line">å½“ç„¶ä¹Ÿå¯æ”¾åœ¨å…¶ä»–ç›®å½•ï¼Œéœ€åŠ å…¥ç¯å¢ƒå˜é‡ï¼Œèƒ½è®©ç³»ç»Ÿæ‰¾åˆ°protoc.exe</span><br><span class="line"></span><br><span class="line">linuxï¼š</span><br><span class="line">    ä¸‹è½½ï¼šprotoc-3.3.0-linux-x86_64.zip æˆ– protoc-3.3.0-linux-x86_32.zip</span><br><span class="line">è§£å‹ï¼ŒæŠŠbinç›®å½•ä¸‹çš„protocå¤åˆ¶åˆ°GOPATH/binä¸‹ï¼ŒGOPATH/binåŠ å…¥ç¯å¢ƒå˜é‡ã€‚</span><br><span class="line">å¦‚æœå–œæ¬¢ç¼–è¯‘å®‰è£…çš„ï¼Œä¹Ÿå¯ä¸‹è½½æºç è‡ªè¡Œå®‰è£…ï¼Œæœ€åå°†å¯æ‰§è¡Œæ–‡ä»¶åŠ å…¥ç¯å¢ƒå˜é‡ã€‚</span><br></pre></td></tr></table></figure><p>2ã€è·å–protobufçš„ç¼–è¯‘å™¨æ’ä»¶<code>protoc-gen-go</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  è¿›å…¥GOPATHç›®å½•</span><br><span class="line">  è¿è¡Œ</span><br><span class="line">&gt; go get -u github.com/golang/protobuf/protoc-gen-go</span><br><span class="line">  å¦‚æœæˆåŠŸï¼Œä¼šåœ¨GOPATH/binä¸‹ç”Ÿæˆprotoc-gen-go.exeæ–‡ä»¶</span><br></pre></td></tr></table></figure><p>3ã€åˆ›å»ºä¸€ä¸ª<code>test.proto</code>æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">//æŒ‡å®šç‰ˆæœ¬</span><br><span class="line">//æ³¨æ„proto3ä¸proto2çš„å†™æ³•æœ‰äº›ä¸åŒ</span><br><span class="line">syntax = &quot;proto3&quot;;</span><br><span class="line"> </span><br><span class="line">//åŒ…åï¼Œé€šè¿‡protocç”Ÿæˆæ—¶goæ–‡ä»¶æ—¶</span><br><span class="line">package test;</span><br><span class="line"> </span><br><span class="line">//æ‰‹æœºç±»å‹</span><br><span class="line">//æšä¸¾ç±»å‹ç¬¬ä¸€ä¸ªå­—æ®µå¿…é¡»ä¸º0</span><br><span class="line">enum PhoneType &#123;</span><br><span class="line">    HOME = 0;</span><br><span class="line">    WORK = 1;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">//æ‰‹æœº</span><br><span class="line">message Phone &#123;</span><br><span class="line">    PhoneType type = 1;</span><br><span class="line">    string number = 2;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">//äºº</span><br><span class="line">message Person &#123;</span><br><span class="line">    //åé¢çš„æ•°å­—è¡¨ç¤ºæ ‡è¯†å·</span><br><span class="line">    int32 id = 1;</span><br><span class="line">    string name = 2;</span><br><span class="line">    //repeatedè¡¨ç¤ºå¯é‡å¤</span><br><span class="line">    //å¯ä»¥æœ‰å¤šä¸ªæ‰‹æœº</span><br><span class="line">    repeated Phone phones = 3;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">//è”ç³»ç°¿</span><br><span class="line">message ContactBook &#123;</span><br><span class="line">    repeated Person persons = 1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4ã€è¿è¡Œå¦‚ä¸‹å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; protoc --go_out=. *.proto</span><br><span class="line">ä¼šç”Ÿæˆä¸€ä¸ªtest.pb.goçš„æ–‡ä»¶ï¼Œå…·ä½“çš„æ–‡ä»¶å†…å®¹æˆ‘å°±ä¸æˆªå›¾äº†ã€‚</span><br></pre></td></tr></table></figure><p>5ã€åœ¨goè¯­è¨€ä¸­ä½¿ç”¨protobuf</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">package main;</span><br><span class="line"> </span><br><span class="line">import (</span><br><span class="line">    &quot;github.com/golang/protobuf/proto&quot;</span><br><span class="line">    &quot;protobuf/test&quot;</span><br><span class="line">    &quot;io/ioutil&quot;</span><br><span class="line">    &quot;os&quot;</span><br><span class="line">    &quot;fmt&quot;</span><br><span class="line">)</span><br><span class="line"> </span><br><span class="line">func write() &#123;</span><br><span class="line">    p1 := &amp;test.Person&#123;</span><br><span class="line">        Id:   1,</span><br><span class="line">        Name: &quot;å°å¼ &quot;,</span><br><span class="line">        Phones: []*test.Phone&#123;</span><br><span class="line">            &#123;test.PhoneType_HOME, &quot;111111111&quot;&#125;,</span><br><span class="line">            &#123;test.PhoneType_WORK, &quot;222222222&quot;&#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    p2 := &amp;test.Person&#123;</span><br><span class="line">        Id:   2,</span><br><span class="line">        Name: &quot;å°ç‹&quot;,</span><br><span class="line">        Phones: []*test.Phone&#123;</span><br><span class="line">            &#123;test.PhoneType_HOME, &quot;333333333&quot;&#125;,</span><br><span class="line">            &#123;test.PhoneType_WORK, &quot;444444444&quot;&#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line"> </span><br><span class="line">    //åˆ›å»ºåœ°å€ç°¿</span><br><span class="line">    book := &amp;test.ContactBook&#123;&#125;;</span><br><span class="line">    book.Persons = append(book.Persons, p1);</span><br><span class="line">    book.Persons = append(book.Persons, p2);</span><br><span class="line"> </span><br><span class="line">    //ç¼–ç æ•°æ®</span><br><span class="line">    data, _ := proto.Marshal(book);</span><br><span class="line">    //æŠŠæ•°æ®å†™å…¥æ–‡ä»¶</span><br><span class="line">    ioutil.WriteFile(&quot;./test.txt&quot;, data, os.ModePerm);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">func read() &#123;</span><br><span class="line">    //è¯»å–æ–‡ä»¶æ•°æ®</span><br><span class="line">    data, _ := ioutil.ReadFile(&quot;./test.txt&quot;);</span><br><span class="line">    book := &amp;test.ContactBook&#123;&#125;;</span><br><span class="line">    //è§£ç æ•°æ®</span><br><span class="line">    proto.Unmarshal(data, book);</span><br><span class="line">    for _, v := range book.Persons &#123;</span><br><span class="line">        fmt.Println(v.Id, v.Name);</span><br><span class="line">        for _, vv := range v.Phones &#123;</span><br><span class="line">            fmt.Println(vv.Type, vv.Number);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">func main() &#123;</span><br><span class="line">    write();</span><br><span class="line">    read();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://upload-images.jianshu.io/upload_images/5367714-2eb580ad8e2e7a93.png" alt="img"></p><p>image.png</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//go:generate protoc -I ../routeguide --go_out=plugins=grpc:../routeguide ../routeguide/route_guide.proto protoc</span><br></pre></td></tr></table></figure><p><code>-I</code> å‚æ•°ï¼šæŒ‡å®šimportè·¯å¾„ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ª-Iå‚æ•°ï¼Œç¼–è¯‘æ—¶æŒ‰é¡ºåºæŸ¥æ‰¾ï¼Œä¸æŒ‡å®šæ—¶é»˜è®¤æŸ¥æ‰¾å½“å‰ç›®å½•</p><p><code>--go_out</code> ï¼šgolangç¼–è¯‘æ”¯æŒï¼Œæ”¯æŒä»¥ä¸‹å‚æ•°<br>plugins&#x3D;plugin1+plugin2 - æŒ‡å®šæ’ä»¶ï¼Œç›®å‰åªæ”¯æŒgrpcï¼Œå³ï¼šplugins&#x3D;grpc</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;&#92;blog&#92;assets&#92;css&#92;APlayer.min.css&quot;&gt;&lt;script src=&quot;&#92;blog&#92;assets&#92;js&#92;APlayer.m</summary>
      
    
    
    
    <category term="GOLANG" scheme="https://smartxia.github.io/blog/categories/GOLANG/"/>
    
    
    <category term="golang" scheme="https://smartxia.github.io/blog/tags/golang/"/>
    
  </entry>
  
</feed>
